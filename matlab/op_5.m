function [Y,Xf,Af] = op_5(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Apr-2019 10:24:27.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;5.1291e-15;-0.00087186;-0.0028194];
x1_step1.gain = [2.18660485863677;2.70888921997539;3.51660717739528;5.574728595732;11.361093028038];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.32304567329304245682;-0.72770364159845246643;-5.40609009372117022;-1.9526307317893327742;-1.182422410492173892;0.40738463324731039039;-3.1137447143953851381;2.7692190296360443824];
IW1_1 = [-0.05745623958134866982 -0.0067627646700932986593 -0.42717798434840958954 -0.48595188080294365873 -0.40645265637171879014;0.66780536687693015097 -0.74405150426391164498 0.12662290482122057211 -0.78091595248866430001 -0.13486575894570648759;-1.8137468160388914296 -2.1001960167335584906 -0.78172773258094463422 -0.86065409018805572039 0.32587600037215058713;0.94362154718617485827 0.73792944222610179494 0.24421646552660997154 -0.18896446356565133051 -0.29097558028245623651;1.2924782534411232149 0.57077184586385154574 -1.7248294094243656893 -2.1242860891688559732 -0.089246102817932659867;1.1169355730206025346 0.41684092809904482735 -0.27889701810893902101 -0.46406430865741438163 1.0789215708759054557;-0.33020370625047262836 -1.3298065032605947966 -1.1184186080253906148 -0.11807131657660524526 -0.064756785706814395942;4.3357973616353966406 -1.3436662960910179532 -0.9640876518259304806 0.39997556783670579206 0.03476258646791112461];

% Layer 2
b2 = [2.0961974391445550303;-0.43317426966084271456;-1.2743928223607960959;-0.7560959996538009209;-0.6119744936614328612;1.821701666418957144;0.83299950701155411892;0.50928033751942847207];
LW2_1 = [-0.75366372120520674915 0.11526543600624973573 -0.67833442163874524411 0.43978229454237627305 0.85385278492097660408 0.98516474126309583337 4.997740568382908144 0.041362973230513355727;0.0058725541677693490761 1.5455659392771166072 0.84778982128490620873 0.06573856811873834971 -0.055595627288879900796 0.41228721698241305171 2.1346789067486273694 3.8253927630755835132;0.049871141465273570448 0.087137283582563729301 0.051237500682958632414 2.777787513499473615 -1.6321066418529626141 -1.6901170658682245218 -8.365892312147281018 -2.4547245895804006288;0.86350778776565650929 -0.0454369305951405969 0.36302862778346051131 -0.92304613529718404497 0.14088494544423288413 -0.27977620058934998815 1.0531760056516863422 0.60369908570037034146;0.23824463005386564696 1.705948432550701499 3.1094378394860693327 0.8175346001971603993 0.96237938082964591402 -2.5289753480305314781 1.3064810416898369194 -4.3637094899942701076;-0.76453576989906490979 0.79316719121327894371 -0.54936485986998495612 -1.2784545508731868235 0.071911151192891778483 -0.18544634625322894972 0.86853873046344243214 -1.3124557478781215814;-0.85157242520160880694 -0.32218405229209440277 0.91811246499519083564 -1.5527894549442127214 -0.34289234458860701205 0.90099526806865581907 4.1831021891344244423 1.1756911767504962807;-0.81344412951116251698 -2.2745569978242961007 -2.6531522557732771794 -1.3749121004335183027 -0.58503887489937567157 0.41660250512552188251 -1.0878932869238211456 -1.9288459282685617158];

% Layer 3
b3 = [-1.9497251218265094774;0.29476303143921400718;1.4733218665078766652;0.63200963712868940547;-0.56482879194447765947;0.43194451708565712034;-0.2471894007664222348;-0.81778344065961672271];
LW3_2 = [0.82923156458263946877 -1.0498435970471129419 -0.11719731449952870694 -2.1191045049940551159 -1.805937780430345585 0.0896795247191498196 -0.79063914975298132948 0.89405378808512769861;0.087997907538058237065 -0.58643185704484357412 -0.02562401075767862732 -0.26336844061658554184 0.32902719464002461169 0.029991230194363376754 0.60969621426731035463 0.9610438157330856157;-2.6556656667871996191 -0.97469827315149493163 1.2975832573700960548 0.7937966998245911121 -0.87419986150414108472 -0.39814801552869533152 -1.304367056172599959 -0.43421523475271844861;2.8614376875403380041 2.2725657545772279811 0.20450798637192871277 0.077085505330090564602 6.5175763754259863347 0.014248481620746574275 3.3510356310563906845 -3.6571654054542652723;1.4256890845614567098 -4.7756095023546834 -1.219285438156702428 -0.6940914544140530662 4.7324135543279286509 -0.16859974592973889229 0.30595146945361295643 1.9611365764361794461;-0.61475408361400485369 1.0692553035821164009 -0.038600599150087427924 0.2526309041643980402 0.41952768642420568135 0.29314066421002704654 -0.037028323334228958885 0.21320748954986379342;-0.81596336109812039883 0.51360217154846299348 0.029395687732907523071 -0.15541870403721472216 -1.1761946397209945836 -0.48600019062581772955 0.30906298880456395395 -0.63041335191914760205;-1.8570655698402054323 -0.42223214737579362055 0.33876983945197541859 0.62010159969653244616 -0.79457337288242269047 -0.8076508340427634991 -1.2628616016381402076 -1.0100814698673121761];

% Layer 4
b4 = [0.18418037701867476241;-0.2924365293534400001;0.91165568040211086842;0.68681291569584024259;-1.8835534754429443804;0.045687126140517578254;0.65754832180174871414;1.6859271591079820762];
LW4_3 = [0.01128056217180884932 1.3937768676657238398 0.81564326348452609317 1.3405017965438086325 0.47680490701973027301 0.1224298465595682478 1.3032100110765310053 0.29676642658374347006;-0.066716971704238833829 0.31329273898363352302 -0.47489503772669960924 -1.4343844102527916196 -2.270222356355501514 -1.0232790856925602085 -0.84538224719799359708 -0.28363921009259768224;-0.060826840457264046147 -0.092572487506465919727 -0.18989941319671704845 2.7236895208994247319 -0.62000787418028435738 0.26951985772453046497 1.4616385287553856909 -0.073503735427685110149;0.25608992608217273634 -0.32813475913760226099 1.6990103253208486134 0.33163520838613469444 1.5635237873143670306 -0.75367869811837762128 -0.069768255927873376598 0.019491240324022524044;-0.75538779509696252212 2.1866490226124710716 1.9525855696762854929 -3.9142494893850985349 5.676923646830524639 -0.73663704301865806645 -1.5279437735242888952 -0.085973617222856985043;0.27882233733070310722 -0.072709089997139250694 0.6484337718578142562 -2.1170313529005282405 -0.0046551948741653760219 0.31922811210079188315 0.93700726181211124732 -0.53065161560284968001;0.2307426114435435216 0.98059509374908104817 1.2349179893617701076 -0.47326721961883538858 1.1033748782896433127 -0.58273337824072213298 0.31219673661433328116 0.20292695250590489509;0.58178084648623584751 2.595159199386436466 1.9158104135546836222 5.3996122467079299412 3.4568482447033703764 -0.74279382850460362597 1.6413772659470624582 -0.028617344664374363972];

% Layer 5
b5 = [-0.090060700809461519123;-0.73649448721527144279;-0.49251450326590562323;0.25812837881295763731;-0.69505847753298855007;-0.24168131873719717051;0.069817973820586132216;-0.064522819950324189486];
LW5_4 = [0.33273556810984783461 -1.3532721062465435935 1.0749923151758637996 0.92482895236256856819 -0.64463670302725661898 -0.8141393067844928666 0.42908391211648289065 0.85976802325351886491;-0.58902888966257416214 0.87488256615055326471 0.59706759472388892807 0.58762183820140212465 2.6120211610577905859 -0.12011662117972372876 0.43486381232468424018 -4.1975295515469408514;-1.1705118114911330363 0.46326404445088165129 -0.46948635774188324232 -0.79124531088008054347 2.2872336232401062617 0.45051193990600763017 0.4797890899564808409 -0.47001301250231514173;-0.054983058276706235634 0.58249663471240231694 -0.066855941926626485938 0.62854691541924589959 0.94969053746721121545 -0.33145719555839314729 -0.6317468942705241064 -0.11886072766948595214;-1.6777362787806411326 1.3789974763953680714 -0.92081032320361644317 -2.3490935490230211435 -1.2365646545410053925 -0.31042201665081908812 -2.3579187540239212595 -3.0204991787122108526;-1.2567620998189257264 0.72097560464392806967 -1.8986770282965514944 0.38146099031094310439 0.84097085389534032007 1.2656332087117045937 -1.0953448831606751313 0.7855341981087717862;-0.76186814274555059168 -0.90420736829381775923 -0.89141383997729872757 -0.082121632343854750191 -0.51389341539551580684 0.070216351577554736441 -0.73911654816623062469 0.10181755142778824152;0.045887510158907414415 0.78748297982362636116 1.92326026239081882 -0.75268507121122030235 -6.5779314513305653378 -0.85936220422330655833 -1.7048929613466461408 0.84983026262512950666];

% Layer 6
b6 = [0.45408281013253337655;0.02192778877604052018;0.14960215448891059364;0.226827670972740425;0.83060953569720874512;-0.064123119356552030212;-0.20628974770308833309;0.28234790304916701498];
LW6_5 = [-1.2710860979275000471 -0.1746429368151399264 0.58936983931522668456 0.01879861666406177842 0.51425994556367093935 0.36685938902367676295 -0.39632472367968835103 -0.39030573906625742886;0.98354657092332864465 -0.71449400006440966227 -0.82174668437342335281 0.2547738518518023465 0.040837550186740255442 -0.11038768436421517172 0.73266374572583969904 1.4786732660588286503;-0.40480146743080624994 -0.10502627979684336923 0.2370456292393670894 0.22782421506430541869 -0.36945964903634431753 -0.62614966650741654686 -0.053159163633587552811 -0.72889729223535526526;-0.95355991428665665133 4.2342508443388027217 0.76813072658892178612 1.1977064001089336998 2.984203146535682194 -1.8914479891205939754 -0.56270148050419011021 -3.7318984520834543872;-0.32225177442820562845 -0.62387379098290240975 0.43290505838677562078 -0.64474726725550313144 0.57964098685233766961 -0.22962374362409979089 1.6554344211039759838 0.53862736133736111022;0.58200944211710947673 -0.18520715411523211436 -0.15471248498008180472 -0.54492783370887010186 -0.90358933542418495843 -0.53728892144966877709 0.011568645999838896368 1.1619019321336596651;-0.28631289112258828666 -0.50158514614352689431 1.1175852440106139873 0.73914315679331266118 -0.9266288467931697026 1.0712038742256171364 0.34637710121272319297 -4.1401940151661795753;-0.62122312589267303373 1.8925011124820700914 1.0370295978471741893 -1.1218283500823673648 -2.9162840075760207981 0.98643793180051930758 -1.1313549170576586711 -3.7154871100938486883];

% Layer 7
b7 = [0.6372383491086374141;-0.21012648300142752755];
LW7_6 = [1.8152201307352637816 -2.3114243962977205626 0.721428188858136199 5.7383080656232419159 -0.72575495567312275913 -1.295845417105263131 2.8930203587590681558 4.4739948940960596602;0.021340850426719924771 -0.13363801893012686173 -0.47393096878206125711 0.072667659814719773315 -1.5016417100498400394 0.23520227480972127898 -2.0675150995935211995 1.6666729817686618542];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;0.668896321070234];
y1_step1.xoffset = [0.001;0.01];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
