function [Y,Xf,Af] = op_2_rescale(X,~,~)
%OP_2_RESCALE neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Apr-2019 13:23:51.
% 
% [Y] = op_2_rescale(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 2xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14];
x1_step1.gain = [2.18660485863677;2.70888921997539];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.4931083442824393259;-6.627638190217088443;1.8500620823435465212;-0.13944964024818640169;0.69126051094554841203;2.8654825703408928206;10.160284400223945411;-3.8854933036881558195];
IW1_1 = [2.9297594351747693331 -3.0436434639709832872;0.99922163834209798416 -7.5478832995563625019;-1.3772775749609607043 -0.86346766284751697018;-0.86205171806451830196 -0.56379720833472113384;-2.694589970566031667 3.4856045080866664421;5.1729905976515668797 -2.618976160505332107;5.8457219186174853576 4.4217622167912900011;-2.7016837268084099577 2.8340674051712952952];

% Layer 2
b2 = [1.8856625134452029702;1.6006148176506937997;0.36693975552024188369;-0.12791694563282118846;-0.011280074310818836991;-0.43012029898119874538;1.6019206807438144402;1.906880653855265173];
LW2_1 = [-0.78989824123071561424 0.21777211690420603118 1.3172623584822118481 0.85316771537053137653 -0.045053753355270675929 0.40264562772573220251 -0.49521874381000929866 -0.65396721931862711319;-0.86402011696082769987 1.3372495129864898633 -0.54751420125414984597 -0.83624317133353054388 0.41906460791688554535 0.41120446565327012367 -1.2009108521211033782 0.29226686156454878551;0.23605001917408063861 1.0488325463560090878 -0.2961592501802179922 -0.86941101147790944559 -0.29041473924015209773 1.642156532596626084 0.28831881606261300366 -0.70855942217250877935;-0.18859460981483541775 -0.68192671225203826957 -0.53353090603735009445 -0.90400840488191569477 0.051117488069528906058 0.46834161713931909965 -0.74108958066044861024 0.39508462071996203191;0.54451477178468998819 5.3062469461371080115 -0.34724667563479089116 -0.51802582312491840533 -3.1738565793149033922 4.9763564828934780948 5.0635550277774159511 -0.55478976778889288468;-0.50766216452623036393 -1.7924018357520909994 -0.32126746370273717712 -0.5036533288682686349 0.5126161396955073446 -0.88598931866820895831 -1.2891429479422300552 -0.51919355465017413831;0.0014764162527986261428 -5.5817613960282042029 -0.6769106884244191491 -0.0072371189249366384144 0.36336412839991638624 1.8399992891084531177 10.710893771157067533 0.58005095348102253539;0.64907650456122423233 -3.0143837359341767446 0.1619823234503138254 -0.69466009395209860067 0.86851509041022623148 -0.24828964708326373145 3.1086727188106535458 0.8873148733261213561];

% Layer 3
b3 = [-1.4475754067755011167;1.1981036687908492855;2.8617981667563996417;0.14110737576193346787;0.38929037895376017442;0.70929224595435036438;-1.4505234791361478752;-1.9216625232425432745];
LW3_2 = [0.80502878967584445835 1.1315761105532649022 -0.54479307709755386835 0.49584231985142768195 0.50794897086826329424 -0.77652238334492940108 -0.509383888391044648 -0.72899230730397368561;-0.83411317200609036426 -0.060564053964013729592 -1.1545039213773655717 -0.45979902240017422876 -6.3826245226997251336 2.3800615190213099126 3.5198974280270758364 0.25529023928652183617;1.1380137869468207601 -1.1376121800372438475 0.56955304688106977995 0.8575103414436316962 -5.4115169200848223241 1.4727073363880833767 -3.5320968023375871603 4.5286592280817803413;1.2362470234198685848 -0.41779256327514763258 -0.46844204410138379213 -0.76290876211380365124 0.091846868587013144603 0.28283015474267153566 -0.21102503879718276236 0.77567228523511688731;0.15568996700984868986 -0.26239734406942050171 -0.23395629680911156356 0.20915734262401639021 -2.9716663271518317657 1.8123129114469969103 8.7312004792243378404 2.3890509794616443529;-0.055267882036265980616 -0.39775423601165810217 2.0182040908724925288 0.56187520499885135195 0.90547785576421191411 1.4184853723199779552 -1.2085013439253839973 0.40374059884163754353;-1.2209942890695859585 -0.31815508058839592209 -0.39505884956229658789 -0.52119019338402239327 -0.46439203482168089909 -0.51588477345068373126 -0.99173351963291433986 -0.32585435361503140017;-0.77105388365131544148 -0.9308355824604844786 2.5728574327874387251 0.87232653768369328162 1.1848687319517205996 0.58565018891308628923 -0.28346003825949261934 0.46981797613386383494];

% Layer 4
b4 = [-1.869001895725771023;0.062664845819723688503;0.99228210092361368577;0.11908192901700818955;-0.13451690645771807731;0.90911015333896716406;-1.0786488202762047894;1.444190954670927729];
LW4_3 = [0.789326584253104091 0.42739269661055029337 0.63440759148140624113 0.26474151784159027923 -0.44757834263377216377 -0.39815559722061183434 0.8127671995477636635 1.0136713245670607719;-0.27675968339136569618 -5.8108511403613682944 0.83654173947180932025 0.15482245421697951593 -8.382167241312805217 1.4832042881865241668 -1.5335069174462314656 0.29162438770379511821;0.7761665776913940773 -5.7648445414166014089 -6.9047032516052384565 -0.55887426281654339899 -0.77819106767581813777 -0.18693861954826865301 -0.86794506363984602615 2.012534177679017322;-1.8814264363208923481 0.69793573308451783976 2.1637515097709187906 -0.778569131259796543 1.7634061227101134328 -1.1180327396061346956 -0.52978964297820319018 0.53800265059598517681;-1.1690434825225717308 -0.43360861668472600039 0.83321172877294880088 0.69952200729283409153 -0.021571639657154906972 -0.86704392961976095577 -0.53647440196594542439 -0.67191094667479012159;0.49474758141739588746 -0.066866647008154186937 -0.50286377664704295931 0.72447217354881721096 -0.8005566992828837547 -1.586954625881374259 -0.98300170688977805966 -0.044451693871647698919;-0.44516916893652525022 2.0199448969263040787 0.60748253464118429079 -0.53244344155289291542 0.77431851585839250873 0.71677168358603304821 0.38054697668778914021 1.1301449605929638764;-0.4576853274635980795 0.67933429471925177445 1.4344554214747615717 -0.40145398868770709733 0.28086042538662353563 1.5803917395107804911 -0.81822639892476611845 0.52857590674482568538];

% Layer 5
b5 = [1.3112790423174678356;-1.1977491473076269379;-0.44423900793075365989;0.26544503433709648599;0.13349777656989983421;-0.43471599471259142478;-0.62518480992838965093;-0.9089678076897163006];
LW5_4 = [-0.12322366960965600025 1.6039811090417919193 -0.87856247050538582855 -0.78949249586353087427 -0.7273802090070419224 0.85641977527325141573 0.77137056500577783069 0.70707008763667866802;-0.034017654366839421287 2.6034207664655166781 0.94130725370840417909 -3.1846969570787404535 0.64200116765000758701 0.90374693155462193506 1.5968500407553942733 1.1322460732939041428;0.36340011588233395168 -2.7271055340090533115 -3.0839502304490755691 -0.05590794888004448765 -0.36295928126876003672 -0.19122922612610199211 -0.88509023943231257547 0.10313855233504548581;-1.0245020483339630779 -0.50464035415818164765 0.015688890974116923016 0.17748311678178904649 0.14049629126540238988 -0.042546355936755764215 -1.0847356281273594636 0.81492547345962162986;-0.74522686598880727438 0.35381822885642827403 0.23535600688264399216 1.1486536662685076227 1.4868957577706001238 0.64774476872758135482 -0.13782867081657135255 -0.28493285538544238511;-1.5562825788775027647 -0.59374921370948197108 -1.7755406716718045157 0.76040722103725222336 0.19394524590705744527 -1.3266979981551780821 0.27497506612706851259 0.18636710632271422106;-1.1825547698253311424 -7.6245628000375873512 2.6392886472258516584 2.3810376134041977281 -0.096479382124723206404 -2.0165114082018766872 -1.6034691700902028444 0.042193588238516169242;-1.7957707310855690608 -1.8073440675117331544 -8.733617872103659252 3.6189420387450552674 0.66428108191875046007 -1.4859022309274731999 0.55790245104114988273 1.9963016069594012869];

% Layer 6
b6 = [1.3017899784324842294;1.3248765799612529648;0.89449262166649290418;-0.29654349018197301291;-0.37955714596433459684;-0.13575185006055787151;-0.87765473571103724826;-1.4396695519591782286];
LW6_5 = [-0.71052193395358131944 -0.62552000061747237147 -1.0235470027801998327 -1.0436277441171553093 0.0025309012388980110797 0.47454406907334623078 -0.61044805016613989945 0.47343655622926783533;-1.4036934043850539666 -4.0636199840679561035 2.4906517350166215152 0.54119714614286085208 0.71121671246059747773 1.7954959472313194446 2.8625294781545043143 8.5682632272241701088;-0.75249154060475476058 0.10385258125936018547 -0.63880126228295008861 0.055990483246088393332 -1.4105827192666360315 2.2847736184176485885 0.91234922222085723664 2.4163352454811528602;-0.66141068366009170276 -1.3586435840385073792 2.2518029902324272484 -0.50806314258145790497 1.0921369559804476879 0.16353215181085575813 -0.82905805281771294268 1.2321348286296442964;-1.5390292464066535061 0.29822840502796843509 0.43589496845751762866 -1.0455820928947339166 0.63563192446993921347 -1.1394261017655440416 -0.10934493351141406914 -0.31378828364553923436;-2.8960413455226405866 0.83640426322775629497 -1.6470937810489707509 1.2795671121111615864 0.99762411520733274006 -2.7741986704212857617 -7.5675571316936744992 1.2981623712922631952;-0.36153922884128414372 -1.7492464412520909445 1.2725175933707479903 0.33630259029622822098 -0.3946329350845433348 1.353988000179107587 1.5070988158931160061 1.3587957423184011674;-0.94248444988701407521 0.26438332886510784725 2.1590221470276098614 1.1993586353449177118 0.80067346534766603572 -0.99053642005671427295 2.6217629593916624842 1.8661420075628303294];

% Layer 7
b7 = [1.6061338398635900404;0.69878471117204143948];
LW7_6 = [1.13489465201092532 8.4469575592513415074 -0.49775385755640105812 0.61827055330796942823 -1.7512175793096329546 -8.13529434571536747 2.0150957224337093798 2.785334365588991723;0.10890848276112180537 0.26702227306021347752 2.9618743929432627127 -1.9867029523031010108 -0.051484890433956910505 -0.16559546916471248879 0.57526022179709568327 -0.02459860605211475551];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
Y(2, :) = Y(2, :) * 10.0;
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
