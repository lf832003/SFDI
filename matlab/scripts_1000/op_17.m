function [Y,Xf,Af] = op_17(X,~,~)
%OP_17 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:35:39.
% 
% [Y] = op_17(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;-0.0016794;-0.0017771];
x1_step1.gain = [2.18660485863677;4.45762514671159;8.21601210382903];
x1_step1.ymin = -1;

% Layer 1
b1 = [6.3145619395577172739;1.4846694484355424937;5.0241360072516370039;-1.4162633902063752611;-4.1168491784566043634;0.38073308143403356008;1.3516379827032025673;0.28742861132648089839];
IW1_1 = [-0.52230829044026860775 6.4235420692360287731 0.45697589039703290226;-0.13970487092378600091 0.30823526665830036642 -0.51819715032196334015;2.7809185263296289925 2.378569534589673129 -0.2267909887584486639;-0.56280346573761974582 -0.79062275092165001933 -0.38422196961334731391;-6.8707203057438563931 1.3830432108104508959 1.5029552541095188012;0.24402908721737273656 0.62972872460974116393 0.19732609886831237178;2.0374213142183532632 -0.53857006344056579383 -0.1292547204565237251;-1.2132613262340363747 -0.057540872771881849956 0.21596723871354914226];

% Layer 2
b2 = [0.93093307248576195878;-0.069247036404259956766;-0.41665453353769799083;0.44120615258713857809;-0.26940735400664134191;-0.30952205477290639646;-0.41593721091175633875;0.92535268270028214754];
LW2_1 = [-0.38247678436895521381 0.88188342480022163805 -0.015125706667177368087 0.72303482922714579217 0.49166826538299313043 -0.51272885017265779073 0.062354467974607780123 0.5720797283989762505;-5.7219568630171204759 0.68829010303266169313 -1.6268387001707751427 0.22529864455635548182 -3.6838192387359054436 -0.045830957512131710596 1.017401943515308993 -0.85599523844069069778;-2.7973607966064721886 -0.26770583002978420861 2.2347002599716350169 -0.75218359473992846276 -5.1644346539422505415 0.00538052197930630801 2.5094605322054688301 0.24060956916483891566;0.31624293025981731198 -0.93760124810348199897 0.40066416524361497808 -1.5010805358700660683 0.10576180298145287928 -0.20781104033493516536 -0.68283760986126407211 0.5989115335686067132;-5.5276184565233554835 -0.0059912669730641668689 -4.5898417501518142814 1.6372571150939358997 2.2107699697116922621 -0.76348397285350211305 -0.70973961776274019364 0.016453591902718760903;0.90960624331824380118 -1.4673494319643853867 0.0066612111524039690005 -0.35269427921822976701 0.043016817900136478103 0.28668741740923692207 -0.029628569289038467205 -0.26457624871685037071;-0.18537148039204168204 0.15546608161449271268 0.14967788105292986756 0.082408094319677813178 -0.20679429404977825446 0.080288167112778086043 0.3187937971799578718 -0.31142921649609400792;0.45135714937854615192 0.37526134972237945586 0.14207496504678493454 1.271667477846881944 -0.1015271014297187413 -0.31560993356990124648 0.0082930555300018363868 0.16674082845521864815];

% Layer 3
b3 = [-0.4579221998924219994;0.9782774944532862671;-0.090292007019462577899;0.3293964991099340156;0.23855343445303617278;-0.44150808720975603938;-0.2109294819501284779;0.32557243457022361222];
LW3_2 = [-0.17182408110361740983 0.08146736210346935958 -0.043483926914388862373 -0.19268279962711570841 0.083134134170174303624 0.61711288748269976789 0.31762665338178480701 -0.68167748379569148565;-0.55739790390103671758 -0.41423619555944601878 -0.17777102931300528543 1.6211583844783430397 -0.059846191008900789798 -0.080869837312465525647 -0.54070998118840407631 -0.73445762434302364063;-0.038883268691205404022 2.6271048342517251406 1.2993027975210482694 -1.2234507347133825039 3.6172374206018829135 0.21525306314091829929 -0.97633889300829490576 -0.19893693108331655939;0.21290499217773864449 -0.53233155250598040986 -0.2613658191036503653 -1.0719687938809150385 0.82930320335294283041 -0.35950880165024934332 -1.2694473625924707072 0.45173106424553660654;-0.32077148242363806574 -0.084495398463894352825 -1.0509294838888825208 0.22733402170799277275 -0.13381729909440992499 -0.6315090855401617187 -1.0945918079768008901 -0.1010222403813971076;-0.20480653626304465287 -0.60447847003887777984 -0.59213866160471895217 -3.6941804766832246898 0.41236323264350277507 0.81122877730191444989 0.37200036638220090879 1.1271892994071313066;0.17999699726114476439 4.4411796831028844679 6.088714311965809145 -0.83590845425319315609 0.22848594780600847698 -0.367613057869762061 0.78840259791399813771 0.0078696384487788439283;-0.167325457813093742 2.9911975430609745175 -4.0933716985726098514 -1.1622970867666020389 6.9233899134399408126 -0.17085783499729043089 0.26884790047075662889 -0.27568526476438348638];

% Layer 4
b4 = [-0.29526984870680672568;0.45434169434820659284;0.23208099431873280283;-0.52263040848549480177;0.46664432230525315637;0.047778076488386687914;-0.10232262938135811003;-0.18914796204070369323];
LW4_3 = [-0.30304776109705561238 -0.94740355818922250553 0.019015977494530537928 0.73065308979591780947 -0.81334226117285801649 0.78932171811321694133 -0.35799216732472627367 -0.1252127437806926924;-0.45111088327809517606 -0.54122121705795322999 0.060142738181929444874 0.17187309226759553415 1.2488210713860228296 1.0004517485740180849 0.24751304070149085512 -0.25899004635893257964;-0.34451316707934881434 -0.71428109065574874048 1.9673174963479300725 -0.54557473836981718041 -0.37396220181359551837 -2.224074305481006153 6.1045407739108945577 -1.5983085497416393839;-0.33402222573363826719 0.75601026977107810279 -0.39394548304783294501 -0.96393257577475288667 -0.19995320243850916997 -1.3707442711426609527 -0.30607904327836954472 -0.11314111696940711005;-0.49692105166725514254 -0.22620036302687177021 1.4376806456817996516 -0.42802464517623450835 -0.99926173593211153889 -1.7110150582142036324 1.7006651988270784503 0.53541806992461116188;0.9703269526169986392 2.070181363519907336 0.043962292216654645649 0.11739722392343074353 -0.75756557181196682027 -0.84481033211841238817 -1.690710574778675479 1.4795232472303185833;0.52795581469692709486 -0.41045483238687469063 4.7203557929526231973 0.26328952275186556786 0.020248326761720069483 1.4292819884633449767 1.9795743237612017928 7.1689630628088565345;0.60574320595896236075 -0.099138362528518250705 1.9660384154911554333 0.48993919525094348222 -0.094444636684222343925 1.0003425950813378265 2.4463764325032415492 3.1541234072144743728];

% Layer 5
b5 = [-0.1085059928679344976;0.83863746451250653635;-0.34336552144196819114;-0.43781624745589892145;-0.48130664209139678578;0.85386921386816783119;0.53337243244765886185;0.081188123294366976168];
LW5_4 = [-0.21618799785295775284 0.13791333131404251433 3.3623779006010701131 0.82670236881775160942 0.31747441739449949738 0.054868797166494988338 -5.7122642064879114443 -3.0647533810148841482;0.4266765321811691325 1.2231297248896828567 -0.1742371204243409466 -0.22336735009678229669 -0.11157175621056768244 -0.60932674306802858677 0.080629510311363478126 -0.039782106907438385957;-0.82119450188909381971 0.54835438014331228107 -0.70417043315418670346 0.20771192844890279394 -1.1025914212790881574 0.27870264013060808139 -1.4519317755137357562 -1.219527901881704901;0.042755501756092599563 0.086775517560593290467 0.96425146307802178658 0.31352679992056692315 -0.27602559653553904173 0.82230268684053309247 -0.39274700432626341584 -0.19040757186746712359;-1.3447897606020935424 -0.74433681743382740237 0.21017901985313725 0.88770271578220516506 0.39748141348758631031 0.65998758837519377884 -0.22428879858881572984 -0.37980856110451421959;0.019624575675692965127 -0.62889318924001180733 -1.8536795717359417779 -0.26644357369429000348 1.8653392782857283194 -0.57683963023990536545 1.5135261640462220889 0.0013659945127028822517;-0.33368787798834292913 -0.57351032183161110289 6.0960018104570536934 -0.76731375032942206182 3.7117157575920272095 -0.006134654263056822654 4.9731644129837775381 3.2824779137842545751;-0.062506526025824252213 -0.9077591339086986677 -0.10976261172843786162 -0.13501851668774550452 0.020985096703681427321 0.82453537339463611744 0.26488373138901649684 0.4024831803072083658];

% Layer 6
b6 = [0.4869144576557138393;1.3327546371307033013;0.29238640220244949131;0.65244755833440171156;-0.78197697597809734393;0.22273396704083697761;0.49124113236138194916;0.5869752346437105972];
LW6_5 = [2.9218146925615195997 0.35177735519930064534 -1.1728718967298352727 -0.90850733586942733488 1.0003467406901920267 1.7733910357293434235 -0.7064265083991659866 0.06102353753509829476;0.15904061028992208526 0.74011964583869283008 -1.0253641693023172188 -1.2806042904614043376 0.22840237527266674111 1.1641721078874873729 0.70317818641566920412 -0.83322120687436773689;6.7128326006851430918 0.038708745396456599452 0.86858725777156620129 0.67668930334533261561 -0.26579782756669001476 -1.0678087969781424604 0.2946052187140069667 -0.51869757603221389175;-0.50313076487416819038 0.60496005468622326973 -0.83427249330948793915 -0.85745535895470692545 0.021567005469662094141 0.013419884241524236354 -1.0013483486885161877 -0.97771404212877854878;0.78614420847487986865 0.89310881231833505467 1.2604065297327025075 -1.0468382709393722063 0.64012783072979762 0.9279501973587752639 -9.3998357870481328291 0.09293943303836731118;0.33082160684581340959 0.11493102803727536787 -0.18947971374589953064 0.031726012274434015059 -0.79316287856805678391 -0.0377964245153732184 -0.32079720449231818868 -0.57884679235908098605;-1.4952976311622905303 0.49330261482584097932 -1.7533365267978249236 0.25377618073444635494 0.63705703201684948933 1.8407121781397532967 3.3837513070328091302 0.29452068523338942319;-0.21920009446150029442 -0.17286216416678734653 -0.35202153198029406678 -0.80775868161788066946 0.18929779123343670744 -0.21590390256253266799 0.050246942502968301725 -0.15589274299985511618];

% Layer 7
b7 = [0.2765005254606603402;0.60164804438788677121];
LW7_6 = [3.2550874085471517283 0.087386202852720126777 4.9910320233259204414 0.31061790686761026059 6.9663453749568695628 -0.23110416724845087022 -2.9790645490317770872 0.80732220348128158616;0.1231703455889584381 -1.6024162997236435224 0.018214645514244127977 -0.18507525665797336378 0.039746187134413968334 0.0019752226100200722184 -0.050430069834414073537 0.15891994474214513056];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
