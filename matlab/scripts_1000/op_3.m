function [Y,Xf,Af] = op_3(X,~,~)
%OP_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 09:54:25.
% 
% [Y] = op_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;2.3531e-14;-0.0016794];
x1_step1.gain = [2.18660485863677;2.375917698211;4.45762514671159];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.5859105646359781261;-3.0001137554714762956;-0.61716819712547665855;1.1093468313298315842;-3.3461615328246372414;1.4199784913361901406;-3.7170802630323263038;-6.8472521979760951893];
IW1_1 = [-1.1709676293118445045 0.73167273511649177919 2.5639121069659394081;0.50852538493715460088 -3.6475620781227333644 0.073857783824626405123;0.37045783540168364389 0.3197113931504496076 0.65105182934667538142;-0.41256205010641139319 0.73790851261789891513 0.92038041032676365383;-3.0620671485427561898 -2.3497936468308866509 2.1324842104722341318;5.2889116718571012044 -3.6183348564546831128 -0.5211214475302043958;-3.2994440281101424794 1.9783767566360850321 -2.6682896973410543673;-3.6332480054768110378 -4.298622399412121986 1.21179489185067224];

% Layer 2
b2 = [1.8645813044371934986;-0.68375660909421098754;0.76606337181926642543;0.40967049990842363538;0.12448598861212950561;0.74855202541620280421;-0.85106613486821225401;2.1690410661643078072];
LW2_1 = [-0.74026178984357771107 0.21478444662964110701 -0.74870209495649286957 -1.2527190833868258046 -1.3206058590430493904 -0.42114616184230235785 0.73719541325329140946 -0.42092733884100119734;0.81950234710406566485 0.49327586529122230408 0.62857448458946518777 0.71718064890054955551 0.67862207251329720314 -1.1634030009604023892 0.85790854353531087462 -0.79464080866203501419;-1.1712613370448530237 2.5300405584660565772 -0.093175840235310350423 -1.4867760315120002179 4.3071388015311020681 -2.0868843114770219138 2.9742272611696272122 6.9844395737395634782;0.22924769085522658796 -2.1135697193108105019 -0.3370989074574147204 0.07041077382131961937 -0.13430341168704620913 -2.9371610294950856179 -0.44518708384757199603 -1.086950280796502355;0.51558568416017502845 0.29803038502069389981 -0.5497313371236139945 0.81267171378591629427 0.52087213888443995025 -1.2362052973671100453 -0.7453027685356510279 -0.032734311713543087774;0.40104932350410193997 -0.36198094080356990609 -0.44660977802815093884 -0.99291540913660270018 0.030960383777883789674 -0.38463212880035302366 0.60866859456849076171 0.27855992142964547398;0.40074065849730328148 -2.6421819957407199908 -1.3363456801235713556 1.074173808451356793 1.5247213575167495314 -4.4865649502106412783 3.3714302984467967583 0.25805674611186196765;0.89030098683575886742 -1.0259256202462863072 -0.44064988354662770753 0.41731773818983364244 0.15813729056584513444 0.46638299762432744444 0.30488225288298337334 0.14962966449950268477];

% Layer 3
b3 = [1.570477136334542223;-1.1976509155017687203;-0.63838860683464115908;-0.41039154979161701631;0.0054522879940300979229;1.046230099891216625;1.3237400453163745695;-1.5673386177485397752];
LW3_2 = [-1.5425048023302625477 1.4591121752423139579 0.67539796423085840527 0.0092528537197554428656 -0.23942695019245152643 -0.38334765455618535768 0.54992291600440557087 -0.76288799990139433138;0.56917581959123408897 0.49802938607514374292 0.47078677331334056744 0.50475857146718394741 -0.71229008594271625565 -1.2976483443977893106 0.31337419764202606443 -0.16415676750260591032;1.0349442880581403159 0.2948048667728964678 -0.83269962352060855615 1.0601100677593733312 -1.3078134896947113397 0.10637538175851851685 -0.55340251692949693485 -0.39949498244841918915;0.17848777795156492432 0.8992267541813551146 0.87201053522489047065 -0.31330822454670298471 -0.45800613898948749902 -0.69097293434359130515 0.27556311388151188968 -0.89125207983776688625;1.0305295242617471541 -0.31383429619500452512 -7.4172951400864084448 -0.36000692998851469007 -0.78363074052450576445 -1.4032007768233871747 -1.4068783881544104641 -1.1107528189725863754;0.043783477151553028273 0.71688356289253574172 -1.019051159648855176 5.2365251300014969971 0.62895533091075384036 -0.66021663727530166543 5.4303727394388365823 0.62509037637361808404;0.39454284862601396444 -0.99900274614958362029 -0.54889258146409247718 0.5334309093318561068 0.21469343110499405913 0.88521445788653896347 0.51108913676183576058 0.83642776432568732847;-0.067143779264483519076 -1.2518944180215305639 -1.3844082034175304585 -0.674925581458398538 -0.30780180272776858086 -0.99304290756950808206 -1.1337168708721327981 0.27451177548232991166];

% Layer 4
b4 = [-1.9360404059713924863;0.55141974447110120305;-0.60174184583204926025;-0.032078481558431175269;-0.077820185444414616271;1.0866999351833563914;0.6258966577562397049;1.7303331355246900358];
LW4_3 = [0.82878113356391558408 0.43028503941823903478 -1.8818682145715182052 0.34968891732357426649 -4.6422715451898151073 -6.3713809787286610486 0.27989446669888312647 -2.6184590770970395113;-0.70613324016916512171 1.5088532281932720558 1.7926479922897879948 1.4727818198293300966 -1.1739418687236007344 -0.084456224536775231782 0.020659273934858848887 0.8700431462355171508;-0.14686882662984182546 0.48345770012423050499 -0.12601972928858390377 0.6506145355483894388 0.16266957732909967382 -1.3259844036429593306 -0.44851272806478736932 0.91427472928030917299;0.35294423494910170946 0.43371275938392533922 1.2134894278882868424 -0.87193660559144392508 0.68782709343052261808 0.19598645460025473919 -0.54500818247923876747 -0.71750294894314559091;0.50346904741823605978 0.59030588906457481801 -0.17463463162761572178 1.3707481893492436953 1.4943243217886381657 1.409508902066521685 -1.0072926745516361802 0.79654861512274166557;0.3187476632888153194 0.40165560023579016669 -1.9274713444037323562 0.47808834914009290529 -0.62575253395090735253 2.4437339346091677683 -0.19288958779146345157 -0.30573218962967296797;0.52032685766822406315 -0.36717486227626439099 -0.21226120390824765316 0.94526014451998485733 6.619347389367197465 -5.295945255091181636 -0.16330636964107367315 0.71417890067239797602;0.73332449007901179261 -0.86187632499153732368 -0.43225421336504249448 -0.45559459826654780112 0.58902189081454425779 -0.34711515845402268754 -0.15537668233744220125 -1.0924195550916420139];

% Layer 5
b5 = [1.44711800374420263;0.73127032220835996856;-0.63057779378255840452;0.09599823853057924683;0.044042166520906839144;-1.2804261493028705754;1.0170582381371040537;1.6662662326590067519];
LW5_4 = [-0.34649992390389783292 1.2367315775396428013 -0.49661963423336724643 -0.8030577258267389551 0.7716604368015536064 -0.74529462998061002388 0.8621645663460218989 -1.1177708559785812792;-4.707460631488253 -0.94680022473430391905 1.7454556208830056541 -0.077748032689748183821 -1.595917882353866224 2.5083108839120105138 -6.220423218317526981 -0.92415930969163184727;0.40602311062173818135 -0.31626231981597274778 0.27493647897837042438 -0.22475114870181447935 -1.1187424609543881182 -2.0157353975746872266 0.51781068088439674568 0.53497327378814663046;3.6546980472987429245 -0.27382969990442612707 0.56318602539862827605 -0.15650602235912666749 0.1052439324100121476 -1.8551931241430406061 0.12117300312575068899 0.79498319962736296862;7.5938697902139100648 -0.46588363539005028802 -0.47170657321185388566 0.45552437491547675963 -0.23594563167780158164 -0.12609195960355254473 -2.2865044145073123438 0.0085331963436529097849;-0.050939510411899868725 0.25927944223096793808 0.29030508173802999083 1.2374008607836335383 -0.24606297700978219112 0.17185804903555310097 1.0027376107730276988 -1.1345959208259659423;0.97044922016030799039 1.1645087972412722088 -0.95702504517661768357 1.4852781980462699263 -1.3866025121054230684 -0.56240101486380345008 -0.1411187539692855264 -0.40476200337858481149;0.44505186665851398375 0.87093668027136361687 -0.53103895197229977754 -0.82915249743066443688 0.051867335380950993495 0.66760926558007827047 1.0122834970888829886 -0.81647554880366279839];

% Layer 6
b6 = [-2.0995671192380309655;-1.3139881613529389437;-0.41233390622302801276;-0.29940674158963875851;0.6384431704467189439;-1.0457799302603978386;-1.3069385100653123644;-1.7953499375202932598];
LW6_5 = [-0.46475626325917029913 -5.1360429408379042471 0.69633904301317761654 2.9176665140271804688 0.55823512460145507941 -0.18410973610647854426 0.70271463072937434546 1.0793513955999551879;0.67654030542381693447 0.14488597863344593319 -0.12415519981965508767 -2.4852670227366786548 -5.6454864493770360312 -0.66949192582452743405 0.8047849555758068707 -0.15076248536706782222;1.0826262462317370883 -1.947999576772122543 0.89909915430433051675 1.4255668842830102605 1.7086984119725965314 -0.54008427502555789168 0.015566869955474559387 -0.12721460744021015343;0.44447925551995626225 6.0034057209953379797 1.313327091693071047 -2.5702637658936637877 -1.5382393342756179866 -0.10689201902725814497 -0.34536720517175595324 -0.84867640190415272183;1.3669988061868092455 -1.507451775228798363 -0.37449923946554442011 0.70248134068226308901 3.3394263532167616226 -1.4582895030810865133 -1.6271386880530285257 0.33848851536442642329;-1.336149818374346987 0.99014432749961067692 0.90489331900766567518 -0.58998596330201891202 -2.4913044402973434366 0.14227014193705270206 0.58543678060334813917 -0.45859451109800541957;-0.098631143757889547241 0.27582442388855260562 -0.24646986263056719357 -0.14011687024192023832 0.17825173143179884327 -1.0109762829008055451 -1.1986654443692614791 -0.82137747581941178421;-0.3922663249817331943 0.93338704969812480439 -0.75100255994821674133 -0.67519660325017039071 0.16381320198373219843 0.72779914411694546228 -0.70775612783178354359 -0.3857874781188255775];

% Layer 7
b7 = [-0.9956247839581631176;-0.28276169665717537649];
LW7_6 = [-4.5339977947685463633 4.9373059663937004515 -2.9514296247734330692 5.7174474155016552501 -3.6591340506078804395 2.7311690997291462324 -0.49812308230375146323 -0.13431344241638040748;-2.4000233678854505648 0.2381250534799173868 -0.034931659995168035104 -2.134284192401309177 -0.46723989007457827904 -0.63722212551341839148 0.0010553434036488726095 0.51702117568436856132];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
