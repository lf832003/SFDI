function [Y,Xf,Af] = op_5(X,~,~)
%OP_5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:08:43.
% 
% [Y] = op_5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;2.3531e-14;-0.0017771];
x1_step1.gain = [2.18660485863677;2.375917698211;8.21601210382903];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9688203780102879747;0.9808588080056185321;1.3255832913716136812;0.091948420840422928624;1.0790248715913877131;2.2573060499793977662;-3.0970898079540565284;4.8168481237468920853];
IW1_1 = [1.0583525325668345918 1.7615393978953155507 -1.5266989174438125865;0.41750653058116449223 -1.6924993740739309178 0.077678001935201093642;-1.0674656980069445744 1.1989279407117086063 -0.8940318566640255149;-3.0951832362458646664 1.840566797155652301 1.6139372833148943887;-1.0513696852736655885 2.3929981023858535316 -0.47617817458933503483;0.64858067401027807986 -2.2514930392660272851 0.090694811343518977331;-1.9666953465530230272 -0.28993290930462595201 -1.1710637983821037267;2.7154095551579273682 3.1520786892135763679 -1.3088508156422709039];

% Layer 2
b2 = [-1.8015149841063640146;1.5305970015878298529;0.37034795473549358968;-0.24455401567656837036;-0.737170271897846896;-0.5476770982200540594;-1.6470274764775283405;1.8144329771197240664];
LW2_1 = [0.24261722962030418671 -0.033959409899434980784 -0.82219835395744389483 0.66984184250634659641 -0.011816562492908244675 -0.37756848115805535793 0.62889615561091372076 -1.2394443965489969628;-0.80064374402775106976 -0.08248439121752147718 0.87754507659039615586 -0.32969620445798270003 -0.61392745366920442596 -0.64304678755110467048 0.16390735133109923805 1.091980536350549702;-0.44748337184020098301 0.82499335200965362436 -1.2631798395065039209 1.8900492619227851065 0.91513600716264098534 0.068196895910805868657 -0.83945784896452491086 1.0795565255047960829;0.013613079361543390863 0.40544864971215999194 0.98478924087406405352 -0.70066744787084400681 -1.1870118522809878225 0.33733047744891009323 0.18556983306913804599 -0.40163267573586924897;-0.18838648011647518565 1.4804900731010786075 -0.41036145504198989764 -2.0297584168439843921 -2.3172479935820224917 -0.45307189989305668432 0.017626278966296097389 0.51269826227205539393;-0.10184293599923129048 -0.032381532522069648994 -0.97555139269970481131 -0.73231302611088699983 -0.033820865568322464045 0.85858697134526407169 0.065939697422201640209 0.42146454696023682995;-0.13511686248274779043 -0.42272696391744030153 0.74729902284582383487 -1.8117115902394786975 1.4632721032454654164 -0.1817471323134912109 -0.62841534363546591724 3.9118580459603657928;0.20895180873008967204 0.66653963920331249504 0.80288161019035142463 -0.051469806694551749338 -0.11634229772336107667 0.57366879283340077578 -0.92555570997865777017 0.97526301950337179747];

% Layer 3
b3 = [1.489240851361259832;-1.3544154534027392778;0.89836546612705103776;-0.065516021341073135686;0.2227073018953452388;-1.0478793283926728375;-1.2119432465765742624;1.8281051320134953375];
LW3_2 = [-0.33730045730000635107 -1.0303290222972960599 0.30635203292873453007 -0.79981813824431757798 -0.60995245005718712328 1.1701374763089336106 1.0387607424544185175 -0.33740227827662405691;0.38647005507590004303 0.61261793103217621059 0.10130251631601004669 -1.3713368487528991846 0.03801135593991807754 0.6923133265121418356 0.92588455496713950588 0.12282776328252091591;-0.44429751713651000067 1.1344454842461262345 1.1150515727398842003 0.2821701799361190921 0.45225477877613251554 0.099008638312819807759 -0.38228114913273447684 0.63198765931646805338;-0.15428527868763050601 0.51601484769649408335 2.424027910132757313 -0.6435770684764218208 -2.0591203006241163287 0.32360641402258161214 2.9361541581482848429 -0.070780888929531299292;0.089034445570121772962 0.8396061413144082497 -0.8565701390093215517 -0.7041842305953887049 -2.2532049222564869417 -0.41073584402170476571 -3.7642948127154980398 0.15247380643327140826;-0.038836849142942969637 -0.15117015218026341739 0.45422608852318580031 -0.51210159545424105421 -0.77511465671487722595 -0.41733913211188344849 0.78314972667245719151 0.86738970448774055377;-0.33806801275801651174 0.73914549278162378076 -1.7223892757955630017 -0.0072696747033803221436 2.5039240174728623067 1.0794924025891314834 -0.46345032511010969545 0.17813671525408983354;0.71622742193541555356 -0.042704594959851280289 -0.39091283476899441052 0.1672723854012731215 0.85498595439340774327 -1.1228563185692082005 0.20425922232600338124 -0.30722956955780772459];

% Layer 4
b4 = [1.7527272572889618374;0.95613807447080412238;1.6799280198571633349;0.28399325538835062943;-0.65870031267157369559;-0.68093190544946491372;0.95175449831489877806;-1.8642976776360224989];
LW4_3 = [-0.99686955709431079864 0.21878054275448866051 0.66651747031267249977 -0.40256739917882744528 -0.47795975848209365511 0.80644854667345400312 -0.14123350167460227422 -0.67361861946194523387;0.74519678824282464813 1.4227546004647226852 -0.50360657701903910333 -1.667509090251778181 -3.3568505583627765709 0.040495107105275505999 2.0923377603152424342 1.4648746357148709762;0.16936581632207356463 1.4243556918260953381 0.85926102391260916757 -2.1960316429119881576 1.5786040861996877283 0.15596628696557776617 1.7228565516710898642 0.062602658254635554225;-1.2971905016288585166 -0.19386999120183029399 0.94770638359991221655 -0.44905655453005688393 -0.10168263498877459783 0.18095730725478550993 0.0021641673681881122039 0.11256646385785765152;-1.5526751805448530952 -0.853030256198681891 -0.72389964743577761563 -0.32131342664149897814 1.1902294162565110192 -0.12242757635936281357 -0.31346241051436296576 0.40042438185188983235;-1.0049885195877836797 0.29061826379835925538 0.65295693014524436304 -1.58441861625340219 1.0507919793943956144 -0.82224912992095988695 0.75639875160832092948 0.24266345819755588686;0.6650384425136897093 -0.088194348925287283092 0.35046739327634923722 1.2589354797003216024 -0.68861927818155277414 0.63626385578646449392 0.20912276210122973663 -0.91578044958203019821;-0.49240168497283598459 0.58412763545965973311 0.66003563521481289911 -1.044756074083528441 0.78218479629647774676 -0.52520877807544985583 0.46066214397589794194 0.49043560948283793088];

% Layer 5
b5 = [1.9812303430396891457;-1.6156683998508230005;-0.82548872915783300108;0.0357493893067494517;0.35665250968118300534;0.91806750246919421876;1.3023571096344241926;-1.8159866858533466605];
LW5_4 = [-0.42830601482524549573 3.0562188626911312994 0.76106377822155413249 -0.20800415556025261821 -1.4772954934701065799 -0.79986059049325752834 -0.054810585593437738394 0.94851798494024230912;0.94809333311666510458 0.66925209536938423671 -0.2543353212033639954 -0.49537566076148625838 0.3574402076161536379 0.65715483216057091198 0.037251107583766152054 0.78619428332043794772;0.40684037809806644637 -0.41454763530694682672 0.24800783615025387419 -1.4614995661097038848 -1.0322847412233484565 -0.36603268950731643328 -0.95577960676104034565 -0.22733963893255612621;-0.18309355249860267967 -2.5641512431767665703 -1.8793316109123205937 0.75238403920474872244 -0.80682154819220675002 0.20946923445486867466 0.48083724499630881022 0.86931527700905952827;0.081760577671035575276 -2.6940611661315290171 -2.9046311707414305125 -0.014730017561457649233 -1.5037572938597061345 -1.9021314157361255415 0.44194278085421673241 0.19808702481414891539;0.83829032484068766173 -0.88256851173114614362 0.46828696413029896606 -0.73290196295775089652 1.0646128382964832326 -1.653000979600353304 -0.2170980922135792579 -0.27152575055889727196;0.84149016262565745627 -0.8564597029956008134 -0.4704830891561031514 -1.0270305917172595223 -0.44651699189316063077 -0.32997743698267600898 0.0064076251236149682142 -0.58965833781747811759;-0.28926967327509811589 2.4103361459629373265 -2.6565244239941114834 0.49572641141191448044 -0.25383257481059146032 -0.38299554786406714291 0.95812710803730649634 -1.0189009865480085359];

% Layer 6
b6 = [1.9789144074390712102;0.98290579867941685333;0.3205395565020563442;0.28121690485506140034;-0.51947437416427311163;-1.059898836737739769;1.1783176233414143219;-1.5173326024621658359];
LW6_5 = [-0.39013460846094177858 -0.081766570929121068501 -0.35125473649654492814 0.13061397896531559693 -0.55784904453944050839 -0.35177188069702991502 1.2703976835166452819 -0.89196227642321301854;2.0807741194798237139 -0.80274800868327222947 0.37961862235331422788 -2.2901946591010307053 -1.6558643354679634108 0.05045111806002888083 -1.2998431200738556068 1.255663956926408753;-0.92889352860184859484 -0.57633380421354196699 -0.96668687227820859764 0.015009038064637448759 -0.41234913855315297182 0.99658498708093024021 -1.2020258178151337347 0.396928928498558653;2.4268347610875626863 -1.0378051533420076247 0.98028746440710967658 -1.873967695475623918 -1.8665850309214406799 -0.37878533927398549963 0.23945652145811821554 0.7733541035592789159;-0.84055248035540630624 0.66272510661746397709 -1.0287089751355682488 -0.6667349519563638971 0.78100429730346576651 0.018914114559832193724 0.84502122139612612095 1.8176378734032585527;-1.3223687408861382053 0.74951260115206075341 -0.11863637253768626045 0.26105215331983544491 1.1082748073862473959 1.0409450838821008301 0.97210612382658112551 0.92777803340555176081;0.43657009510834532406 -0.33606738540480224353 -1.2546547557148119978 0.19695115642201255213 -1.003771986161211327 -1.0772781832435589511 0.062190804337025042126 0.25833824561303059264;-0.60091870488631193847 -0.14189163398026166663 0.34718017236705928097 -2.1743604671761391778 -3.7198624023032866859 0.99448000384386547879 0.53436263079398704789 -2.2746267270365905233];

% Layer 7
b7 = [-0.7297368045489642796;-0.60926613913462757122];
LW7_6 = [-0.56780647585378396514 -2.2758939850512236447 1.6261467178389197308 -3.2821364053348869305 1.3900097388573815493 1.9377256356047722896 0.22350211249619564291 -3.8261975671241112984;0.43995519436314189932 -1.3172737428866947429 -0.021562844602606219546 1.3953448021123371348 -0.72568510672607577927 0.1612946256736919326 -0.56392319365300747069 -0.3617624583004974137];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
