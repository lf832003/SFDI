function [Y,Xf,Af] = op_6(X,~,~)
%OP_6 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:15:59.
% 
% [Y] = op_6(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;2.3531e-14;-0.0038859];
x1_step1.gain = [2.18660485863677;2.375917698211;14.9503759645796];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8814396960413670712;2.0813496958708594953;-0.57125159942730674434;5.1299188908416821775;-0.27099985091889050581;2.8564542910990082802;-1.0196220832165785453;-0.0076519667223492434174];
IW1_1 = [-0.21432445194405311262 -2.4924383773864775549 0.74715261226546980655;2.7777105116057723144 -0.58363105834870965261 0.026861823585622578159;0.13044504596609457492 0.89229815236617182617 0.32200856416071438337;4.9926034471455338348 0.56550748704769981945 -0.4434901047443148836;0.85279612627672607417 -0.38822632845619103881 0.47761245964633314287;-2.5659048564947326554 5.0222803684837549199 0.43056395402767866365;1.0243612188317754441 -2.3108797725935348311 0.056206762752217802326;-1.3030932578273066724 0.30482589303878926401 -0.11155152771066645379];

% Layer 2
b2 = [-0.19799947047112384513;0.036439347905203992029;-0.87806408029865801179;1.1135982595874396317;0.54629124653116878374;0.11806066841751040875;0.60248353477145077939;-0.46085173400190354576];
LW2_1 = [0.31356281177366135404 -1.3401857202875444575 0.32352372034966675463 -0.44130220341732284695 0.15676536317895023442 1.217640678976563251 -1.0694346686623354969 0.63487868891309395813;-3.3628345520470714902 1.8041733422681787147 -2.9137237356838578961 4.4749589872946478053 1.8029208669786620511 5.0974409816642793913 -3.0231914563827255726 0.14603324474804194044;1.2844253029225338736 0.78510191676594320853 0.64870390566666158438 -1.537107690172844654 2.4851017372740593636 -0.98879862286403263916 -0.493109370941848979 0.48666843845045770767;-0.79640769139362410645 -0.99095317132883220523 0.39060340505388296828 0.11378430811776081566 0.78255038656702902156 0.58194392957539586853 0.05911947042732015184 0.26576815130648556718;0.23830315589433342938 1.2726951458653017468 -0.094288632447957293481 5.8694876960857644832 -0.16809942730428312219 -4.2607384463099728933 1.4429740281776237687 -1.0241926854178216022;-1.0800162671068957998 0.49794954344170722083 0.036952347192147981525 0.87512807958000315978 -0.11785308566799664043 1.1013273280184796565 -0.089594301377657475927 -0.49301799118456474114;-0.42940461034188170952 -0.27726846460023268914 3.9648501159076317002 0.11140341297333455906 0.39621297125289511865 2.6690173817164244419 0.73176232571904875623 0.63510886208704941946;-0.053060158889627229151 0.87765840958720897635 0.2542172092982126208 -0.35805897009866072267 -0.099723836473630783628 -0.110656928770730828 -0.51592079643875499162 -0.35438190480614961686];

% Layer 3
b3 = [0.56025972241089294634;-0.98346949294799834718;-0.30318450056196466491;0.69681252180687136555;0.043023807306458515531;-0.50697461586631942243;0.50817971972671049929;0.34379048067452849802];
LW3_2 = [-1.2202197046852143458 -4.8239006471408423238 0.43927323800798007136 0.47592139924510673543 -1.8857577159513376763 -1.3913101475078641922 -0.24984587216929926567 0.9944411343095987954;-0.27318348563844108146 2.9152092798997211176 0.19165356751161902182 -0.55602321025301126856 0.0016488655991852274856 -1.634286943353460142 0.022195970974078209348 -0.52775476372627938559;-0.87148630114771308275 -0.062975907108573800364 -0.9634726586155550887 -0.25283430375611420926 -0.48347486373663461912 1.0026541753522622002 1.2194908969510129815 0.14097600320349770731;0.28564408246468803165 1.8188695984866691813 -0.23338941560193782188 1.003055855577970723 -4.3103633838682533508 1.7178516078839332071 0.29991302347437692744 0.017741343829081056976;0.67927608316173904157 0.089361368822152204006 -1.0737153323651822401 -0.73191993057175641635 0.27197586866338829825 -1.8348749873817791212 0.89999250737348290841 0.048237832846463435388;-0.45323029243636064889 -3.2982516613304109221 0.0020511799198257422462 -0.27976460684791876199 -4.3828846834066155225 -0.84671056642711040041 -0.94190220276743374939 0.16232295400096422022;-1.2004715038459441434 0.20996294343639071434 0.36699717635450862518 0.51749372702452112183 0.31465100149525659923 1.080435967463742708 0.86911187386275368105 -0.52733912524490333951;1.823876527327713104 4.6165052496695011541 1.6115493330743944078 1.5467587463254266478 -3.3858410149405266942 -0.97334505984176067361 -0.23755717012656304976 -0.31636691160011759516];

% Layer 4
b4 = [-0.21280006008570151455;-0.38647730450684486536;-0.1334286752655669539;-0.17766638696794806451;0.36776219566520068627;0.33229370827298032598;-0.031464880925284814672;0.19462691530833095555];
LW4_3 = [0.7141135094082543544 0.013967635531786771683 0.73592378122961188414 -0.2706496470840176749 1.100643026776265021 -1.5413586665612792892 1.3806612140326530724 0.30788382486459292542;-0.68820128213876385903 -0.23244898781807152299 -0.13321714159033379299 -0.56240483959002751657 0.30554078519230437605 -1.2440606195309591442 -1.0220874616570940763 -0.52136870593725137546;0.86149419036802532545 -1.1133653263898488639 1.12701480490210737 0.97731217460865937863 0.83269855519714996994 0.15926718614685403397 -0.12955977195378395872 1.3563296602236707411;0.4954281849070870658 -0.93166212330532738317 -0.30696891051077512813 -1.8721673098338900143 0.39519192637301364668 -1.128001769390247544 0.42618967645649424858 -1.6831137770623747496;0.099861596060310475753 -0.1811562719980268632 1.3012569322174161179 -4.4787812414023528973 1.5358174139873845832 -2.970927463126214807 0.10823300603453456237 -3.5503136604257052866;3.7926972532267764215 -1.6674990141195886739 0.22745017275550366564 0.805289102163073367 -0.72086598425533077172 5.0678680970943794648 -0.83094990608289498457 -2.1891525722370590579;2.498839426131919339 -1.6149280623817632296 0.32928332768793516783 -2.1934758055275680455 -0.0135590094712189288 2.5460471981279373388 -0.52436651349600149619 -3.2799642945831313234;0.8658112069477710282 -1.4955409777654675718 -0.33057432299786893015 -0.77598588005631741193 -0.14146107572886706949 0.24130461874492664665 0.69303495560285865995 -0.62934629682769593906];

% Layer 5
b5 = [-0.7166731241561108412;0.23520471218178198858;-0.58356501269386662489;-0.13297610418904248775;0.37112745586946543908;0.26215519601600245636;0.16798445620471683104;-0.51362640560435302017];
LW5_4 = [-1.6436268992145746104 -0.92001738450977021966 -0.016026923309180651778 0.66088312193285836393 1.3263397213710352851 -1.0925896217528223708 -0.39130534646228093409 -0.15618688666547503319;-0.78501989947552985871 -1.216237831215757792 -0.3221672163705425751 -0.81984259452124674805 -3.1496124923063093526 4.0616672556116837356 0.30481242403738706415 -0.1425922815051930137;-1.1873243718041586181 1.4578143232450551103 -0.40431151450887897747 -0.33208846449464307637 0.47316565859133841165 0.43592605527895184059 -0.70716348379294380333 -0.35887388880024295723;-0.6452687722781584867 -0.67105022222181753833 0.50056635418363992773 -0.2064168485679671039 -0.94718103007722687092 0.37752582327515432636 -1.2552749902142039673 -1.1969145047065716803;0.51983252759582931901 0.25610301002938606896 -1.1427334919923972656 2.6153192116007013546 4.320191939004311088 4.4308063506297292733 4.8920329651827278994 1.5566465934119586567;0.89665596568215333306 0.0011920932567902858389 0.047179067604787350287 0.17170007994757496839 0.75861127221369750728 -1.1287963321065295208 -0.24736787210701682849 -0.059360223254889953048;-0.14779236519691643648 -0.059794283802553194196 1.3729612821930261557 0.0083534474094825120899 -1.1417353970351054038 0.68396570229161446353 0.1631523755096240258 0.3002172135002073583;0.35269482414178499052 -0.82423568412184899934 0.60945743737128921236 -0.1132276328487369782 0.15226504753099026623 -0.43304367957113704124 -0.22380213308565227726 0.030163234949965946757];

% Layer 6
b6 = [0.15750914390581277624;0.30368492104525063313;0.16758395878946671931;-0.26364489076157027192;-0.9924874358214179626;0.29339571635491462631;-0.70808906996173615056;-0.68607754451014690833];
LW6_5 = [0.52153696014214279142 -4.5365458190584710962 0.8560635046878165566 1.1500676244172318707 -5.3551369314668368915 1.0226031058778590754 -0.54616366830244533759 0.62448469525189786999;-0.07412212378607641039 0.38946597730441706586 0.50328768117214350841 0.51687358541353611852 -0.49683490832495541545 0.077824421966224882619 0.5698442823667857482 0.31667312504262817852;1.6182020323922303717 -0.47454494026626370395 -0.71025969122539722722 -0.51436696121042924101 -1.6496004261912720068 0.68259045174481558504 0.25328782761362017562 0.50687934197310136053;0.13441513498200668986 0.66195065606047254203 -0.45042441044942144179 0.31376347959925338094 -0.84636145112379301825 -0.13431809562619148601 0.89260469206984882629 1.1800072112474910835;-0.22167310859013678037 4.6906573466922898419 0.94897011477842296845 2.2648021220094562977 -5.5386011064191702502 -1.646206162843774079 1.0702739715828972766 0.2317138776370730735;0.23344976959467406141 -0.85528529522002771923 -1.0003744729183703388 -0.55920724842638036556 1.4324824989050832791 0.61506858397796371207 -0.22681310425513154239 -0.49551642876253426673;-0.54091893828438930569 -1.2164792477476442656 0.23592169913553825977 -0.17926923940562647375 -0.38517859073738380804 0.59077563458420523368 1.662967059452867602 -0.079179940327192444016;-0.77207440143569949775 -0.98790564368655198191 1.2499737003975157634 0.27702059713812993147 -0.70575688190280660983 -0.51497350532668639822 -0.59681323827054511 -0.15745906336623546884];

% Layer 7
b7 = [0.33445864319513185503;0.30883520855595542054];
LW7_6 = [5.6951699283486103553 0.92363656847271224937 2.0955845661719276762 0.017729215351007809182 6.8495968403468658892 -2.4463197496952990839 -1.8140494844624368564 0.409187492337694525;0.19215750094250383384 0.53573720543240188618 0.11557621543437879286 1.1197101840562062591 0.17715100480379797343 0.35483104700255474473 0.13359740257430832711 -0.35702202161081830756];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
