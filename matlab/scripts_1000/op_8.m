function [Y,Xf,Af] = op_8(X,~,~)
%OP_8 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:30:15.
% 
% [Y] = op_8(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;-0.0016794];
x1_step1.gain = [2.18660485863677;2.70888921997539;4.45762514671159];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.227683844226561849;0.34889949237804840365;-0.28503324802657531434;2.1797110266035875092;1.3129777717217754329;3.6226852730735767949;-4.7154206863733740818;3.1471548044816750611];
IW1_1 = [0.83051345182350555518 0.1270984637881535928 0.29572577495719631901;0.78131184329536063071 -0.094791583854895181127 -0.44658677450745809523;0.8861154192723810219 0.19110440420627139435 -0.36856671000360430313;-0.81875414921103073507 0.13010108498540112754 1.5519716168194830352;1.5848933485336607063 1.3807876566420513864 -1.738734663827833149;6.073552677841790981 0.21097510130855662291 -2.7934341661427493086;1.3560044574959237984 -3.1377521765513449736 -2.8316353033394610073;1.1690580425111405383 1.8417788721009165087 -0.010418669710912461038];

% Layer 2
b2 = [-0.72480215185293384028;-0.19723852644080352992;-0.69393820453187282649;1.7802195882894873424;-0.40578559660023566513;-0.44132282504342890128;1.130858130608429768;0.13427091133360799513];
LW2_1 = [-0.012032359346010223361 -0.91936869970067092162 0.82216266988073039013 0.15151297610680980466 0.12994893449637787142 0.28793564489852480071 -0.052774307822822767722 -0.12070038853430968551;0.91918250619658137257 -0.85314871353437915502 -0.095745950967906903739 1.5428753621844593091 -0.35910783990689415512 -0.70268052397601621362 -0.56381961688565362945 0.49177354841574333344;0.9830394696818566258 -1.0719111733870090308 0.79626649937737503659 0.95198981488726330813 -1.9599675160332237223 -2.3748861468712174627 0.38502769090591421053 -0.21601730275388542069;1.9300178580157067998 0.52592251745733797907 -1.3215451026478155505 -1.4838850411499466819 0.76595630916797774468 2.1039050171822033519 1.1380621195826430281 2.8897315915871586434;-0.14443913032269667385 -0.71031451587551242 -1.0906405091936097751 -0.51358093475081678658 -0.27146102997861698558 -0.4468169259477135502 0.12734500457563199816 0.15289325545337625889;0.35173982393006592018 0.0045627487458104578136 -0.50909107143446030719 -0.45306611713317618273 1.7592653383412417689 7.9565750125993783826 2.332635553481419155 1.6952970551481059136;-1.7945798992616099898 1.0189153401715309588 -0.57264033297591332428 1.4233426737043723964 1.8618973830540048731 -0.018368533882322953671 -4.6911306415336300191 1.3887910966969245763;-0.81461895224317226738 1.7647005033152056708 -0.05241793317134654101 -2.598078315564142482 1.6999010934652549754 -0.81657692661017255986 -6.551732796052188057 3.0079838079291860709];

% Layer 3
b3 = [1.0886517521428933364;-1.6536076628088696161;0.67770111430674184749;0.2748501641679123586;-1.1009333680200485972;0.38135480684235784077;0.49035262707839061269;0.046964494951524431154];
LW3_2 = [-1.1122001793450175811 -0.45582359671120420419 -0.019876200813006821705 -1.9527315882571198991 1.0485752558713341553 -4.9785866168973660351 -0.038420892349510356312 -3.922227778542027643;0.99099247236642218351 0.76134985128460053172 0.97626749132944623533 -2.4526999443747392604 -3.3686434522290453764 -0.60972121338013696157 -0.29428442314026870275 0.27827634779144955202;-0.85451225580494927225 -0.6072772539381685597 0.26085197965004786047 0.16246455848260113464 1.5906855516496014591 -0.27425206795847562047 0.48812134093534559343 -0.16443063069518806807;-0.063880348207820125683 -0.26650610425882564902 0.05383845479170051157 1.5801297773084266307 1.3192767279357724419 2.0889310271526198015 1.7271600748567135231 1.2377897844352903078;0.68330907650740679848 0.10380790896292438341 -2.295160526771765408 1.8983201375378266906 0.28257689638860578052 0.611385914247244866 4.7741753301025280365 0.93811224415089866646;0.29446700033439648925 0.043924981366445334241 0.78107917357238154654 -0.22378173881466631445 -3.1860657062297534914 1.6536828711359798927 -0.24025108697857563977 0.49846027218568711437;-1.076220367600847716 -1.4934579544267378992 -1.230165411148113952 0.41705873028766360378 -1.3416176354540076954 2.4858530553423530129 -1.5386407418517438206 -6.571792031620325325;-1.106789086993649196 -1.1275261409593935191 0.34667838652067911598 0.59563360748276283907 -0.77710350936156846746 1.4259378930903319205 -0.46386615945611758827 -1.3059280114860056798];

% Layer 4
b4 = [-0.35789678965809335054;0.23667953452329032471;0.10784365982953511565;0.35889296784185764633;0.50475667741751306661;0.12574512806995402636;-0.24374481468609357493;-0.4925158745275354244];
LW4_3 = [0.80623723304489813835 2.3422665562163711428 0.47158698709560586959 -1.247092026375930196 -1.4213550903393430414 -0.74350500420252652045 0.87249930865140212788 0.68238387961084356892;1.1695297716046084702 -2.0091246190104694591 -3.3236889200393986421 -0.87081531263637179663 3.490330770828748097 2.4500998115580250314 -0.7178472907862819552 1.5752556670229573843;-0.11944629020182657986 -2.1012172509480508964 0.026924204589333117221 0.31936524676679312051 -0.54810965401146660714 4.5339223208287444677 5.5456144250650334371 2.3754011557450560588;1.2748057280174813766 0.81798478242058403342 1.8190446853096478019 -1.237251598977767264 0.21101588872357773807 -0.11225710283583936744 -1.7336323199721266342 0.38930295659234376293;0.78626362522520099052 -0.46254024520031788992 0.32363863113353152912 0.57107260629247202921 -0.29484180656019493005 -1.1999229513567168937 -0.3128772887501474198 0.43431368703528056008;-5.9892431798800744858 -1.4408584647860116501 0.18806479464813172231 0.22039087086751119049 -0.56184982544232819901 3.5989828084044810375 -3.9603673343979273191 -0.38696274122985674371;0.85370794964082552525 0.1259415739817474067 0.68099115141950039565 -0.14394642182649630691 -0.56187160194325846962 -0.55536051511070494424 0.39457199435681800104 1.7067707250528221241;0.3859482265370768328 -0.5408284903960790535 0.60120025172480373588 0.53699589733390651336 0.078737563052193842994 -0.7938929837239316889 0.39214931827631471783 -0.15982004863223606139];

% Layer 5
b5 = [-0.1366435567944252194;0.83893976019406157896;-0.70091426568690085031;-0.54191289784845386723;0.61667741240319151608;-0.37445874758229480417;0.31958779920600183244;-0.77775223060004750053];
LW5_4 = [-0.28372770456179940979 0.6380265291387784421 -2.1900939603892388696 3.156559170128947045 0.10118164131968410135 -3.2226644707729690253 -0.90193113629770305106 -1.1580848014975211324;0.53528046830760878105 1.8293387408905101843 -0.48151241745758671664 -0.1055348517479531012 -0.73453926663849633538 0.4047735197223874537 1.3684950552679326918 -0.031959953911938600302;0.36748984850156207749 -0.79768306121275700526 -0.51642093522952947637 -0.27643427227383599032 -0.1755913305815140768 -0.36496250034696597897 0.052897744174173699783 0.35875451395097390783;1.2686734618926924778 -1.6767801804219737427 0.15656761473092778436 -2.4036616616976682614 0.074381569790443802237 -0.22117068131801731479 0.82799554949934150994 1.8325399754666549246;-1.5926391271350346379 -0.90925359369391278719 6.1300046647997090687 0.10723003130112405967 0.96474538128343945154 -5.7935333518680982579 1.4809379406029383741 -1.0068237005102391723;0.20635583063660961622 -0.60167651024711754637 -0.38529058144530170527 -0.10435712664806635896 -2.3357611894292720223 0.045701368594739617823 -0.26349383620073579815 -1.551510276035615421;0.32644556774310773406 -0.82387731811069142562 0.16391851317793673659 -0.34676785068060439476 0.63261379375738779895 -1.0501701633345303932 0.85870845952446295257 0.49515858113194011203;0.65387197608992431164 2.080553468718163046 -3.977872960939691005 -0.32219155215565270511 -0.74555435095363264963 1.5907116075640701514 -0.95833348109923088831 0.0063104363381316563517];

% Layer 6
b6 = [0.40036101081528252532;-0.065457663907410368331;0.41173516458555647901;-0.10141649256045506822;0.47604287194276062589;0.59827021089497067763;0.73234212661012743073;0.19123743872906467933];
LW6_5 = [0.015335764162801890018 0.75592883023228796269 0.64547772623709365192 -0.45826687559164347441 1.096506443845944645 1.0612547377447287822 0.89437972800738574364 -0.58546847855619799095;5.4036823858161646683 -0.21826569601539869137 -0.72412179356408734598 0.58936907459600118564 4.0346259470588474727 0.85249280048458220271 -0.97665598904210348952 -0.5509498743542350363;-0.70747170445035489905 0.16453850037256623207 -0.10906575974446909572 0.06894186079462849559 -0.70129161655933591746 0.71412212610532344037 -0.45764350417184235242 -0.50702186414537075976;1.0917397792674663481 0.7794464734062657163 0.15870914721087633903 -0.26454922227886634722 1.2638981163244988881 0.22808983248990657988 0.93047750708339127534 -0.27886394502742301027;0.91363467118344021678 2.271438381433636966 -0.29245755653719363032 0.73785550194040205874 -0.93659326008857357593 -0.57356960143471835689 0.084365855174901832614 0.31270174630874919552;0.35679668161140581928 0.35435463411128670375 -0.17891554070086262973 0.94700560514609399831 -0.87411434300955792587 -0.69157565301232437616 -1.1953970872240442525 1.5145611566799763725;0.28965727078908681813 -1.0300195045237130476 -0.38404062814927403258 -0.32058814369427124369 0.35721386630063250989 -1.7738919847375744787 -0.43189181777304952448 -1.5574603526392265529;-1.5604771875475584864 -0.49703671967469181814 -0.46934907893015193059 -0.47346521073673802915 6.867645011660407306 1.3807942013060332531 0.82486015106221399762 -3.0917723295001890982];

% Layer 7
b7 = [0.65891735372819504324;0.80545129723220831863];
LW7_6 = [-1.4241937432983047263 -6.2382610741362629625 0.63619899962600223731 -1.4381254419679527778 -1.5518154006075273177 1.874033934984162153 1.7044833831975385596 -6.7362857876533581702;0.91116048359992707351 -0.034964896589478655642 -0.90859697414926610115 -0.99954654636960749148 -0.10185243598395378462 0.41501496265796777863 -1.5342340181362021934 0.018285142704422677196];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
