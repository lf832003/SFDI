function [Y,Xf,Af] = op_12(X,~,~)
%OP_12 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:59:05.
% 
% [Y] = op_12(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;5.1291e-15;-0.0016794];
x1_step1.gain = [2.18660485863677;3.51660717739528;4.45762514671159];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.7129403339867184108;-2.4823314239972282813;0.78294506282797127206;-0.68634705629548931061;-2.0734089848395789168;-8.3825365861342060469;-1.4082620233538680754;-0.17258054224393323817];
IW1_1 = [-0.16862939967512194372 -0.9139377356407880626 -0.79624513485985037864;-5.6134065149724943211 1.4512703170630754101 1.7606754932356560861;0.050997604413193807493 -0.20471556523856249132 -0.52244546176431105877;-2.6309417082509582997 0.44389064599540023481 1.4621234208940598887;-1.8885023590775846802 0.40762412176421997101 -0.71815789028644272385;-2.6481946207942272942 -3.4412864891961372216 -2.3389972108882814972;-0.0090371914162768237494 -0.43777721864147001174 -0.84231714901708898413;-1.0202504398971510291 -0.56735609208795778624 -0.23036122577728995742];

% Layer 2
b2 = [0.2355167920734835274;0.68239816043934831136;-0.24998651375580993594;0.11278169271816734787;0.13871475504208938268;-0.52097199538929606089;-0.78233857577942178541;0.20131056492156190751];
LW2_1 = [0.16145070387139476287 0.61244822014986066705 0.043919104071722128713 0.23565868374493245674 0.5175130446819106167 -0.10450397238537315059 -0.36048227949813782534 0.13992253427115336484;-0.60190247650962602766 -0.4580849343603591306 0.58306040112545276521 -0.29303609385482637384 -0.24402432217292627237 -0.26151757625126792473 2.0316053648527439002 -0.02510091916759877792;0.68507887741325734776 0.7741348216276343619 0.60716487084366155269 0.21873672343937100582 -0.13342314183624875978 0.063884283643976483291 0.88970240087196950096 -0.24015512276677156156;-0.18061036050592485513 -0.82824652716602320535 -0.12404617028593337147 -0.72740738568803231523 1.1977125371700889644 0.49168147382434795878 0.048907957580389398167 0.19685757946540555219;-0.51408646578112082715 4.7920703459523323886 0.39380970918084534649 3.1183604823556096974 1.2424887036372229687 0.53823125984192421445 0.64770513534980311832 -0.36645815067645770569;2.3269603905665570132 1.6636288565703509779 0.26745528807526969262 -0.053799439272893330444 0.90402034784996487815 8.1437103490512061654 1.7614579914473458278 -0.12143524011926035144;0.20641366858225232428 2.3845864628895645509 -0.45413940563513255366 0.91431167141923364028 1.5014788400612049113 -1.1477666411507285726 -0.68787892644130688158 1.0734581800289122455;-0.87135607817411697695 2.0108241025788204936 0.018282772174300163798 1.5310491809338981906 -0.31483637329268976401 -4.172954246315875082 -0.77458165221298791447 0.15519668862943397647];

% Layer 3
b3 = [-0.57695662769332023423;-0.3535843105668732278;0.85603383599101090518;-0.21410614559357257769;0.3866548527498975818;-0.45178082058614715821;-0.3348492162520412263;-0.14635361729598489466];
LW3_2 = [-1.3858192987206054969 0.60925233323134675434 0.67693770825023846793 -1.1396124449257543088 0.019247291894279140029 0.23941332826518690879 -0.76199729163053908643 0.42350413064025760335;-0.32624753529502664717 0.51288439466726221116 0.0289481743419891073 1.072007076419238869 -2.437617060286818127 2.4599240936343975683 -0.98052014542290466537 -1.8291340344283451014;0.45505932193357928606 1.2706461409092275616 0.25769360021899284652 -0.28484982639038464169 -0.56155974293605859238 -0.079759322746225019829 0.330908274552370818 -0.55640405996380126741;-0.21220126403037711804 -0.67173051936993533051 -0.66183534476805072622 1.0037465539179777352 -0.14539307401126785879 -1.4348834330700119821 0.051715735751655701746 0.020904063463449317622;0.45585278013537500197 0.65578449727658960633 0.81452422657835643616 0.69402785408669132039 -0.27433422718996847145 0.31087560962487548188 0.96263509567735261463 0.038210815595714785198;-0.26636911791034922903 0.60353764236240314833 0.014763240788620884264 -0.36078965296879017544 -1.2066804918657492163 -8.395558555749552454 0.88011794162913392636 2.8731283335596478068;-0.43931137170930029123 -0.4446404785211257038 -0.39397380498010242666 -0.52735734132440137412 -0.67860666091637289465 -0.17767767101527698337 0.22898812508979596303 0.67728328803776194356;0.61648551995065536957 0.12572696920364051509 1.8299950722674189763 -1.0173203553405332222 4.8039131795620004795 1.2846204254868989203 3.8111294789529903682 3.6299228048883764863];

% Layer 4
b4 = [-1.7091499882118399434;0.61928300085192689028;-0.10039435790690154349;-1.5741124899192473485;0.49815039902371532898;-0.26778538075884339431;0.49868274442690996295;0.36683025860491613734];
LW4_3 = [-1.0794618743917392401 -0.23399316935259154016 -0.85177050770963014248 0.058435331752217968548 0.95399889918834213098 2.7380131126750875126 -0.72440173122231910074 -2.6765566801685936049;-0.28507007196638084467 2.5056219290663492849 0.91983566750400946876 1.1174086104411267151 -0.57504233524729764238 -0.10227746632550493988 0.92876357312940605038 -4.8340679612101000728;0.12558001585938571854 3.0688184173914625497 -0.76985808810793865398 -1.7200199597438392551 0.53664702771628602918 -3.8620604029366329968 -0.42313127441365122605 -2.2608346385930282452;1.3268966595144793263 -0.83285556228657997568 -1.1458707069201674589 -0.7069629750458348294 1.2555404295014478411 5.4080213846340043915 -1.8896415181108816572 3.4731786209655912678;-0.4634977474954593557 0.009813406926492374352 -1.0187989515833115739 -0.14293507113061298952 -0.62118713926239355061 -0.32166962319891911903 1.1539121736103998828 0.1609407881673205476;-0.75666453258124299897 -0.84560713859600011855 -0.017333270384987761736 0.34336673308604909183 -0.63876358626975893173 0.47655406555336399244 -0.12182630114772523278 -1.3202971642475453962;-0.60042179639688886272 -0.29491919400222638137 1.1403385880928291751 -1.0581206098220483636 0.44270459304712911353 -0.34176131737739917638 0.0084269529445840096749 -0.5924162783573301283;-1.5801365612313302833 -0.033359131758982314697 -0.037424237744245719695 0.32101886967113107962 -0.65325666150041983293 -1.7239660639980967094 0.24548412919511503061 0.46032212465797023304];

% Layer 5
b5 = [-0.59652392853624136571;0.33795606096371594296;1.0768325348136278397;0.5883939684647331303;0.031268398232778334134;-0.35357403700072220776;0.21394821794737731158;0.25204613690767069256];
LW5_4 = [2.1230931400894896832 -1.5829365348341219999 -2.4539903155427347237 2.1360230955575194578 -0.1863118813238518745 1.194821022736106686 0.31239382836915435826 0.80751413804978267041;0.11659882984613278989 0.29379928936711047216 -0.03722212873378625414 0.13573495655704598262 -0.44985823333551921976 0.020261639707868782379 0.32743331327730051949 -0.2996223268410027063;-1.3197972016667918194 0.3103759108056939886 3.6892242575813258831 -5.7137691139882074154 1.6630280166230639871 -1.7333364024926025682 -0.20693615963072709008 1.1731488994801855252;0.8997772632241182178 0.44011877055459558417 0.35163041481417234291 -0.35622591313804785607 -0.13483869330009332077 0.93351319462567228236 0.49833846494069988786 0.41359199343983049646;0.021997168090031094662 0.73019697679348161135 1.785088592176956368 -0.37511486603591959188 -0.92432940946171471275 -1.4184357027766338888 -0.51303870586596023173 -2.08857179437623941;-1.3582537719584981684 -2.4137501328301413928 -0.65012372583110811242 0.49315174529444666396 0.3281960724444819566 -2.2151706422438408595 0.054743926019152719387 0.60154171878056050815;0.43498482022244139289 -0.031477211145711676832 0.12274979501910192325 0.2056823396037302798 -0.29365513807477300334 -0.50009426661110123469 0.28704072292766008578 -0.062225037263052056236;4.1412891356189254211 4.8174303429388025677 3.0833051489371143816 -2.2503417700384051869 -0.82276948199097443837 3.0541891275143027151 0.76849547257798878075 -0.50868180791578743172];

% Layer 6
b6 = [-0.0017573948385216572876;0.4048352556079319875;-0.26478810310779493653;-0.67050898566176053706;0.40436771645303398737;0.06179158226131088727;-0.11505367509171242346;0.6137441128007053992];
LW6_5 = [0.51366421921422777963 0.026462366585873194763 -1.3977640630040144565 -0.0078174797696726871371 -0.40639069346603817756 0.14803822890615553343 -0.020054170233400961387 0.77399988942720776564;-1.55434373909872936 0.16768406933596252673 3.6135678409653291254 -0.11733893899180494746 -0.10197996549406225519 0.92433523930159156023 -0.088944590680180693476 -2.0924408239196363724;0.56122236936797609275 -0.46447348507075814084 1.5932574217403794314 0.14453521826961315822 0.16203380160708419355 -0.35659032577447830059 -0.14188411652240792704 -0.058647723302827484138;-0.049256960702806454333 0.15456182228403933521 0.090762211649063853636 -0.61632913281818280105 0.046093033241994547933 0.20278622772771259797 -0.44816513634038707137 -1.425922142435783524;-3.4778201548505833784 -0.12635857109911868834 4.8987223680524323299 0.46465896679301027516 2.2150362644539320911 -2.5483591532119889145 0.15622742857746399481 6.8442123834347770028;1.594498594471320807 0.040201123914579757479 -0.2421554775801735282 0.073642369041222607851 -0.53459195462326225545 -0.57838481875598490856 -0.22316877748005031767 0.10920715557529721285;0.1480871791869739218 -0.43651103766206356127 0.14509484117781662471 -0.52889467476223117615 -1.9818094171102316192 0.70023953242329606272 -1.2560377181470609997 0.38306637558398376475;-0.29602679243135476828 0.50743431246050452188 0.082214788701030397378 0.31866950503247520876 0.19090586310644344636 0.043014327757719079959 0.48542876028148435053 1.4196057294634869539];

% Layer 7
b7 = [0.60009430023811205501;0.0059911958276899291223];
LW7_6 = [1.7641339326657718978 -3.5725554319073862253 -1.5906551377457216478 -0.89364742161631016693 -7.5431819023779418387 1.1300399790412907208 3.0622757005671012998 0.46323896129697311741;-0.5080022936854274862 -0.12666771053563113947 1.4005708260438209933 -0.033844453111341536722 -0.089736728994195311127 1.427979412092748035 0.47602859648390893899 -0.28155904907682888227];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
