function [Y,Xf,Af] = op_7(X,~,~)
%OP_7 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:23:12.
% 
% [Y] = op_7(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;5.1291e-15];
x1_step1.gain = [2.18660485863677;2.70888921997539;3.51660717739528];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.8334493188860783164;3.0776780728936050657;5.3141519102245569073;0.87669259546413746964;0.51757555598727755797;3.1183431789270907863;2.3575975434072606873;-7.1396267195514244719];
IW1_1 = [-0.22019595377667289249 6.6486533608751985369 -0.86189682666160571944;6.2701462660883020561 -2.0948272974140453861 -1.4671157047645118077;-2.2649117372963014638 -1.8781713494575849044 -2.610716408124446275;0.79818398807919099802 1.6928725905158632514 -0.10741112697178001323;-0.62702707697242388019 0.37579636905788804668 0.43164811205290198881;-8.0359754373467513489 -7.6327720627738813164 0.3052293412893680169;-3.6307552095805295522 0.45865197947794644762 0.57642359537126552915;2.9941167450113503889 1.736464365311247704 6.3500136060984857522];

% Layer 2
b2 = [-1.1380517018058022849;-1.8093475416963473723;-4.1992784429263148027;-2.83349633999402295;-0.9586749931146085757;-2.6549011878155481803;3.4039294107310960058;1.1642469921489160267];
LW2_1 = [0.15677308134430062436 1.4837785477814484647 -0.88066541901692729777 0.54781921876313055542 -0.26801628632386298445 -0.066631043084608196359 0.15705384517723505744 -0.9329367599120020893;0.61382750223893545183 2.1393127824533428871 0.90735283017414325446 7.3925124450372887708 1.3606207918727069028 -0.16418650693910422089 7.3004878253973171098 11.73796731612510591;-0.011204516114305968638 0.98505848963183262335 0.071393840682272113884 -0.63608132315338250518 0.92685605204979226723 1.6271863712846974526 -1.744372439636543648 0.84719891731932905898;-1.2683072265093617847 7.1886757910900156432 -0.071147708707426982055 -1.4007541305995296899 -1.5115577146950656129 -0.020776779441725613112 0.29750903335240586056 -0.15322529808654600236;5.9998120949564741622 4.3096812663627250828 0.88452365100093388595 1.0655137915501198265 0.002948919396992873837 -0.079840242506563824376 0.054135653275832772147 1.7139442982078660904;1.3125257876349942787 0.92354332948348316634 4.8763486932354194181 -0.29307507729439508104 3.3284017598637651858 -1.6704373949081900985 -1.2011428336415306273 7.3501044831584758654;-1.129072719686674775 -2.3436652964544526512 0.14091456563339646579 0.56126041268838988696 -0.94506537522430122955 2.7358591163028695981 2.6325831236594607887 -0.85012622801602333311;-2.3051147768661959248 2.5285534522559092174 -0.76613329779101035921 0.82969964459974854254 -2.2440769167691514419 -0.038664147448164022658 0.019828618489123397278 -0.96709259828291560535];

% Layer 3
b3 = [-1.5801734511423981555;-0.68701582307196551458;1.7117973998946569569;2.2118849211361606422;1.7697353540278275563;1.6957702450145233364;1.1198134502028120885;0.81941664711997208581];
LW3_2 = [-0.25016805282632165186 -0.10181734560934957434 -2.165436873872811141 1.6184952250214084124 0.73420316548808639556 0.24264858244391546149 2.7858640224652213568 0.79376602841268451005;-1.5019317291049190111 0.47395668220386982794 2.2985296450688568193 3.836208677222685548 1.8641672326068092769 -0.63955851653011874802 -0.76736248205506885078 2.3347500560558147598;-2.6358982456258193139 -0.22943712199206461877 -0.32002519358549758044 0.13675620475064820258 -0.41387096088836333729 -0.80412556419578806732 0.29896703084461190292 -0.23498103650978410806;-0.9998308003231536345 -0.0036635062934900872351 0.85127830598509790505 0.058845616372477316247 -1.6274385341453514453 -0.15595923197569919183 0.10638803455584389113 0.67046628236793726074;2.4797727148525763319 -2.2035250955210758939 -0.36868210122791705841 -0.4640028760239854333 -0.056894678531791635645 1.3399642977390235909 3.4168961979445429122 1.9261095310111593371;0.38614150942304903413 0.060857219841346642253 -0.059134098809480790948 -2.3678163353837717864 1.2874084674014745211 -0.10341438689694350261 0.045621338641972361549 -0.49769943241128611344;1.3555144744639540111 0.58216630497094257191 0.46789935240188168519 -1.1712282353500236276 -0.27764857672095083485 -0.73700142361929943391 0.0064752912358707198637 0.38912355073028620511;1.6912988313260031159 -0.081435958123870069714 0.32655562692038014871 -0.96978530066800616716 7.6631170728004533999 -0.0097994852339158382282 0.13099553768513483298 -5.4208541518903210488];

% Layer 4
b4 = [-0.78703564186753238729;-1.44521570974837954;-0.84964491087130744607;-0.40768339876979631242;0.72230570379077219112;1.5208997177572034509;1.3449478977311268846;-1.3453377861118935854];
LW4_3 = [1.2011271534492491408 -5.9301087466272806026 -0.015217419821871105284 1.5059660509175831766 2.2729865508236302141 1.4436608439884841548 3.6713391385809321932 -2.7696821518364735937;-0.30686614605494993979 2.2318007886637540871 -0.48809970487895742997 1.257903169598076909 -0.035892629502448501755 -0.96345323867281418284 -0.87565138246105156394 1.5084028341014696917;0.34686838177708767539 -1.433981301012281051 0.47486497588684584148 -1.6080306963579620305 -0.003441475450136180763 0.48594090935953365706 0.96688664770708310225 0.05337999763887486121;-0.64284195987689263241 -0.22042072584855129658 -0.56098110598651962366 -1.7654739354853432598 -0.39808742297304716695 2.0449414307302604676 -0.30678995932754205 0.089940435749156583123;1.1111384514799029777 0.21609555783710851506 0.52751439068141747768 0.25710113329333911247 -0.10114845796974573922 -0.91493723663648174327 -0.85566271947684902077 0.29667033403155268489;-0.082600996473609966664 0.76174874170423212405 -1.4868913714843627893 -1.6395432042614916934 -0.53093691248499952362 -1.133451860359325325 0.3837702518111529848 0.71824362373916494917;-0.24174109421200445924 -2.8917596659324309449 0.83279921377633703283 0.15145041811140361188 1.1120927781088045805 1.800641987911211217 -1.9451706494970468775 0.80216404512661676485;0.56163098637565633808 -5.743196516434760035 0.25628008658859963154 -1.1365690603461497954 -0.10551809125568821501 1.6489315132638884265 -0.097020117092630586697 5.8424438575607773316];

% Layer 5
b5 = [0.18866504553738006056;-0.16686408377571054773;0.55991163860877102287;0.37502578455427981741;-1.3121875451634024135;1.0357621504575127425;0.043194301289041801828;-0.87433875257526549873];
LW5_4 = [-1.8828809551207832396 0.53128470212177503207 -0.31863447086031582156 -0.48792892124896142247 0.61597965939676235791 -3.5258440848284080538 -0.49005708686873733493 -0.74693367836827762041;0.91831782923944382802 -1.4566660847471331053 -1.6506607308563288061 0.21300587307307655704 -0.12475493069362920961 0.55413069675178983076 -0.0018172110360989007782 0.55050709097482619647;-0.41291620209615226278 -1.1890568808090054009 -1.9872903125218206455 0.90373246181483835038 -0.30268439573526112474 1.227829269696401493 -0.25525433905377314936 -1.1785506269871119933;2.8608761932974773323 -4.1304546734450946488 0.73881897550636188576 -1.222694304649729613 0.49701584909264595602 2.3294793410347960361 1.5754658374499275197 -5.2805253863819370252;1.0071102430052685239 -0.85295240364468827288 1.3365767374960302316 1.2537183031613861051 -0.52494555142694099281 -0.59035527951841770822 0.098673359585481332235 1.9356346035167213415;0.9440501394605166352 -0.11166775327087791192 -1.8369284182707346087 0.56208356181970109411 -0.30796734225392508044 0.77891185761209091876 0.07370970576815767672 -0.05165450803717590994;4.4824744217139675939 -3.2662642815040450195 -2.2438076878260093672 -1.3158789193668805062 0.85798693062191144776 -0.062783698693780767841 -2.9441332388619403382 4.2220550589323906365;-0.44145255431447938399 0.98637271170790430386 -0.50580036385968552004 0.95940338885992104689 0.41135092591666361228 -0.20768983035095245349 0.11132672939101490028 1.1322390037225849024];

% Layer 6
b6 = [1.3628885221237454495;0.28258607491682907753;-0.19094423855819953051;-0.99207693656071926913;2.9458746947304130792;0.94664388903318608115;0.15235188585550618612;-0.0040819178139698195085];
LW6_5 = [0.21345487668133142356 -0.13769674700155173919 0.1582057681262245552 2.5742188331183313288 -0.0918433031352236251 -0.58172432462908152395 2.5451670253544036449 -1.8080862821341510127;-0.069746270712675514925 -0.90634512069050598981 -0.80676397996675941471 1.0198722225915388684 -1.2009000949601291719 1.0568748184967000636 0.24391036548494324232 -0.44804156630866875943;0.50083275486318379333 1.5729518762783898378 0.98030029728613998774 0.54639538579871860247 0.036144613812389599083 -0.010803436944274862758 0.94087075664530728236 0.36334673789727889304;-1.0881733915455167327 2.2784160100349946099 2.1843783954103583866 -0.67404087670442036639 1.7783476677470781979 0.80741320346182687828 0.33862256995063050313 -0.50077191223581840607;-2.7685792760057639228 1.612552858489726626 1.1203005033008428537 7.2650505693024580722 0.23379588021680147714 0.91824348324525051357 0.18892375188598939384 -2.5718007363790094111;-1.6811563061360512705 -1.6237459039121158177 0.99420650378255492896 2.352920241366442955 0.93289369935456312177 1.7084276260984880835 -3.0716469059143061138 0.79401525989963006591;-0.969340134812516796 3.0203832583388532385 2.659197751655927533 0.5455002104343111835 0.23026823619160671774 -0.82542573348959225044 0.67655923576586829427 -0.20069559005319922984;0.37968325783039585941 1.6448147377460204943 -0.23940907892191282125 -1.4426704556272531565 0.44808449001722033822 -0.82630714298149798847 0.77090437475782080945 0.2212536503885241812];

% Layer 7
b7 = [0.55561987339881824255;0.38344393969038964576];
LW7_6 = [-0.45026019344804096844 0.11186923711324787967 -2.5659741939519036258 0.67619681343186188727 -6.8108722174297691154 -8.3649092744024695634 -0.47694625341704699473 3.089296874964191808;1.5692874059275079279 -1.2666474932397691067 -0.93310029281426387637 0.11426825978903998315 -0.83366996941325155479 0.97166923414834016626 -0.076193674894599813796 1.4196379516102040075];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
