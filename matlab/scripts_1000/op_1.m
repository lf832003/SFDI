function [Y,Xf,Af] = op_1(X,~,~)
%OP_1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 09:40:10.
% 
% [Y] = op_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;2.3531e-14;1.156e-14];
x1_step1.gain = [2.18660485863677;2.375917698211;2.70888921997539];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.8212937765431775894;-1.6506646009570928868;0.78409706959581459973;1.660787176315768443;-1.6225854866874782623;1.7532551663228665983;-5.5447430704911466748;-7.7121730720693042471];
IW1_1 = [-2.2652471830938045727 -0.14411837864801743669 1.0857606434897779657;0.58051737182676288462 1.556666949091197294 -0.68161766259514744437;-4.4805873241539755369 3.6152484446369292925 1.6695234934185951836;-0.84891099677523074174 2.1391695188868866673 0.64083614899956442557;-0.51525046647683259149 -0.94530052917863005568 -0.63897909796629226431;5.158153576231035764 -4.4803582646222768204 0.89280080943826123363;-2.8802450264253431911 -2.1807897482763971553 -0.22510868256384905517;-3.7163078443721304644 -2.5360433871949501494 -1.1979746334250289674];

% Layer 2
b2 = [-1.4353562870982745636;-1.2128372391719213219;0.61228024876342090899;-0.1319191044501343002;0.16731840129347294588;-0.13055325911480147871;-0.99388922485256825379;-1.7176613958121638159];
LW2_1 = [0.68126594855690458807 -0.41789448844095744562 1.9336524275641540083 -0.22207738005389374147 -0.92491591689067853554 -2.1301952378246720166 -2.418339137139810191 -2.8556875815738136382;1.0256251403382241616 1.1673238102447367481 0.063040981967500700489 0.57508660118204035783 1.0846909152079282634 -0.098582597470415492258 -1.5806116037055546464 -0.67847529919814220101;-0.07826367947935493341 -0.34792772510121938723 5.760812871060990048 -0.22509020671707605232 0.78478422328553865128 -4.0073045567588572169 0.74940363916414887147 2.2098570261502255008;-1.0464670420879194079 -0.099458261281611129445 0.3853492786001651571 0.2715257318103867501 0.15893072834790239467 0.83447516053287640325 0.059241551663480850054 0.55360505811751381522;0.29293730622854585732 -0.19275944778058803908 -0.45378202615908214135 -0.39107043331510316087 -0.58954989959566672653 3.5303114090170422124 1.433648079878564463 3.3616238822393884611;-0.23236073131063925135 0.024012913608082411127 3.1922076478929777288 2.3365222189449865731 -1.0704770765660063248 -0.21061452166353553106 -2.8844859096590687031 -2.2144518282383915952;-0.55093974043300553145 0.40267117850172201576 -0.1275773891801872395 0.50522140078477428826 0.41641113596637124861 0.19677138574227565071 -1.1262787703968673014 0.20760817606464573859;0.024566774146565089482 0.3630422898466138526 -0.69495916391925960376 -0.65658255760638106757 -0.42574829658362267626 -0.37485894209451553483 -0.72193244459657568424 -0.88132668021436177952];

% Layer 3
b3 = [-1.7023748042386395163;-0.46499315142627650754;-0.24874131410019018062;-0.42244778534220284172;-0.59562668779017113874;0.37358762711611964713;-1.3611860727808617888;-1.8688085162959693353];
LW3_2 = [0.031040939617158296721 0.78630619988152294919 0.87566380747608008051 -0.78628459173729337017 -0.56441058239757435633 -0.59808484220260194064 -0.56517479110172386125 0.67300715822397205734;-3.4216933843088987999 -1.3385618420594032063 1.9182152317348262205 -0.50656443717858234965 5.7205191087269469108 -3.2937882841038845783 -0.28061087361727288236 -0.062673527331935388607;2.0577790477127515523 1.1446971333210251842 6.8549499722314166661 -1.0775863485498951011 -1.7750812400994260276 -0.076432865803554767004 -1.2452476335994857592 -0.18636097873884210907;2.6084595344476584344 -0.58166121844349372161 1.7278988002658990375 0.79141777419829617557 -1.7802642911836450423 -1.7891944464308693341 0.66650883932030347001 -0.74055090524765754267;-0.66930414949055838658 -1.4360936330425024821 -2.208968388748782985 -0.063904399066143105501 0.78253527639370612512 0.31326777834173391568 -0.6091718320622533378 0.89443775333685271445;0.81526689864912738059 0.18317261681104901605 -0.33279702297488517049 0.8822001494911759778 0.76517608554523863784 0.13664123563385338622 0.67070476432694847713 -0.0058280584320946409935;-0.52312949117075535632 -0.083747243006496913109 0.92950614360280658932 0.37599531895545829085 -0.43392099919736304425 -0.17390717968468011323 0.6692027387992619536 1.1629306406556343401;-0.14016223445559575222 0.23514050211975867644 0.306293573203354208 -0.97464179675256690238 -0.33420630226549702391 0.33762781564636412668 0.80452881320472502402 -0.52378079859429360621];

% Layer 4
b4 = [1.4600353924621061186;1.6204184849447511585;-1.0003108913014127079;-0.45053911774860389006;0.37260330549239600861;0.68776631093837559128;1.3101173489310771192;-1.8081224202242696109];
LW4_3 = [-0.42088932795132860676 -1.6237866310982034257 4.3569205360304801289 3.2350449859492345084 -1.6787553509313881683 0.40470101177769024492 0.49029537785521143389 1.14877553305872393;-0.26988945765360905504 -0.35917949925855119364 1.8205181327136510383 0.10123599231687541167 0.65324357965200152698 -0.61818954823638316842 0.43131080236549057538 -1.0172033108312419358;0.30008314209381092841 -7.145761798872932502 -0.77148721237695894182 -0.27821388628362692108 0.15523715119141059948 0.28431252892423936052 -0.6033050725345582288 -0.6722861420731393034;0.20474732308026633021 -1.4393936803487881182 -0.26188588371660537213 0.27394191143133544974 -0.33290315579191687156 1.1243253560517567635 -0.67523838946338676781 1.0085841036340510435;0.56884647607630201005 3.4717257418482314613 -2.3710881477070953061 -3.0720907475076311144 -0.33676625434042645191 0.032656622164543909481 -0.96410085339256812453 0.50946298806598877551;0.95101826617198881308 4.6854749539890363508 5.2292425552734567162 2.2981570517113367735 -2.5798009373633807861 -0.23417870438634780239 -0.68838931845029815992 0.19582406043622960223;0.4840129638232048559 -0.24443242534019926637 0.010615789657438690768 -1.4984985223044271496 0.17272914541235701025 0.42138914119499620847 -0.82110559121021053919 0.15483347488220322585;-0.6459688775159488916 -0.93106840169380389316 -0.077538985575072341683 -0.78997574623448885145 0.78674361976498730087 -1.8399453374962808638 -0.65955924848586811038 1.1407362218603984694];

% Layer 5
b5 = [-1.4973543475426984717;-1.0842135667353782758;-1.1285300108584854772;0.74451310530244851904;0.10017249158504316908;0.63057887067651607893;-0.92061406039335547113;1.4726229814841571564];
LW5_4 = [0.028198000271401426481 -0.72407097891540883605 -0.19699946212866095707 -0.22580063441821657255 -0.15436346235650497127 -1.2921559979014103359 -0.40888332835847096547 1.1459102412923614089;3.5843815385411716967 -0.013157382006890046278 1.1302460178544395664 -0.85323536636616537088 -3.0037343454689433564 -0.015998131033804416368 0.051382981400218741275 -1.1091879003997806574;0.8869357688015738761 0.36326171572111459751 0.67553708966179204509 1.1207284885161159504 0.35194284215130905435 0.75919797029059754578 0.45107481735308097015 0.13388314091784175863;3.3680603028968589818 1.1181739055472454947 -1.2857617858510654862 1.8861964860163134006 -2.0410568096707577546 4.3920117606699724533 0.093278915036602072508 -3.6934469961655005399;-1.1099350121913389433 0.52150390648946265415 -0.42948671381303271666 -1.7515770761040612147 0.87000639293659376428 0.21080927138589528047 0.97296814594769776008 -0.059902888994910030718;2.2105808200221432891 -1.2253990116160733415 2.4707976576493844156 -0.6779207774041904333 -1.3828328612024547439 -1.4271747675026549285 -0.24185339456364529642 1.0953511297368125899;-1.7844650569889939362 1.4089846308099409633 -5.6522025687040935438 0.070629887345325353953 4.9505924429371619411 3.7954787452157403571 1.0236199164264907502 -0.086385548180546847807;-1.4893446603771351988 -1.4688281250072998674 -2.3393907074961002301 -0.19531367842404920299 0.89780337795063736017 -2.4787361821349165325 0.094507724165212955714 0.39822866249129662553];

% Layer 6
b6 = [-1.6006419071527877573;1.2212154118748452802;0.88324430179304691535;0.023903091876413883748;0.63436417786280518971;-0.076842798817283383683;-1.3884926454671275842;-1.7420914884356961672];
LW6_5 = [-0.37143399392698511763 -0.39506388921528340363 -0.50160850974186876883 1.2523696930788339454 0.23928299587401372084 1.2719271177572184506 -1.6527706144354887829 -2.0480251596739091902;-0.02743471444533436554 1.4390063575699951759 0.73969160977602776974 -4.4726591658568990439 -0.96964509985754121502 2.790326261324503232 -4.807273394408404954 0.46305915442350570332;-0.77179393818023400708 0.62356415545155063906 -0.89085286083229153764 0.90832413770649511608 0.055606491846768711651 0.87682959970417695406 -0.16114875304710205017 -0.17009585127547904859;0.13566743156033228557 0.77157730598610507755 0.36896780212375063224 -0.076259674833492080426 -0.78135519126416141944 -0.017296867973606664531 0.40421670764600781123 1.1894424856084440112;-0.71979053756585031909 0.35535332515708667467 0.54631770476365837386 -1.0001623795918892501 -0.66753081369108469012 0.57542689341617903054 -3.0049918474571568616 -2.5995713836181160161;-1.4068648269506567328 -0.19373558334462631647 0.3026707711377544241 1.8367620663354924382 -2.1103773767707618703 -1.0301221202861368109 1.1611453647901035513 1.8300292309404238011;-0.31588968613589213374 3.9622255816109812621 0.54098233824557462324 5.1887767984789006093 0.01778333740915564315 2.5290509877486186952 -4.4159173651817615891 -4.5782385980505777567;-0.30412849505023148433 0.83474520339287860971 0.80002980862878925183 0.13143095591439196701 1.1132271717369450759 -0.025499085114982951439 -0.70472482011459536277 0.4154407033219537082];

% Layer 7
b7 = [-0.29656327293731205019;0.91203627465598735569];
LW7_6 = [2.8986190340628459339 5.4588696214125578265 -0.65926838310839475099 0.64629673456766190132 4.3844204686184147235 -1.475171007522592781 7.6360193403162215375 -0.22381270423699314853;0.025891489700228514231 0.036469799390771544256 0.14769377564508881506 1.1292366236440278815 0.4023626046161934422 1.6536923885866043893 -0.048066107562087907745 -0.14073223064166873186];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
