function [Y,Xf,Af] = op_14(X,~,~)
%OP_14 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:13:31.
% 
% [Y] = op_14(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;5.1291e-15;-0.0017771];
x1_step1.gain = [2.18660485863677;3.51660717739528;8.21601210382903];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.4932047051658106085;-2.5506949178873372652;0.13699680275082307124;-1.4703157754777436139;-2.1741947328156827624;0.20771448946412546244;-1.5295057564553793394;2.6806760480339639763];
IW1_1 = [0.030573055731483968905 3.9611106652565060138 1.3888949295304000575;1.7749467502936546737 -1.6593115003944656216 -1.2535074244469397442;-0.731312999389943319 0.60538551771540971558 -0.43340307985371501198;-3.162460637665568175 -0.041907801104150058102 1.8160360604869099088;-2.1787244730590136221 0.099398386542311936709 -0.16236832699808764757;2.8153908236328213377 -4.0047836228436155537 1.2152288329622438212;-0.87481200815771797963 -0.24057820806384180856 1.4594882712705845584;1.7782225082236955416 -2.0748624944983644625 0.67785053107719439591];

% Layer 2
b2 = [1.6871097442227511731;0.42362920195251435596;0.59060022976557791097;0.56344517520970716085;0.35698341052083754077;0.65467739016596193657;-1.0489528488940680351;-1.7406214763531751011];
LW2_1 = [-4.9722329347344960127 0.65976833356991670954 0.57439537044962651891 4.4850719135591639031 3.0655021697587150342 1.8861973047144007243 0.70119920996517781653 -0.5699934886317218341;0.10500060807537252294 -0.18398656236046279089 -0.90685377261893784784 -0.29779496380216052831 0.054362051427382394875 -0.1107824328524545654 -0.14843379146087429254 -1.0012758064738260799;-0.34368607359804997925 -0.26497738133933279592 -1.0853284369026714451 -1.9361140399227410036 -2.3745813395542723079 3.7847395156678897976 0.8176666401075018964 0.10400593708844546592;0.30718569473759199662 -0.039937780064278602388 -0.33263466208018183101 0.32727731417715805184 -0.4263695892626060413 -0.21036172440303052555 0.45097806579723476172 -0.18336181362024100983;2.7447907360543357669 -0.65330315526482862776 -0.77255427409104182601 0.37806318999577287476 -0.66848110499562152231 -2.5813181469764905351 -0.40979675460714409807 -0.7079850989285886298;0.86185065823647122318 0.29639264120408626013 0.88986771754255555855 -1.789385666597381519 -0.59587484738769624926 -0.39254417935515872884 -0.081620577237759867062 -1.3341204105522652679;-1.2345844408238859646 -0.015794456160574257136 -0.88667832511035471477 -1.6325505639285553539 0.7803579205595707613 0.4694519313604656463 -0.28472771510147265595 1.073333292876322842;-0.79753175643891360824 -0.78632694764082178285 0.2753282971214598418 -0.95272090318010271837 0.45231390540680871393 0.44015532928336037477 0.048616457467169769957 -0.86957773823108330813];

% Layer 3
b3 = [2.0510492657881029821;-1.1198224697028980046;0.53419693131985068746;-0.85705401931762137391;-0.088542224537748778768;1.152984841827649154;0.58772937150511617155;-2.333419953938678848];
LW3_2 = [-0.27877844559475056796 0.12519556206718154834 -0.14016069160660044046 -0.47187318705696129628 0.52968308655059459511 1.3723626343965629193 -0.89518529053935680384 -0.39443667848331576131;6.8837966942874517784 -1.1639633579507737693 1.4761028760044321295 -1.4685712960132941696 -3.5486769899100090164 -2.4258355652090806132 1.1330518085591056998 -0.11390420281718288686;-2.4192089219882038087 0.43953768218566613424 4.6606486290641466752 0.0063719917263033833479 -2.0353922613322508184 1.491038472106897661 0.71257130386792832955 0.8418604436135344038;1.4709921794446911836 -0.72132229557387428365 0.86960521879753227559 -0.38322219542166380268 -1.7296646613526769354 -0.8971265892234502326 -0.41709967786128288036 -0.11156938025533262582;-1.2044339995430310974 -0.42216300780231041934 0.5658059194762051769 -1.1843333878070039233 -0.98955832097064166941 0.44479571658479433172 0.40307974549083791516 0.54310979950165017005;0.28880506098493963218 1.1560368906741318451 -0.69261401621146756469 -1.1815446389039327979 -0.21617616271725012544 0.21341411821505457125 -1.0226813112076873491 -0.68025652037112482873;0.22294533987014014675 -0.9471385580821052308 -0.85282937373062361885 -0.74056618958539677244 0.054842782503039817776 -0.1021741955886206199 -0.84555205030337432515 1.2187057151130282762;-0.10438965574604028297 0.46925175363023802211 -0.66719691314297147056 0.48265022679669855599 -1.3853205942302160292 0.16161028439314251148 -0.18809060291273210774 -0.15545275943709288557];

% Layer 4
b4 = [-1.3635381351837578823;1.0807083144461251401;-0.17128834520617020054;0.1020909304768347764;-0.42263240482040947965;-1.2335056725290070023;-0.97160728217788505656;-2.0045948224191740827];
LW4_3 = [0.61754679366368248061 2.074216777557270408 5.3365256196943864353 -0.09746050084457547058 2.5781724151026206293 0.87383578472723300035 -1.9963517392594112287 0.10306097197066294013;-1.0133017796927712428 -3.2365055703822562805 0.088542192629910587698 0.6434469082652368721 0.28752896098280605885 0.38632912982807116054 1.5567968508021388097 0.90729004175525140852;1.1884673772321261431 0.12293618960839840237 -1.2601754606785209312 0.88394813257703119813 1.0937758026161625846 0.28793912616150113548 0.53004542284049926959 -0.24995455978260477936;-0.69879168845223693651 -6.6734875822996020389 2.6594730594902187271 -2.985414884899993293 0.70047431953368632929 0.63005863141142093298 0.64247072053939358049 0.26811622876917046154;-1.0604852992901736553 -0.45145231973774241352 -0.66312465808112552867 0.39422995473938998723 0.65792492086708265209 0.61154844837795208079 -0.15371493028241306478 0.62443426451174011138;-0.54278137156388828188 1.8383874328735811954 1.791130191105011038 1.2236068049820278958 0.99887562500534832211 1.1050800904020474658 -1.2454782837462186063 -0.75843913593533562878;-0.73184843044686254121 -0.71186393805280401281 -0.6375152446192765554 0.85713648066276337811 0.35526822279263475801 0.84094740304811399501 0.076916160489858387272 -0.50726482385074855852;-0.9818273838181948987 0.46853527318383964007 0.36060058655212012813 -0.35840419295928555021 -0.16959590962722365104 0.63284698469023026313 0.96847058382759632078 0.1289620995354126276];

% Layer 5
b5 = [1.6685665652975196771;-0.66447221158700908727;-0.44142320099175924586;0.49794861220436226201;-0.033364939433418137893;-0.71575943892151394632;1.1547488174980542475;1.8195065134408945351];
LW5_4 = [-0.15815235305065522553 -0.096976284092075051846 1.6840848203769400726 0.17717354496832846134 -0.26490562925700761321 -0.034111440590249668403 1.0902574939719864577 -0.84635837964246662946;1.940633034667045731 -1.2290380725288252428 -0.58226803158605511257 -1.9139431712489454185 -0.55389403120901603561 1.1765220394426423312 0.61169951492902252532 -0.75026896728678538206;2.9378412490604315366 -0.76386336398138776627 -1.2092291467556346429 0.45745519798465134054 -0.32446020510065587406 1.4618642321832275854 -0.21427860502840317958 -1.0393365375566032682;-5.0853705883911102248 0.64766439137839904028 -1.3533118979062068732 -3.1564662520765134346 -0.93159047528154126372 -2.9616544913800151306 -0.72498249037033102304 0.26912682870908988253;-1.7559212842717977221 2.0921139635068768392 -0.78311994069129142737 6.3978426654022531039 0.15778786203827840917 -2.4126889663725878954 0.50620837267772889057 -0.60187985043020386655;-0.86359429846460789015 -0.42183758475831595325 0.69269068856472093554 0.89811618230620493541 -0.52548290897253591147 -0.33654694038763849351 -0.23325485718926883272 -1.1042038385363732722;-0.86212161345277660285 1.5433067162781919368 0.57622730302178271078 2.0479067039587417476 0.56121105514848568241 0.30578333616681574458 1.1086853705650510094 0.51098975874046470569;0.48186633604990808388 -0.16069442416720600142 -0.48713396944966569357 0.90060027187589375419 -0.51525416119482070343 -0.88044677185012976128 -0.91515757680634579607 0.12214769288258316149];

% Layer 6
b6 = [-1.9086081274891277815;1.377154051655271827;1.710113466604439747;-0.012795748972588052647;-0.12078137290957861871;-0.79237981746907693026;1.1690353814231493335;-1.9252699195654470188];
LW6_5 = [0.58185422236770301119 0.79625053256056876894 -0.58080696040743029496 0.32073869656780618076 0.59220061798689604959 -0.86270538749684089197 0.19132167634224114816 -0.8358133442577463379;-0.1708856669753054669 -1.1843906500118470682 -0.16373382608156167306 -0.967968431135101115 -0.054636847995879263273 0.94997336308638069546 -0.19857747714263038197 -0.1162077332947834829;-0.0196962831024607328 1.3574767322837957284 2.7312167721855931113 2.2773798747258062747 -3.6163381717833709139 0.28113382661295249765 -0.51007862528072500652 0.86389493887198631761;-0.67955938822629780027 0.62627527451188369501 -0.72140614506703848452 -0.47595398442791264637 -1.1442209601111483774 0.3524945222333494832 0.021054738847743174196 -1.0483776784929421666;-0.63553882203703471188 -0.28271510689961765195 0.65862097568047384133 1.1751626498069025484 0.62128249362198140204 -0.74423551627098205596 -1.3378239663609003962 0.55025132799226383895;-0.11756453999826683987 0.5623211787846010834 0.34280457128579611137 -0.021685863352776321711 0.059218664161458468842 0.96379904468549637553 -1.275046433936028123 -1.0191818425190359854;0.75251131807084103986 1.776792286595203274 2.1966788530961354198 -5.0292190380736361277 -4.3563908889404796554 -0.48336951874209083124 -2.0853589322709389364 0.014111379399896969988;-0.97202877783885399676 0.34614173365039885288 -0.72403424064776522595 0.75582963268552028069 -0.2421888404511773063 0.48837209382077106934 -0.053066539847229927951 -0.84546497638550421883];

% Layer 7
b7 = [0.069730246692920147544;0.95502403686060599597];
LW7_6 = [-0.74229343310685902413 0.20695439487889527586 -4.8597664482725475565 -0.45208887713782697215 0.12722362829272121365 0.049395609152079113235 -7.546041048532214468 -0.92659892177498826005;0.49261781236528684458 0.55114167987135032067 -0.16216245508104995543 0.065015743933930641996 2.1799124511205651977 0.4038462090281511041 -0.15675146339957826691 -0.5290410815496146002];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
