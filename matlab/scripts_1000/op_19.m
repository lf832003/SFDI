function [Y,Xf,Af] = op_19(X,~,~)
%OP_19 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:55:21.
% 
% [Y] = op_19(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;-0.00087186;-0.0017771];
x1_step1.gain = [2.18660485863677;5.574728595732;8.21601210382903];
x1_step1.ymin = -1;

% Layer 1
b1 = [7.9321541566811175628;0.44920195773525378735;0.38742405471547630702;-0.61344901690959507956;1.9820868296212657;1.7063385303152669437;-4.5873261714607682649;0.40872811046261264822];
IW1_1 = [0.80981269370038222455 6.5474040359438783199 0.39939132085693518359;1.4749100730715680729 1.0115505294524513857 0.49550603166114615128;0.33603152113102957577 -0.30108011127842004839 0.5251572865919074129;0.2935103426393763093 -0.62005054306226625727 -0.27502131166938159623;0.27658885729514626206 -0.47470867714958803196 -0.85576541400677108573;-0.56695425955928291373 -0.52661882117367531109 -1.0324434632966297265;-6.3014149883878181058 1.3167757453879769258 0.47985978187477440482;0.6770118764774102349 0.16518240505607567625 0.30343342450716476177];

% Layer 2
b2 = [0.49567161397664083466;0.56366083791384624657;-1.0958199034363678148;-1.1130379683477413799;0.14361707067725540399;1.0313538624637115237;0.40915715937817548342;-0.12467644489512251516];
LW2_1 = [0.82566244921606224416 -1.1705878796592115165 0.23355955826461866076 -0.97166093886628368548 -0.47819638631936306483 0.35254335130921443664 3.1303618731618612081 0.12061411640051872274;-0.52050587134224979291 -0.22411257812334040018 -1.0857862930111019661 2.0360787281673018434 0.31586084977104950111 -0.25131291136655403706 -1.4065829235598907854 2.4127277173059868964;5.134540614308884976 0.64345071474227411024 -0.76060384184104945504 -1.0604241076648035502 0.58971906789662154047 -0.026383005851806678316 -6.1101468779630927486 0.62188106821476907271;1.4879351366796707001 0.3305448704758475742 -3.2806242373287801684 0.23555076190155502247 0.47380793688890487925 0.28114227653110984706 0.036684130568447569087 0.038030298782618807141;-1.1104499989096838775 0.043593897167915805768 -0.2170760549360627456 0.83274947804794874351 0.36025201884890323267 0.26746444872814856275 0.30153221572112187676 -1.1865449541451422721;-5.6067955776878868335 -0.19819869630093633894 1.2313133623562808605 0.47687144484100324471 1.5771533118907510307 -0.5479835466398795818 -4.3406470407579584858 1.6845775415590369395;-0.3911063536983662714 0.054737577560428553325 -1.3774701269402995774 0.50720992014059984587 0.70175173627415021738 -0.023240528410786123747 -0.091774601185213966481 0.68003161272455781017;0.12297303812202121931 0.33169672538029709719 0.75571779193715482581 -0.32857468339896589438 -1.3992202518800818112 -0.69248092122125448622 -0.57267013316479886686 1.1237428249503780275];

% Layer 3
b3 = [-0.55567685807188960112;1.1194539187211873799;-0.55937999055242482171;0.2250416817925207924;-1.2225272714171695476;0.3428903193661406168;-0.40436127551145600867;0.50048646762936399579];
LW3_2 = [2.191069623355504703 -0.95436922178979488596 -4.5670792499422043775 0.33427603769680896972 -1.9113388999671494517 6.8360657138798464061 -1.035301498565736722 0.084311020967744329524;-0.33120827409587338952 -1.5288121408397197243 -2.2160378446755957249 -0.41611980135374843082 -0.90903695566935294181 -0.380896530411616141 -0.047844059936431614088 0.068945675065601619291;0.65201272737476267949 -0.30743531302481563738 2.726013049053106041 0.84144875820956122059 0.63296694243358475607 0.020267474720541064914 -0.69024836322001370537 0.58759188249863414377;-0.21172531540036307329 -1.9260522867711982187 0.85171778162340594509 0.38771851026907622195 0.67615324574856583428 -0.52781854868927824409 -1.9451320409978314352 0.53662006559588026899;0.047345869537026345764 0.09545539538894616538 -1.3294563035446829158 -1.3127608968969919356 0.34432567084919718514 1.2273561689966150379 0.80676779649865537625 -0.65612933740435719354;0.93994215617953236208 0.74891995612365525048 0.37901542101733326495 0.35024653059084731588 0.0059687130221893472046 0.39782059861752083751 0.46357702241350678962 0.64470545390377920203;-1.3593055096722557185 1.3859350235123291117 -4.674381983321995726 0.1242866399659029869 0.33794517159178066867 -2.1445800872606639587 2.2614549742106442309 -0.82604738975618641206;0.23420211557102468825 0.020880638087770631017 0.067670539940577201232 0.26596861867606746976 -0.8190271020219275222 -0.408733426833111535 -1.4308484238540686295 0.22584981786794000591];

% Layer 4
b4 = [0.62853733291408231398;0.85242656988228615589;1.0424016335567312108;-0.61422324173617726117;0.68212139174697561383;-0.64569504956792345141;-0.74476978222325807;-0.090202517070857690662];
LW4_3 = [-0.72871491006652300282 -0.22106054790614623751 0.54062398080938278699 0.50326576163437020117 0.24778158724681367819 -0.29338348992744900379 -0.23849847047196512384 -0.65217627888547202719;0.13229728518818267835 -1.1898922417476052171 0.92524439662710078469 0.80027204120833350665 -0.19525006908629591318 -0.70200272406419539362 1.0178767034676943215 -1.0426325666820039917;6.4565767259800983524 -2.0826167811217288772 1.4830577876923436431 -1.4820227086121042781 0.13775832679347838061 0.30277915815926503829 -3.9971121098937310023 1.5003177093125175112;5.6078817181472437881 1.320993701909271234 -1.8606930308919240602 -3.4156941209149689342 1.8277269530391582197 -0.42756724200658924318 1.5806963147971793138 -1.1027918675236394463;-0.50678325150292957701 -0.23422556182153123072 0.58584785005011352776 -0.60122689460980527354 0.37803909572907395953 -0.026146475655241138009 -0.50528063976359693932 -1.4712862663619699077;0.47831511450022262677 0.78938723056796855637 1.7018958387930493981 1.0088493581392812271 0.29662424164877082555 -0.54036283443585464425 -1.8493208536539393894 -0.02448016659889045224;0.4319399631717014687 -0.77180313959693591652 -1.0898866435696838995 1.0490686441743002355 2.2958893696260749273 1.5445781728529408561 0.60611528886006593719 -1.062875369941084891;0.029825013886215192421 1.2839588745031713657 0.27144572572214509254 -0.51376636460953428731 -1.1473721857864340734 -0.58492241234039410447 -0.6555440632691477143 0.072612563383550612905];

% Layer 5
b5 = [-0.13631185341091003882;0.021583683536931737995;-0.81302144578925739093;-1.4819307127771998989;-1.0372668105953233297;-0.19962841599780942192;-1.1343784321143415283;-0.016967641340448032933];
LW5_4 = [-0.0071148451011521967116 -0.70805905735959828728 -0.12608022802828330877 -0.036464612752094734127 -1.2175430570654082185 0.56388346387216736755 -1.4746366671940867032 -0.31087548377574025782;-0.15467859292591745746 0.65215165069105607287 0.37419229264114001188 -0.881644105998048766 -0.21419084818650124813 0.33704223068462429991 1.1001613917286745536 -0.9520296325200858778;0.36888170932827935022 0.67543714319233805199 4.240267164843984915 2.1907102396941362521 -0.29257930129874420988 -1.2160398595728743043 2.5387614942743490509 -0.47489496118762031251;-1.1848912965175657508 -0.95278887804523548777 0.41549840608972465894 -0.22559974720073203147 -1.3057907283966911915 -0.097140508094480659818 0.45967704476259735324 0.53430979762637265118;1.3813450430358051868 -0.52708742900882665783 -4.8068888848346151832 -5.5984748716856387318 -0.97126235252372650208 -0.38196291266039372747 0.78154188363565690878 1.3806894123112092299;-0.7602324086837285444 -1.2377309705395722617 1.2790169245287521527 -0.77213474375159396601 0.28337953304830071355 0.91689318846298240029 0.36925607749961825155 1.640852133372792343;-0.35898001666250622943 -0.77404877552952089381 1.2608032687823003126 0.30454397312181885615 -0.75567689735898468939 -0.11066080057159005667 -0.97028781367259653301 0.70830637812980357104;0.33294148812838886276 -0.24060165961199167506 6.3259795908676803577 -1.0627363803989147151 0.57020015623577002817 2.4147539510878521796 -1.8659073296633832406 0.19083178496767017052];

% Layer 6
b6 = [0.74888002994519242694;0.0015761350923616172619;-0.50080398936785586184;0.93800188527378647318;0.94400552725074227123;-0.39849676442969544921;-0.32516876755622819983;0.16200455186516840578];
LW6_5 = [-0.32792073125207954476 -0.23893043303714550651 0.44357597826060274349 -0.83688843277827307254 -0.46255341080297585066 -0.50173478379301306163 -1.2071785617223473874 0.084457742962263548936;-0.28057078158732234874 -0.26300275079094920239 -0.19779522847328026569 0.63903218704164344022 -0.82490258254649817538 -0.44961597384464263572 -0.00053399237022918872968 -1.2318996889249542726;0.79439657897515836282 0.22720787158757632662 -2.117531607846581565 0.37741947923144997246 0.39697752377788003697 0.84113694176513731371 -0.81321240450507903397 -1.074632184097032539;0.58043013089793327186 0.36959866159516335804 0.1868366617063854096 -0.69085050388522573073 -3.0911763825531983763 2.0772173549334147502 -0.095391302125027110925 1.3517615543349059681;1.3982235851211597399 -0.63409531754895753775 -0.11096898346427069848 0.10375918840145198496 -0.067655472126601834404 0.22805077746238172631 0.73453208970269923128 -0.32322398212103931048;0.22353433143982978648 -0.60481407706195200458 -4.073457294379214666 0.20715468113531873562 5.771504226986992947 -1.3740639486137116165 0.89793644811810768847 -6.653524916394146338;-0.35001179843129015534 -0.49488569730883363862 0.060242845727624297347 0.62938444918910918524 -0.52126974075385368312 0.5184273542536246282 0.24440106527411517567 -0.10397067039115805154;-0.29211840169557035107 0.55662936158112030771 -2.4422760698134422519 -0.25027983583530710732 3.3899784356349496051 1.7096986817058446029 -0.69826371310721824237 5.399061064737468385];

% Layer 7
b7 = [0.4644682559447993464;0.31931232388789954069];
LW7_6 = [0.44512005108985036594 -2.4243458904123018627 0.76665679354718552219 -2.2319480143409515804 0.72127298709931175758 6.7039862044888121062 -1.7634573410345926181 5.2391384858445606554;-0.98811118176217327402 -0.050219907441053389385 -0.019057076025532443397 -0.020478716480216572343 0.4390575419153986414 0.041062874495423846988 -0.041907687011387965981 0.03895764367007984591];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
