function [Y,Xf,Af] = op_15(X,~,~)
%OP_15 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:20:54.
% 
% [Y] = op_15(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;5.1291e-15;-0.0038859];
x1_step1.gain = [2.18660485863677;3.51660717739528;14.9503759645796];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.62496727616169800434;-1.1961585164192081177;-5.484373988706966685;-4.3923125091570813794;2.565253027014485987;0.27881926078424684734;-2.9800757782508231486;5.9562068380756967301];
IW1_1 = [1.3676873225318275651 -0.44388221871047961464 -0.08367828508413985289;-1.4063915333196685964 0.16718104493030322422 -0.0054166442148088521022;-2.6154085403306148727 -3.1440809946889696214 0.29120873361377025423;-8.3898132552089172975 3.4108650232024864124 0.65795565742328465664;2.1442350032157904138 0.28852357132596756495 0.79727089088488256596;-2.170552504571678476 0.15428088271739015536 0.064396094823596622403;1.6180026679938714906 0.73993962012405423145 -0.1909254794564399782;0.32819085598530256531 5.4438572243391254446 0.072544549785783757345];

% Layer 2
b2 = [-0.072342911857093641914;0.41583925012792760656;-1.7188924577132596028;0.54774218743944724785;0.059761908786698264562;-0.25758477179303890248;-0.70540620193768255319;1.1727234667818056124];
LW2_1 = [-0.65005590517177969101 0.18350329552718142034 1.3289639787329878828 -1.6384547144574903577 2.6091119029992611011 -0.73615969897578670267 1.5906732475335312316 -1.5773066137165585587;0.78493943591313264374 1.5745002518100916777 -0.24449102876071052148 0.75442595307809334759 0.11570586376194769151 0.15594063516817080473 -0.33518156401737253525 -0.087881954320331870378;1.6330216947446518638 -2.6671518205903383958 0.26634678987597887323 -7.8393436243966228005 -0.63767388250080736523 2.3063278351433091906 0.015461549294953906564 -5.0773698280820429574;0.47946333984390748784 0.86957941499995106138 -1.2486532152772027437 -2.3394872832622093384 -0.42838914150342144449 2.2377233616474860867 -0.78814599367810922459 -0.15256278785849433643;3.8449968679792774218 -0.88179472625189425639 -6.1904346734087116744 -5.1318388957579177401 -0.39244858730807985481 1.0205663651248237933 1.1000243011531336546 5.4063304118959925049;1.5384060718045173832 0.80965434299640293148 0.17081287750062923436 -1.5896409950687679924 0.07530979975920353009 0.26512086894176689622 0.28735427370221056087 -0.201421014106422408;-0.67734124103815862572 -0.18637068265493211827 -2.6951030463599452425 -0.4558540305590846331 -0.79383308437013055947 0.81884309788094522542 1.041006610447652081 2.073743290037928233;0.88086682786422465519 0.58913381056852165418 -0.79899491562883440121 1.6298915965184592736 -2.6305594789049235871 0.7180098797070328942 -1.7876533207244573731 1.4130084414447914298];

% Layer 3
b3 = [1.1050577423312277769;0.98298134404394954533;0.0095647222332215786622;-1.0698260424635861465;-2.4143253663395927155;-0.98296333082779485668;0.1846177430559014232;-0.37170951960971299055];
LW3_2 = [-0.87473380647143883504 3.1994285745719470704 -1.061998158314557017 2.2834042326506085452 -0.87943029426340824095 1.0898532648033316672 -0.91919191619015416794 0.54296706270794770077;0.097068476911861462098 0.44011840492539511249 0.43806214909758628417 -0.22319454663082632928 0.56721778206759265739 -0.14889799481460208597 -0.21704248586451727054 0.70617366945346293772;-0.096778366345900673773 -1.3622900426720936373 -0.016292504329697990451 -0.48863029192331680628 0.66180550069775267996 -0.51044716119198818571 0.38116917885187900916 0.11094513513398715499;-3.1635951506024029278 -0.77393727907575948777 -2.448237470620587608 -0.75707119286676527459 -1.1890040651240860736 -0.76477957171088550847 2.3472262210510872471 -0.62985344003763321652;-1.5954513300150481303 1.5913768682764775075 0.80455424321801671805 -0.0048913361971527451189 3.3906133009409753498 0.043204187298596062605 1.422366494790338276 0.98875314475548314874;2.7166678903442416093 0.4827468338350861532 -6.0159089556060960646 -0.16289853573754312088 6.2926000375053678937 -2.6293940720319697313 3.558856975135257894 2.4319851963796423888;-0.15810438012891320225 -0.8208962634836562966 6.7057358260681203532 0.088997795513632432796 6.8892061956292023339 1.0264307377197381399 0.76547481019866092655 -0.18664363593577248945;0.0084463710289689186705 0.046452665717530136624 -0.26333765141792825348 0.87468091100189282461 -0.29911051217881085007 0.5577471804268253619 0.73818929551257084221 -0.47656386224991059697];

% Layer 4
b4 = [-0.47216854767710930707;0.93746634342628920589;-0.35096273411893946781;-0.86716801187148195851;-0.23966692119364915725;1.0113268329671885049;-0.26700411502876458814;-0.32356388405670377661];
LW4_3 = [-0.050986492361858266886 -0.37262023581249531512 -0.69042382043974581673 -0.62612910315649650261 -0.1677498704801314855 -0.49511708911113111453 0.8572274334857136191 0.50887336184238463055;0.39973707943152692046 0.27594106482036784289 0.5643663798739273485 -0.18989807739763164829 -0.72739794511188882176 3.4507720549215350481 -7.1967532997776535453 -0.26941593010143993769;1.536722280458949319 -0.17478136099649002611 -0.24226502109944728081 -0.66726128205394452664 1.3539733155357718264 1.0722254583940982187 -0.35962782448720342909 -0.12306295060802673047;0.62838803268725362816 -0.7089867846828301623 -1.0412239322083076676 0.73746055782148345337 -0.10564008632699924128 8.7805440324901962157 3.4192033530233314487 -0.0026210022840054518489;0.042902295079888908003 0.67988526569200458116 0.31155253041507041667 -0.9723852682485524257 0.83464106614881916624 0.76945917960527965285 0.47103478981973817552 -0.61806463361586294614;0.44054709788958146266 -0.80498654779264000592 -1.9312705952205388993 0.10922209436012783601 0.38362722223672052202 -0.31176482618016776449 -0.36025623580999777129 0.34340556018791801307;0.88422329942464428232 0.81043292430029656437 -0.16995921566933425151 -1.4923616874931000531 0.14573867055207861965 -1.1711679392333040894 0.090955334909423465883 -0.9143199979988801962;-0.18348540080762359983 0.0085033768303754801721 -0.73482280954562928521 -0.74773649180476386977 -0.32418090131145516075 2.1700093402789488728 1.2563031836646791906 -0.45447968799006110974];

% Layer 5
b5 = [0.23518769767922592662;-0.75840863380136680494;0.10121830901999079311;-0.50975238286736967996;0.74228577754827873569;0.28536494205751972153;0.77722381843527066358;0.024414061831118372831];
LW5_4 = [-1.2205333570922645148 -0.34190224389385587278 -0.010764197297249445198 -0.99795645030243995688 -0.0093916589516599025683 0.90978091952726503067 0.0045431774359692552942 0.71654935964195176634;-0.81654848807300695057 -0.0096474810332210121644 -0.77750089147930923072 1.6027577957544740794 -0.43548491382557064089 0.35886988097507299678 0.23118015512952186374 -1.4570963200837103724;-0.46646795545310260067 1.4966414589596828133 0.042260215901363570867 0.75955875682242945945 -0.0099800129704444243833 -0.95991551385271611796 -0.2474502874298443178 0.14809838482641854429;1.7021109221243806431 -1.5991941603618302636 -1.1612782268024717247 0.65903442643747978114 0.50939954034748946565 1.1201775986127624485 0.015944375460070912137 0.65351774974567311549;0.70969512251787170154 -0.22487822846023278189 -0.31383416774039352148 0.034935652462120748984 0.18118689489237718715 2.2437464082409950272 0.33491153213487567797 0.39003517582453001156;0.11586204662547609778 -0.27920424357352963129 -0.16388864402592837055 -0.043343824217991669401 0.72006992963840055211 0.74177560044777679504 0.84305460924257336064 0.03894177403203160498;1.0030334627488945998 -0.2530714617780253084 0.89400848772605112647 -6.4638613186646489694 0.192483322224733161 -0.69966774234868056581 0.65849449962974826445 -0.21421079430435666091;-0.2071194590764727228 5.8264696301963994074 -0.34887240370175220949 4.0631472225917368846 -1.1704056113226191105 0.46900128337705121462 0.80776630409898220186 1.2972865898852137256];

% Layer 6
b6 = [-0.3900710647674802134;0.1902008896527631332;-0.64598765300481630902;-0.36385093482405095333;0.5207170202580435614;-0.65482288596877957776;0.17998932080563931346;0.53639098837493637273];
LW6_5 = [-0.10419092042394338671 -0.9213342070446896015 -0.38185551506162551672 0.17900571426392541952 -1.5442699797140244655 0.86515703885118155902 0.10191689052170520291 1.3956427808426297155;-0.26008965765270919412 -0.0082765865930287639551 0.68609283817998467647 -0.095031222921507146895 -0.78150332957755863639 0.037405069292409262594 -0.023135147260427525034 0.14102635515572151115;-1.0196268024463106538 1.3956573938693370707 1.6380831598695715368 0.32535886833234634041 -1.0891874922886712884 -1.5477548350110890141 -1.8843946463281395776 0.45956018096534456685;-0.6992887062610276816 -2.5627166230994746776 -1.276236453630178902 -0.66835608959378400851 0.37481302324063164866 0.15759041699701772932 6.5869797784933368234 -6.8899530849295294033;-0.12794577102950094316 -0.84091831222008461832 0.15288842695935278559 0.46857870308585242158 -0.09656854905636799713 0.94549899782849067265 -0.3075062289300108942 -0.19236698655455744533;-0.59592356708052462988 0.050738995831031294403 -0.39583414765291335957 -0.065521179215954600261 -0.32401106461471024245 -0.2549925445609976804 -0.09259743848929276322 0.12453116831342189719;0.64872911976125191558 -0.38295306216838298496 0.035426810961828460178 -0.40802757510230763804 -0.6509154762949818096 0.56230099018735035798 0.0051848923630767066936 -0.71981591806789502197;-1.5934515322840241414 -0.98633740822154847283 1.1040628642276537619 -1.6149039036687813375 -0.43282861387966720113 0.26536417112839905119 -0.70750248759788092467 -2.7846519323978355942];

% Layer 7
b7 = [1.0869933766230013283;0.37461075265566046166];
LW7_6 = [-0.34385683660605081968 0.28414786118653040381 -0.6546500764003336803 -8.4538628884435986777 0.64333051427010512491 -0.58822626137398692503 0.98359137917258476769 4.1650832113774072241;0.025183301865387277413 0.73369226076556603999 1.7468452722252008069 -0.19264139365543944682 0.58769398739951939081 -0.7121142137055136434 -0.076396169433738017607 0.11418580985285184393];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
