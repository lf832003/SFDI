function [Y,Xf,Af] = op_16(X,~,~)
%OP_16 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:28:16.
% 
% [Y] = op_16(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;-0.0016794;-0.00087186];
x1_step1.gain = [2.18660485863677;4.45762514671159;5.574728595732];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.9741220806025963075;-0.20290266052751154691;-2.279543132489034285;-1.2075971413305124358;-0.36211901039428706639;-0.71807342055694112215;2.1881433609419063124;-8.0876793951587746534];
IW1_1 = [0.97772632186861097026 1.6311569398937917352 -0.24339987604916782371;-0.25696298802660144656 -1.4543778435839782581 1.9438344992263303368;4.5074673938797609196 -3.1746201308756494264 -3.6151872751449971588;0.38777432386885235527 -0.13034500531667411738 0.28900635207629310486;-0.9703218825103270273 0.45615391108022557143 -0.10020236689629345717;-0.024003805374288898072 -1.53097726422473146 0.25611718589107906885;-0.026889502210218685363 1.3384383172625728964 1.4263043086005717797;-3.6772462554314864214 -1.2292739326440851322 -3.0191345189478613342];

% Layer 2
b2 = [1.0002619704270301337;0.6501337698738028914;0.11743070026351304369;-1.2715281671010083553;0.84704170538885636965;-0.97491630767241310718;1.4116775532809262561;1.8281560860015222403];
LW2_1 = [0.19470375922588703532 -0.44513213335299989248 1.1713676439282281194 0.7022087680472579585 -0.076440211215713038673 -0.68291279267831772604 0.3328312806914819344 -1.9790869841816758345;-0.076851376032443477482 -0.6410962162944024989 0.0033173240018983937358 0.51121695611880257903 0.99331892767819185419 -0.0042465700332132644626 0.088457957143065660266 0.20221007321160519576;0.32373063977832633453 0.3282721478113215241 -1.3099113798311852186 -0.53612430914410857952 0.41138713755827122087 -1.7174531054951318598 -0.092566801780309126979 -2.6450839209011212105;1.3506550682803575292 1.0178401291734071599 1.5744147119434852566 -0.14337705148536869504 -0.86618570612095502348 0.53861487729086754417 -0.3453090927464536608 0.3303885534035840843;-0.70515646065205228599 0.48899858347892166677 -3.4711675667391044264 -0.45466591741840350904 -0.41476619116318103053 -2.7358203135512799697 2.4587286347055954394 -5.024481752964875092;0.97242526919872684932 1.2819481102036054398 -4.1377484894388087966 -1.1956166366255283062 1.739415454515818249 0.72762421355898321274 -1.9913648149465970061 3.7939702693778802889;-0.019640526650904488459 0.88997281170330144739 0.0069195759847662441019 1.18406487289019835 0.056500140995517006415 -0.34798832276974173139 0.79101963929495833217 -0.22532132006265040425;-0.10685812633437923036 -0.0079270313871244255793 -0.97448397619637339151 -0.64689726401348257578 0.73328151839850486127 -0.24988094414220082817 0.38319163084337637404 -1.3364372168835874088];

% Layer 3
b3 = [-0.9062537745684549062;0.5686991792679976232;-0.74296181044074871558;-0.88680098387866135301;0.15122605334026670287;-1.0748549063714736285;-0.7608816704171307288;-1.6900133422068903677];
LW3_2 = [-1.0675538090303144934 0.46896618220261682142 0.58509291184556988519 0.090302550351933588701 1.9771824086953524446 1.2126248659367555582 0.49160358132219128535 1.0246155652687811699;1.1023356075770753826 -0.028477004680732307534 -0.94570013811197028986 -0.18321444751239762683 -3.3189837268691069205 -3.8780758337882654807 -0.2615125184313396578 -1.0433773715560892281;2.6669121077588360258 0.040251671782085496343 -2.6570454999198824808 -0.011865382260646078344 -1.6246083562404260991 -3.7086931554897830665 -0.069366281172555763201 0.26606385927266607005;2.6473689838053693357 -1.2295729436455684613 3.9422652945810932046 -0.75201461346193265722 5.6091060735688147432 -2.800532335966570141 2.0928571848333654692 0.99831215643186432818;-0.75262797942009751484 -0.25046354210425653131 -0.32294318007451194852 1.4820226634434485735 -0.11750762714790109753 0.8290429559417558103 -0.98319477669966681699 -0.99400389209221440279;-1.1731692742915742489 0.30545707107069225428 0.61145425675321096737 0.10572850331333145946 1.6685357763982602286 -2.4499674008308209849 -1.9476110210399117939 -0.34386557250162214094;-0.7714472327487370551 -0.096448072289466543761 0.65398190131323785668 -0.39350282588931134731 1.6274547565728290088 0.94029229764430177774 0.99627404596232072009 0.60713824222029633138;0.10061738231092591522 0.21090950548942044573 -0.11519756133058045577 0.76325106642466589157 -0.40194426030140434358 0.038394845160987622901 0.62512044419429069197 -0.497268546126315103];

% Layer 4
b4 = [-1.1876405784718424563;0.1988049782087503714;-0.3529722724107151044;-0.10715326702785925306;-0.28607681963761788513;0.01781011131162410846;0.21606930489353498581;-1.7538453084222342948];
LW4_3 = [0.86271279488378571632 3.2174775045354850889 -0.98819544803745829054 -0.20634688855213645375 -0.99846190690689340386 0.18225777219097744064 0.78649544687909000995 -0.30287184723209170656;-0.32073639464493858275 -3.6762620167860529108 0.12277883383121909744 0.89756662481525817388 1.4352600706552169907 0.36252774446254765195 0.57840521492121022007 0.34943305502179600186;0.94407283599899727289 0.1625658570455457419 -0.73205313511152325656 0.075426870345921104288 -0.22282583328082936069 -1.1393391575845257524 0.82875496112111501912 -0.29812726831486574541;1.2421694986779638903 -0.11106455548735325034 -1.6444868381231847465 0.99473814207323207892 -0.14669265287931981812 0.87786823042447692522 -1.4000669562266527812 0.21056480963434465181;-0.99444712944097368723 2.370548439568654242 2.356837506265792026 -7.196801546961591356 -0.55312959429164043623 -2.2417685178697612791 -2.5992435130492088646 0.43773374885889110297;-0.88999803125997467568 2.4435586822028105836 1.3650686250878265593 0.69841782449803013755 -0.10884329306202293608 1.3066462358875376992 -0.51474246596496331385 0.50367145869377050182;0.61340364069962960425 -2.7466620770029259724 -4.137272999796590689 -0.42777320375811284103 -0.0054108481627815696938 -1.0919583137119102112 0.036436139921287039045 -0.44826289768636840005;-0.35268368199605043545 -1.1642948038331684124 -0.41632557153184923671 -0.77875676657972559003 0.82476372292613520099 1.4976626007320832379 0.29794520711226130105 0.35123737123402687388];

% Layer 5
b5 = [0.0044662620777305636621;1.5391305977959253148;-0.79392894864046070769;-0.52072148048484090399;-0.18841945085907332857;0.53899155305503343438;0.23030172682391730765;-1.4633379336896035205];
LW5_4 = [-3.1400516197290384568 0.27346222583308027465 1.7636315778579700897 2.0902819296052910225 2.1874524879479619877 -3.2207862743624056101 2.8807179644595515278 0.95007208707462020847;0.1528470694552722664 0.54617003294850752226 -0.2491465670617663275 -0.43154363410511159538 -0.38877697626985369128 1.2543480164522304854 -0.62897390581960699318 -0.35969033977133735291;-0.017000979740478799201 1.4233973531291674863 -0.19563705012868543021 0.82564288084658121747 -0.80197802989836197707 -0.66455075491122439502 1.9020434111747683836 2.6469971882345610936;-0.14666103340629935148 -0.86292058654345527025 0.0080646452057455512985 1.1550817680269040988 1.4705586052088057691 -0.26197965926776972667 -1.4310650883981537174 -0.76706814005546175572;0.29785571282996203824 -0.13919093941475876863 -0.44374326368631455964 0.8143864489568183318 2.3054878287023061745 1.5370730848136078261 -2.1604492511615882577 -0.26541065146500614214;-0.93672235859685448744 0.99695303852715921877 -2.1163496303188975567 -3.5141893291374621811 5.9588286129411569547 1.6842639178579723591 -3.3968530759092039339 -1.2630205819296620451;1.0928595986154459041 1.1457502916444064489 0.96801437128979594959 -2.1277038764449742736 -0.59730026464671814868 -0.94137423163860090014 -1.2996301902836246978 1.0163090766798965614;-0.6038788944540833814 0.11684134769340050186 -0.31884897686648200343 0.76569293275573735436 0.50135269331216703037 -0.70479628337266331251 0.25161041136557771303 0.3730496992565572878];

% Layer 6
b6 = [1.4791666735462740689;-0.88683215666083481388;0.601125900528612922;0.7242898648585469612;0.3537023525785856215;-0.71821524497857414104;-1.1955473032164467551;1.7243581500361351289];
LW6_5 = [-0.017359559117900696251 0.61543609751861805268 -0.57281251703140978471 -0.88220557902971308284 0.080559770827416166128 0.51295542742109767609 1.1086469712830768763 0.24498717453902824071;0.048736087215687444452 -0.4188396243469250102 0.072361184854483992512 0.71878459454882381863 -0.68625405917211690365 -0.16738659155901733366 -0.38312125949611502973 0.74771002274970943535;-2.8952995886314782936 0.20213221257926741736 0.5891203014487634837 0.50463814297868092584 0.5422273760062437109 -1.0211301808999329044 2.0048830849551229072 0.097996452805793415886;-0.87635790794372780965 0.70220781397142117974 -0.023204075681752204391 -0.83836990302172320622 -2.0855908645830734116 -7.2699840165856430829 1.0000448624629278971 0.15093294281495553411;0.62676146494669560116 0.70889714564957040377 -0.00079562914255938666733 0.093964509121442593709 1.8479118754205723363 0.19619986814634149397 -0.90973381074859027695 0.046335329035458887315;-0.91482851253553010284 0.017847012261402922517 -0.79713038897676413708 1.0929669707558580249 0.0749279728824432667 -0.413500288445824149 1.0387795000157531433 0.29634262482968104502;-1.4492368616665356473 0.1912180203675614143 -0.7576287819918667843 0.47510190011678321564 0.60251566220885088843 -1.2898740983443017782 -0.45851555041289077108 0.85765424441495607955;0.41655689055299660595 0.10212287743848476318 -0.9009400537638921902 0.21509670939313682569 0.29777220595214626275 1.1212736303156483064 -0.13689424556317261739 -0.80668705762054115915];

% Layer 7
b7 = [0.19770812277126792456;0.54454095198934437949];
LW7_6 = [-0.38777077352524486065 0.070243126007317871484 2.4102729559931659331 5.8967972085211481925 -0.12002837085205747547 2.5152733431389462382 1.5829524175293199217 2.0610130192362943191;0.58233921039392033681 -0.44801562487008561586 -0.17650059793985756196 0.081872476880205949379 -2.2977944851681955107 0.55244058559211062231 0.083577531935849935785 -0.16662527156508086246];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
