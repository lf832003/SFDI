function [Y,Xf,Af] = op_2(X,~,~)
%OP_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 09:47:21.
% 
% [Y] = op_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;2.3531e-14;5.1291e-15];
x1_step1.gain = [2.18660485863677;2.375917698211;3.51660717739528];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.0132363603815242037;-1.365562313043348075;-7.0841336583051992548;1.1017003957648785484;0.24960962159196897758;-2.0217692618909595126;1.7497954282412950811;-3.1661639454810672767];
IW1_1 = [0.71243233004850936574 -3.2868642224657258488 -0.34979485349827743601;0.55179512813227626911 0.98857341816820609726 0.93470439338433630727;-2.1254964481714258007 -5.5825599161465424558 0.76051209296540533966;2.0687108586540552402 -0.59939469306888992772 -0.32193494221763452323;1.0504729780465460465 -2.3441850355145832374 -0.054801595509130759942;0.050051632164679338288 0.91883605362847675657 1.9813668505883152982;6.5055149921340369445 -3.3912187682572105807 -1.4521337286038236147;-0.80696431610495522602 1.3876836257185809487 1.8008427996075251354];

% Layer 2
b2 = [-1.7902198965656481722;-0.93915330904936500378;-1.6568808184555448015;0.45907379045054941269;0.61505267744340763603;-0.74945276856051790126;-0.5558167581848767469;1.5951938289038065655];
LW2_1 = [0.27935348556646383278 -0.0088525960614314093411 0.14406596265418583624 -0.036186555626139899067 1.4764009425181223722 -0.78578821818953814571 1.7975152472328161934 0.88726877124157288446;0.79421843265768976572 0.40993644239492488257 -0.066923913126168521615 0.39642668687147214479 -1.1590587597848853729 0.36123471566977255476 -0.13092006890000579267 0.17764090671288146339;0.14002425507097890356 0.72190771115082275067 -0.0693009929016773496 2.786329585475077586 0.058167912770812367496 -0.65071251769567961531 -0.37986736181588215411 0.24262048537959421401;0.43768662449662049108 0.22486002426231055384 0.62632817050869005193 -1.1235955879116255041 1.5023933387647379067 -0.053190698114442831745 0.52494669912027469572 -1.4421401224865615376;-0.66042576845371647742 0.078717787765817462398 4.0012929088009210332 -1.8833370946799699031 0.49047012520661004142 0.87952549893190501429 -6.3617450509949193815 -0.80779593151488482405;-2.997506883483093354 -0.59774117583388441943 -7.0615514978575530947 -0.85542825790688492571 0.29290690949740555427 0.25801865436902848838 -2.4924210099406480801 0.85706381375186657667;-0.24206526062356484297 0.32249199628748626001 -0.81376137496733869092 0.79700990395580384451 -0.66458898352349671246 0.35319092062171597579 -1.2894988751126854609 -0.98575291066731840495;0.27836364027853971459 -0.77417114629301542195 0.1911703167809875592 -0.18565594286770492616 -0.64178706919458072822 -0.58011076480117385046 -0.27345040446660290323 -0.67079989862192179739];

% Layer 3
b3 = [-1.2847294434759459758;-1.0685003180675625156;0.31215912192887257381;-0.26330970576591145038;0.11856929871652999164;-0.97291340889723199048;1.1509193676037283716;-1.369328821343405389];
LW3_2 = [-0.38007412633288750747 0.077461978999520744726 -0.81529430685411963253 -0.27595666894977172179 7.5601940972918653117 -1.4775827338241775966 -0.57568295015791537406 0.62314235465766032451;1.0381488991745984052 0.38036938300629113963 -0.78591930916508234706 0.39016929449115572703 3.4727979710794496526 -5.4787941288883086344 -1.03389930167723465 0.30723750056090487481;-0.80113195085509314453 -0.4177285022900003586 -0.077432152675990947865 -0.35831555694964178915 -1.0469741815195887646 -0.52199247839443918551 -1.0109749578323166119 -0.83239348285536662875;0.061984773257054509576 0.9434765006399206122 0.46914184912729467447 -0.22833986244576101599 -1.2976069873108342367 0.27210237111431162527 0.49061529694651684341 0.25538327850718400835;-0.21942204654390262686 0.36283198342266881342 -0.80058508351591051166 0.36012116022838153162 -0.62437703723952442392 -0.26314099899004189664 1.2005840269826317801 -0.41567061659018939013;-2.2606366586262414131 -0.10972013535986971378 -0.36853585424779267132 -0.16614569197222364694 5.3119458254289346755 4.5337472180554510004 -1.1661949549470729259 -1.0412861122535268521;0.64284466102872461768 0.082200573591423825581 1.0811926631834638535 0.10026239629685101962 -1.8942919356309690926 -3.1024745010668670631 -0.19347536404834456136 0.0025616517033235706828;0.15079064679424472595 -0.20063810899787790087 0.020144591289141266371 -0.2098529056354561384 -0.92365239815554500691 0.46644025658843096815 -0.17186189436372495409 -0.4921508458914328199];

% Layer 4
b4 = [-0.97814448132965936544;1.06323583553261658;0.0079491966800519231473;-0.037127918748502693191;0.069423919277731879762;-0.73103430445680850358;-1.1049310697694016969;-1.8043799219779121934];
LW4_3 = [-1.039891886453981229 1.3115484196260713823 1.6408383322483484079 -0.61528093095433433746 -0.92220371566330494595 -0.59384503527549226121 0.41154104928555512721 0.51022762902898910475;-0.18705738809711400239 -0.055787572427326688473 0.66006109519029498856 -0.22669584134743542281 -0.042237959782415554488 0.54927251737735505177 -0.74545217204253466647 1.1677564171905354673;-1.1004092277351575913 0.62554465911228707142 -0.23967197559560329823 0.6905739184124152219 -0.2326550259950983246 -0.93897534418612782492 -0.022126580657718285944 0.85731534025984390546;1.3043813558663719387 -3.6091159505713812372 -0.91589302808227646135 0.024403325943090338479 0.11815765554457285935 6.007575727286234013 -3.4389394623743716473 -0.17207688070394780433;-6.4372124351875337211 -5.4891852238740383996 0.035949670400709107798 0.050348080295153023467 1.2016854947616830707 -2.0480754942302974442 0.078532633962523329396 0.21334207149794628955;-1.4928654314935629888 -1.8028599400937708186 0.36861645556792610456 -0.67390515164599862352 -0.38970052309299924032 1.2726329749505835842 -0.80233154816225082939 0.1944690878613387075;-2.6466456639840285625 0.6445915988360740867 0.32204639200396179 -0.24558162568786023883 -1.1749240225327655107 -1.9997651730923802216 1.0779469658105926833 -0.33597009735170718647;0.12888237407384975364 -0.17062838811367683767 0.3556861849030137912 -0.21145281892090639353 0.93662632310975035832 1.0813444221618866425 -1.042480345445334855 0.31614641126111109326];

% Layer 5
b5 = [-1.3325022789919043209;0.32426645398652076402;0.19978713033895553752;-0.24072245037784886779;-0.46284654393626745161;-1.0228111444665899388;-1.0494195260041303541;-0.8913830945710234932];
LW5_4 = [0.60498168474128088956 0.16410009290727170517 -0.12243241431126329621 0.20940828288445365035 1.4941768827670722786 -0.3701967007243327501 -0.56067967182286715389 -0.91355002700286791484;-1.0553579110430946209 -0.37956014988385944342 -0.44738990957994279052 -0.80149440449993369917 1.31148719792236923 0.46545707042702144651 0.13952946133586990873 0.87529726382691452891;-2.195453995376105194 0.31345128176502096151 0.8595270351602845027 4.7803344908591061113 6.7199519325350571819 2.0836401525558305714 0.76956095592872242328 -0.23116817474614248518;1.0651521989762791076 -0.77419229783402776501 -0.62690429896388921716 -0.15854281677772727455 -0.42484748210390471668 -0.97892094236319204814 -0.93338583461227886406 -0.10628647496569396114;-1.3807326548414520229 0.18003944111804451311 -0.57259735648902432281 0.86205146794670051147 0.075097284831770569347 1.3855026524153626344 -1.4212774417009366168 0.40502247216939291086;-1.2105644195187554857 0.62621079490452857819 -0.70843808834699018018 5.8142466141079038877 -4.0164901774476016172 0.93002245617812528966 -2.8351079727678012432 0.14773879606779558027;-0.86258918193722267098 0.36446486391267784999 2.1273663341508166624 -0.79206654015186395146 0.59091160807332598903 -0.33238898124193794192 -1.0667505375968096004 0.89847437592848977683;-2.4738298732288717119 0.73490832289612273431 -0.76216871794597473855 3.0175182045313970747 0.45443729862565751532 0.4004579899038154811 -2.7066564376893453847 -0.051463859914548208685];

% Layer 6
b6 = [1.5227175411913953518;1.4981721647907135786;0.68850382813038812913;0.52767459506782588008;0.16297677515461911346;1.2461622669898662075;1.237944972288288259;-1.1158832518687049618];
LW6_5 = [-0.24890681235950920525 -0.92525404766496943676 0.64432380217916718212 -0.52305982379042814667 0.25176752083559322815 -0.15837704226714491296 0.28363491216138431161 -0.8296710845136637813;-0.7616683484784838587 0.3308639622698696936 0.24353462999564801095 -0.75023633632273001304 0.41089247292118857846 0.21139935964821113257 -0.9136823654212207213 -0.50417611950584639846;-1.0342093569508978845 0.57677803373084646221 0.43119918123003664334 0.229330271606485947 0.77831058330871638606 0.0026934045952774310177 -0.37830572409113816246 -0.50454193635733590728;0.24178204983575271592 1.4203808131218429445 4.5627633104544154108 -0.23321940648464795087 -0.058355432016647834637 5.8331463107053966866 -0.48854856228357385062 1.9556389833396083944;-0.062494229793266922734 -0.0088486277308059309299 -6.5344733965525030328 1.2618603902812384199 -3.1165435292804808398 0.17244672332468299891 -0.33693884542806135096 -3.3302435017516769378;0.047321879202679793808 -0.15744076828209549457 -0.40180771930619402221 -0.60046197173330295715 -0.60934900606005215629 0.64870222744993866204 0.65576549071603607022 -1.3586878948755827246;0.6277079372622450526 0.12219324776636707186 -0.068581025567648029595 0.44057485775390825555 -1.2731483085709105474 0.90592974355723732138 -2.592585851528316887 -1.7426993809897650678;-1.5647184057902023824 0.41691467598219739132 0.9548706210055674104 -0.035760927290435319537 0.87216701240332028533 0.11526440203273471963 -0.36274233566504965331 0.49634238945100861429];

% Layer 7
b7 = [0.50432271057649602497;0.37195453671712280785];
LW7_6 = [-0.17271286927258511223 -0.36520037655389775422 0.40806521373291793076 7.1631187884395153276 -6.9775585785393507976 -1.0806554334640781079 0.81458960432122506923 1.6354710745027414287;0.020743820420389573467 0.94135259336737409086 -0.13897007312073489382 0.098290737295330901646 -0.13760118119948566706 0.19704806795780901996 -2.0327318860475256379 0.4467988032040631774];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
