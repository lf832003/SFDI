function [Y,Xf,Af] = op_9(X,~,~)
%OP_9 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:37:29.
% 
% [Y] = op_9(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;-0.00087186];
x1_step1.gain = [2.18660485863677;2.70888921997539;5.574728595732];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.73455337723614244627;-0.68828952830563827625;-4.0738277569933645239;6.4757461513340839332;-2.8892773309602040044;1.6062497994465745332;0.55661550192704256634;0.98195329365301775582];
IW1_1 = [1.5346380069670428892 -1.4876797464144719818 -0.61622982779379964491;-1.5122485151435427486 0.62300440930203493384 0.2846631994452613057;3.3712991728569163818 -4.1658621833754017061 -3.2426150477702466723;3.414831636766153089 1.8779603096541306329 1.2380984516929027794;-3.8407006754772825552 0.03620478091842590368 0.95335596922429766131;0.36857964484050959042 0.96357192767535215783 0.45272108810428668413;-0.074999639804557566292 -0.073063937288454797181 -0.36293204755463565059;-1.3441177717416843418 1.8768991592551562686 0.51508330010241487606];

% Layer 2
b2 = [0.19467668463546425328;0.23104105966687793483;-0.46596566194630950619;0.50411073864796673849;-0.33394415062849497344;-1.0985187184220996937;-0.19551312783984775567;-0.42063837841904494486];
LW2_1 = [0.48176893887524568916 -0.19164070551556466881 0.54342894716637080155 -0.23059702438592355467 0.30044651159124674544 -0.10106204006254239369 0.077933342029758587155 -0.13187787133352177338;-0.38055947161243131038 -0.042404405899311103934 -1.1317492241030400191 1.548895693128441664 -0.51407567822921707013 0.59671770887442820985 0.0095292268775700825906 0.44200237837537714736;1.6100701510977579733 0.21589185570563929062 5.6554708436167624441 -6.7054793426306309456 2.5036352802291648167 -2.5528763342122307023 0.22520090902882924921 -2.2309539817882622081;-0.2812880399732523018 0.26141360930338092272 -0.92336248266641540727 -0.40459233496493141047 -0.043042675824888201874 -1.0475837104085270468 0.63384611728973971889 -0.57740759848917466712;-1.7979335072659075045 1.8181002086887263491 -4.3899948945568523229 -3.4524542185718201104 3.9759592705167330351 -0.82204478733021912884 -0.16122501200807054511 1.7507178260655102964;0.2148553072367429817 0.15889375182129364394 1.1660575717461223455 1.2205131072110799728 0.59307165999728639338 1.1279025233038622034 -1.444291763408468432 0.01117411776523931019;-0.80504618406804029362 1.1143946767893089245 -0.91231748901302478494 -1.2621804010943373786 0.66238482699049550106 -0.083222929160222836042 0.10441571157757871535 0.66315685041496619245;0.13446373390605459441 -0.54263267820694904842 -0.20691017855103097101 0.054458198294611320778 -0.41210261555701710456 -0.049252805928613530018 -0.86071642283204607971 0.253098908338449613];

% Layer 3
b3 = [1.0410999659539517115;0.079094301905112476825;-0.13896847004286089211;-0.19326153426975731242;-0.2916529024965571204;-0.21855400621020820706;-0.17159563138059596987;-0.17757070006316960642];
LW3_2 = [0.58421767048751549467 -0.18401410754647476442 -1.2942668670660242292 -0.075420313973522612461 3.8959636024565806878 0.15083429339639958799 -0.49857639193782959941 1.2482456596642079738;0.80647809971463135792 -1.1286107263365825482 0.88414398634809321376 0.66959637147543216162 0.099238460110515763768 -0.97401411244442281934 -0.38910329046750552484 0.15293346508315400212;-0.34923372352343151626 1.7942271689902635767 -9.3067008200113114924 0.15319717180150252411 0.090232821110675806575 0.0089752214887595261478 0.010219842807644789404 0.66351240089571295044;-0.23521179793227522947 0.58421741793225723249 -1.2703140779376809189 0.68510896677867305637 1.3797012595778972432 0.77364614924400731955 1.0748006264361125162 -0.47651346769459790309;-0.43159838615367462911 0.69943968458116934084 -1.2286016144079987544 0.20722761479239745763 0.65075960531686327659 -0.23269706381260477079 0.93616573024463412001 -0.0121804476577415631;-0.1152157654837060452 -0.0020624805374517473852 -0.84204131147528693546 -0.39243597706913824208 -6.373310740148851572 -0.44164724153858014866 -1.7724355038963079956 -0.1711221180128242314;0.23477146981472629683 0.56941568621706151188 -1.9534580834537031979 -0.046304663155912147154 -0.26119973795100370761 0.4353042992309499315 0.62937168472994808877 -0.47016840882847532601;0.010761492719978171806 0.084974466416370991739 -0.30556121391377855101 0.24656574019270702247 0.67006829595004224753 -0.05195986564220459597 0.46971790915746597372 -0.55315055043102212551];

% Layer 4
b4 = [0.14620279188387722002;0.089599814911499500725;0.43174896542923296705;-0.73291110511779111736;1.2870752837156758108;0.1323086903094219946;-0.17861326256426446335;0.71860684672896912861];
LW4_3 = [-2.1468186405652254223 0.62216874535315669359 -5.9518520350284660481 -1.6442737404768510423 -1.9034277580249552297 2.3655669166653718882 -0.91224866366338164259 -0.51248524473618339847;0.23509458708564942575 -0.51708594682531494602 5.7938713385180706794 0.75150216325350605029 0.92891363325474329837 2.4428921919448249866 0.70271716357510094486 -0.53036540549337374273;-2.4248101777228359133 -0.55629602888433493657 -0.9953835996551564369 -1.5308668910625267134 -0.64047892130245909215 4.5980688763150183718 -0.44480574196993305502 -0.81804960999090436946;-0.25403246968722031918 0.37574280694315370654 -0.89534531391380656196 -0.096850276945235430626 -0.03194610205072635073 1.9121599459985263447 -0.023221880858751538929 0.20908694824036105908;-0.55963306157487502368 -0.078071525666701988011 -0.15232874562064729895 -0.57424366446752728166 -0.44787317765469636388 -0.13423564025001874511 -1.2137634239031351857 1.6385601346238536369;1.4681711415190372705 -0.44092640328572979547 1.3596036389507404341 0.92503825923591043168 0.40484366752474704176 -0.24179390364164540794 1.1774630402893704328 0.013791438123997409176;1.1528016954448025988 0.33047941719604162492 1.035122428958831664 0.3928073116799801201 0.12038321879208163656 -1.9640717889056726886 0.048772467880365301396 0.23220501094356524319;-1.0864986983668765141 1.5455819273263702307 -0.43631801470822512146 -0.67120205753848605212 -0.38925549249858171219 0.39231558663597959624 -0.4532744043943194856 0.79301734710596016864];

% Layer 5
b5 = [0.19688077242033164005;0.29516488905027665757;0.66809970973921750659;0.11153527542825485142;-0.92648781852632688949;-0.3631772570005725731;0.16088422669963858835;0.97784654638358914358];
LW5_4 = [0.62533878922899532871 0.21763080725391703574 -0.2719470318534699671 -0.3968376899249647094 0.59830272822341290517 0.16635262854162294333 0.72684413150927251746 0.81601343443618645779;3.8710505851747751827 -6.5597378656216971393 -1.1946443371780997023 0.02486857146725411985 0.040620551881155375629 -0.96639300943021821944 0.65948110430282336214 0.56933667619641581403;6.274988284063904409 0.50505867200847442966 4.8167290539013141171 2.4537675732351784674 -0.013599569637815184936 -1.5861879030511114586 -2.4847573285504176432 -0.64321308589500647557;-0.86031424911076470607 1.1893157685281507963 0.22618694285190646398 0.41207233527454001365 -0.012996318754405178711 -0.17976760248423545585 -0.38314407636730396511 -0.25419499284276747542;0.16625226833678902194 -0.097477107079524241695 0.23575326518903252926 -0.71264781310920843893 -1.3019052470026819535 0.61064094863318196804 0.33195270448927016727 -0.32760679902347189518;-1.5179968975019730859 0.17345439803390699796 -1.9777892106831371777 -0.74906975237606754359 0.10409238577985938101 0.16291561801134932241 1.2753982960401768487 -0.084645597660323659839;0.68150763639046885167 -0.57793800265575934194 0.71491455892903876812 0.41613136187819599332 -0.19142268472260176582 -0.23813086009413539368 -0.47332435537973727158 0.47607106045604974387;0.39417418963709860424 -2.3851999495515494587 1.6177962666542315961 -0.54599400546847964844 -1.3286847322952821671 -1.3375421394626199056 0.065205170762274070051 0.62584082199798207746];

% Layer 6
b6 = [-0.46522585216338802061;0.2589949050019907939;-0.16895426232215443596;0.17997718683165242481;-0.49418272711879157599;0.24538844500841072716;0.45179736274280130059;0.4373665028977355429];
LW6_5 = [0.43393663122056824744 -7.2768572134058624457 1.9731114934367159908 0.14384650914074126327 -0.76855863562109016929 -0.66453412140089629379 -0.21157051478605604089 -1.518175512486767742;0.66424743699308852474 -0.16712192328040886835 0.35728119616881276466 -0.3688059124166789271 -0.60280997989176121621 -0.29372247678842733354 0.13210216556846918201 0.1158606820715717689;-0.021930255134214125118 -0.067368395670171027367 0.17663321131258202801 0.058134091674510023073 -0.50527186036902804744 0.095325337104380042375 -0.042233494987342287685 -0.053937042173818942892;-0.029362508602396097251 -1.6483837745231582073 0.77622707832172066489 0.65525456581765806341 0.026529603567600194836 -0.24307455809715436401 -0.060008854090541310922 -0.42550742073312025626;0.58642658613772968845 -0.91244665050892970193 -1.0466740466659205655 0.1162743236819913234 -0.15194241317232765054 0.99544847151595872159 -0.52182191139493472321 -0.85275066401726107301;-0.13061102245244124442 3.6295897740441804835 7.5743454766461209005 -1.0064310377776668481 0.4682909975043488271 -2.0198986658184283627 0.6503302658897437416 3.0369195147217165065;-0.78255939435761179279 1.1658758958349650925 1.098575327224773801 -0.52072326591866746615 -0.020153719516346431384 -0.6493749088590642371 0.70708160361751282164 0.83441531642959920756;0.637159680064480205 0.01261017632391266477 0.27678839227720808402 0.010042075920004582198 -1.7781866825118781694 -0.58154107169095214935 0.972233455421030901 0.012594735633954863563];

% Layer 7
b7 = [0.22541940248219577425;1.0924125817703786989];
LW7_6 = [5.9089850287516476612 0.69773169665395140537 0.47178395962069780145 1.8533462985449302707 1.6298360976594545857 -6.9465900441425221246 -1.8252132450992459844 0.26658802359328015452;0.14427468319151848242 -0.3463737998699153442 -0.32570940480044191512 0.062243309749999808922 -0.11078041151350413729 -0.16123877479346293562 -0.093033611727349432852 -1.6981189937891922881];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
