function [Y,Xf,Af] = op_11(X,~,~)
%OP_11 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 10:51:55.
% 
% [Y] = op_11(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;-0.0038859];
x1_step1.gain = [2.18660485863677;2.70888921997539;14.9503759645796];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.90479309239003746779;1.3455084487574333618;-0.056993748569540945981;-1.4129187726351006837;-7.4297098804975592046;1.5213275894272348943;5.0450196364635990776;1.3463393399960958963];
IW1_1 = [-1.6713036703230923496 -0.15738134232971742743 0.44961806711746066245;0.95018214535495915118 1.0977433862464940351 -0.761448822599122499;0.39544450331906561003 1.2789331883121464184 -0.25662810644851224984;-4.6890014657225336236 3.7507000899658629045 -0.24453780396510937933;-4.5263317513640473067 -2.7175546592479307151 -0.17170038966943948489;0.051755768981201578927 -0.73499919374761046864 -0.19957818152672193723;-0.33419275649517565796 5.0616339483345349493 0.21253383569808109721;0.028561691139885780205 0.6526212014556472818 0.49640593211285038988];

% Layer 2
b2 = [0.390048959289975683;-0.19442918183675836352;-0.97983545233591839985;1.9508717075260118001;1.0149818473889113957;1.3301460077814639682;-0.87056049355002085299;-0.37881528154766164196];
LW2_1 = [1.3435763359114287763 -1.9575141069367703039 0.30341490058489778425 -2.0330606461688685016 7.3678930892316092383 -0.36796116311346677152 -4.5958958426627578575 -0.95874095952472926374;-0.02619021556675794199 0.3430664412646088901 -0.72465170330958639244 2.345764282323365979 -0.36048967417308042105 0.59511157028077543707 0.026577152374431305126 -0.87037368532205827698;0.52667535473165327797 -0.16038487469827067411 -0.39898691393841606567 -2.1155628154689982701 -0.5033333779495613447 0.32483591776251385941 -3.5847684883972918968 -0.52558339674974030586;1.1496497675252590476 1.1002127430617600901 -0.081796848507319039334 0.66001333412294294067 -0.16023245831053453681 -0.31174039881255538598 -0.3305741924570694823 -0.089374386912867670452;-0.25952667812164770256 -0.83432315292314129795 -1.8009007652108615094 -1.676434187002224574 -0.88978655724359922985 1.6377553473323978039 0.28608266237666440945 -1.7069825648083625236;0.65969335111651350445 0.99537133666601840254 -0.99066671110686266299 -0.3549068889392219539 0.22839788086653223242 0.64685820512717373543 -0.62183332983395356308 -1.2145825568772192771;-0.30892321487869639496 -0.30726601264089531407 -0.10893871198022561653 -0.47958609054286632789 0.76406521097457114067 -0.48132505533862662839 0.8246934601579781754 1.4592872565754140268;-1.3247508933182676749 0.68730549200087309725 -0.56657444347013297126 -3.6199230551754664198 -2.5031008860364338808 -0.11092124865272290357 -1.8487781187660534687 0.26417370995976680037];

% Layer 3
b3 = [-0.28858838588627333532;-0.093217769602299729859;-0.75637962262855318318;-0.61707019066498558502;0.21316710347211129117;0.24564919248828478993;0.11218891571335723456;0.24961452897883740221];
LW3_2 = [8.2320863846588743229 -2.0033743938887402791 2.2932322411941710172 2.5166961707491024569 0.075826466914941534347 -0.43415519473790403771 0.79372416377127130716 0.0044635062600724096857;0.84204638664495079503 -0.53219857684075577708 -0.4017237647291702074 -1.2150483688073461241 -0.0013736792663115000249 0.50970615674748243062 0.86198290968237234466 -0.33698375730987284449;0.044889402579355565381 -0.80559228243677183379 -1.3678924349509351543 -1.8811529134921747275 -0.10395431877508302942 -0.0059355091479068372226 0.97124714135480449961 -0.45594181647416276437;-0.45105303497292797976 0.25833002412423616834 -0.80858912928559312228 -0.78417229004921951141 -0.39788391599610722915 -0.3062456330712087782 -0.9149305181798406128 -0.95455753031103818262;0.00871254659627530674 -1.5088474871562933544 3.64904333310463036 0.39771241501495657733 -1.7858012716301787659 -0.53701217506701959259 -1.9841737087356556835 6.0590860226734823968;-1.4469543647661822217 -1.0751160427428840816 -0.82220187481860718126 -0.24154961132109542543 -0.47180914934803197536 0.25231086064483471132 0.35379025572476913153 0.31803767176988273491;-0.13709505296165119814 -0.85056148582658230861 0.016283978888095924226 -1.3761676227912296167 -0.26800283273071984214 -0.15194130891236573566 1.1182457358539654724 -0.54706918596891873641;2.974858769760867272 0.014186928025999223299 -2.9966939445464726433 0.25310415208553388444 0.24544635813788256984 -0.27205466698353469868 0.24562612547499793059 -1.4771344772138514934];

% Layer 4
b4 = [-0.73994828018750613552;-0.044353547511957490401;0.52206336083639515167;-0.38954055675823423543;1.1540236271248816013;-0.60894207520650445176;-0.90242788974018106618;-0.71036010663644089114];
LW4_3 = [-5.5971983857175722221 -0.36740205173960915896 -0.96451376581760039919 0.33952316670239424123 1.5634004591777475035 0.86121799443334123847 0.44981394256041429269 -4.3593403586333758781;0.11626692300686820858 0.1304517147090259177 0.56487904417181389327 -0.48020298241756070867 0.87513780328927237573 0.1800425966108519793 -0.90605751050801308644 1.0711302997010616611;1.4864362260363186419 -0.31621241050886439439 0.53837202156423724642 -1.2424859848146336816 -0.31678233017046358855 -2.4508330997550773489 -0.77464940493492573381 -2.1425352620741815457;1.48847362202825928 -0.059267741152860889398 -0.11440930430409171348 1.2371781357895754727 3.3279641288342998173 -2.3803230126877643613 0.247138010925283369 -2.9056919554318612064;-3.7325906256972380959 0.22082872852772303385 1.7569076555335156886 2.8729965176744047817 0.77417835876782636895 -2.2144133507070629108 -1.7676231980371173158 1.4847886765151050437;4.4013886438867713125 0.76282242811348321965 0.36180283001039398316 -0.29475025158071349596 7.1916780943734339715 -2.221077649884139138 0.30927501779899685408 -0.1684164468476849752;1.7000570155997096755 -0.17723034021959946371 -1.5797962605591138185 -1.2757133866431145108 0.38763421872094216969 1.2839673204835968523 1.3159281677169356595 -1.5926158066648750111;0.76539373216941608558 0.67535292320303408342 0.63500340858623660623 1.1267087417944769978 -0.61196705621426839006 -0.69963281535475363437 -0.046921702591649766534 0.47718396638994775572];

% Layer 5
b5 = [0.84674224575386658476;1.2106409089196028539;-0.58572722932384069239;1.3128009357479963892;-0.78768177025830721227;0.92214088709900976504;0.0014912266215175030547;-0.54611398263990174051];
LW5_4 = [-0.54817907771289631214 -0.82509140834763683436 0.89546529314604661476 2.0222973264029344698 -0.71752000649052438686 0.55964167960383781608 1.3460942596469553934 0.65803096436575947425;0.74409110977149994781 0.66049262751425874551 -2.6301306013417011798 2.3227427286696920028 -1.429749882392044924 7.0681079875318113537 1.9555558221272868469 -1.85411843544269761;0.043979538271230286806 -0.66676429035727446948 1.7735096701100439009 -2.7350496876194321239 2.0416479720104714346 -2.9644962296518810874 -0.74092561799757106211 1.3047414581140972523;-0.8232237083840889813 0.54739017789554134108 0.16588342970619082695 -0.43247725044499851776 -0.94246115567444677108 0.98873250187687344859 -1.0427570957338556656 -0.77035317343141018753;6.2555292946618301642 -1.2833468780145409482 1.8167413065809310257 3.0457624139987129475 2.1219130953546394558 -0.90279839614921841839 -0.17005376489378087879 0.91876486379295663198;-1.6603682372256096667 -0.69180712788183296169 -0.054088719932775489174 0.19618024433308964283 -1.8808476646539413757 1.9215312055943980507 0.31027164602713908081 0.31614949498686617524;0.46861210779430262363 0.74637427226279162706 1.4187523231990251116 0.56281615102484272573 1.6180864165284365441 1.1521763076791842195 -0.031857243841071282431 -1.3604065511103022867;0.19160106183858996443 -0.13741237214569401726 -1.9316868036036014544 0.17777311709813903295 -0.47645322364580644514 -0.028264884357290083472 -0.27485167066339866171 -0.59132793600160937775];

% Layer 6
b6 = [0.64310360773475927498;-0.93636242965311500264;1.8267616111472517737;-0.72165047778134405743;0.44401003800464239335;-0.45814101307542171027;0.039640977205094282687;0.33699083665580487068];
LW6_5 = [-1.6950068128086823727 -3.6031960907380566894 2.3934438429532218784 0.50257228555133248715 6.7681455841526103612 -3.4695229453751355031 -0.036991260291923296066 1.158824359692110173;-1.0853142410283471708 -0.34368144485504747987 0.030172487255721767985 0.04189772767237882195 -0.89291780259297481859 0.048240200475881657438 -0.35972009520684389283 0.33487083368611814116;0.86304825021236264426 7.8043325205751310492 -4.0413963186333834443 0.29036604408890326345 2.404694900663872037 0.93811917590883098228 -1.6893460178582153652 0.17055321305805160037;0.58701611635292183511 0.73253459394806164084 0.56006273764959446648 0.2069399029145667368 -0.49651105822474089768 0.54333372001316559974 0.54786226110741331752 -0.094932416997041288442;0.44893703685494235067 3.1173519475503637111 -0.91117849977662779271 0.279862533640864386 -0.19996756772307022754 -0.48805424815404380157 -1.0881833566816367931 -0.15922116498770708115;0.42799474559282957298 -0.29968566103975530224 -0.66914937930403017852 0.12328340213119537427 1.0005827003322951274 -1.0811413296501735104 0.79578387289820939898 -1.0227147306343571387;-0.58412244234623178496 0.29835036402692571844 -1.3497635912459857721 1.1822192171652898818 -0.77765596749476850746 1.2790833452157048811 0.73327400179753610132 1.4502682432931324197;-0.44366955722141748764 -0.48189988953891560453 -0.51107390913456551829 -0.14265254132942895016 0.32933047842917950732 -0.24801938448367885637 -0.3857882824242117592 0.23556300012575948077];

% Layer 7
b7 = [1.4719605841905718524;1.0026751955373307545];
LW7_6 = [7.2781123495252488809 -1.176654227916410278 -7.5142742528765662513 -1.5676482647167861995 -2.7350749631308577392 -0.83856865081970488607 -2.2403093243976934801 1.0465407865195928139;0.29331463795215900747 0.16919401150281210278 -0.24064012972771151033 0.32351982887166613745 -0.0089604810980953315119 -1.7352560939296488574 -0.11121500674415188414 0.56713402319988348577];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
