function [Y,Xf,Af] = op_18(X,~,~)
%OP_18 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:47:58.
% 
% [Y] = op_18(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;-0.0016794;-0.0038859];
x1_step1.gain = [2.18660485863677;4.45762514671159;14.9503759645796];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.31099040826410517813;2.6390515384188555359;6.2806600318239809155;-1.7198693435111751526;1.8276845484279951037;0.10167409991455335361;-5.5663905981546220048;-1.5535435774546220156];
IW1_1 = [-1.454818304838720211 0.66803698593938298789 0.25342531435770454529;1.1634601149006251752 1.7970484331198275374 -0.14536294583984105122;5.2678123235662770441 3.0106779067789215532 -2.1013451626329122668;5.007211814590500687 -3.1507789756026394201 -3.7933398172046968178;2.9832284715511945272 -1.5101823503686380157 0.16716309682236479839;-0.0020068201257980242125 -0.080241526638890323109 -0.10773533772673088427;1.2434232522043053848 -6.4483337914939991009 -0.47956667316124512723;-0.5777658349544650962 -3.3911046772547983608 2.5676138829322603385];

% Layer 2
b2 = [-0.78425896198983857666;-1.0732784153271666128;0.2827418391975027312;-0.17823612068712424428;-0.37542614746678443227;-0.63012287631641239471;-0.71915190663665518045;-1.1146853587723444257];
LW2_1 = [-0.14671977297927596418 -3.0274450820671012785 -5.6453275792633181851 2.7969314927058870346 1.1501105116811924933 -0.15912187328370405726 7.6346096299973051913 4.8799494757931478617;1.2028168986673248853 -1.1441718437149563936 -0.69716187279759489481 0.55802039856995333533 0.2750725155133740274 -0.048312472877952400419 2.7563062380296483589 1.6531619981639809058;0.5679426125130957459 0.14020381812003462896 -0.79375648202534399012 0.0069540494213443347638 -0.73427849405911904679 -0.61989225034999384523 -0.11318571193410127684 0.060422263004864910918;-0.025910357812985562731 -0.079393269495877313857 -0.11081735931155320407 -0.00020254358062426900322 0.069126428764329783672 1.8226631283996008737 0.016650656443596083267 0.035475780941200567298;0.12000358055753805597 -0.25824776062808568744 1.2915310591607165325 0.011106695149483434074 1.4318498653441884549 -0.8395538335002754593 0.86687921113107824223 -0.042948833494035915104;0.96715773696271423177 -1.6440448216343919174 -1.6770243034340128752 1.5598355785530835238 0.43174076940506778133 0.6029294229792756532 1.1289669301383418176 0.74293184131683509541;2.4222977122798945437 -3.0438040061152897842 -6.4223558539428973191 -4.3367671954849393856 -2.8363781305740296546 0.49251838519177254527 -2.4073240322783981959 -0.52148428430030246972;0.67039588894664581264 -1.0710875877481802476 -1.3736462006612852882 -0.032422057590975612851 0.40308929740652171825 -0.87673734236970346512 0.77999210879659297557 -0.56053882718921910211];

% Layer 3
b3 = [0.27895191072207969896;0.16746350032376783323;-0.016009603182259801724;-0.60630067613243532332;0.28793598269718068128;-0.45710126875230744359;0.45387875658308407534;-0.47182796830611667405];
LW3_2 = [-1.0246944012601648666 -1.344095380593959721 0.40055430659064822363 -2.7018850278006780741 0.20177708727317331117 0.051942830832917417927 2.4394771176357763487 0.088421318318402691849;5.0089517595945931561 -0.37608141682943629913 -1.5197597017164268252 -0.016200088604444922574 2.1916448286190943762 0.67950039720859878312 -4.1423624474780407212 -0.70122009534860174629;-0.8014607963806114066 -0.43589532166458266893 -0.19723835056665017795 -1.4247930778384307882 -2.2424824475453504213 0.083906566661986772826 0.5788642914974968523 0.25937105200111371106;-0.098697760701493802982 0.027187734560710347803 0.32767352653460568579 -0.28008491888795167268 1.1899288497560216449 -1.1828824382697240569 0.028370726630625526382 1.1709749957642854312;-8.7090959357642585559 -0.99120647655341520554 -0.19455431688364846488 -1.1432678831098970207 0.76045014659118304046 -2.6410446055074210392 -3.1887868052111261186 0.29908524388878543476;-1.8431117912450323271 1.2996279052926535957 1.641327875374448908 -0.28681589391289208368 -0.11119469281268447303 -1.6884837205472760235 -0.40857941426182053934 -1.4029769598154888666;1.2179374002190079818 0.44349664289763240932 -1.6503810701911352243 -0.3674514386181661485 2.2174443748498866569 0.2780799643305610358 -7.4943143566253649368 -0.65137267311278834736;0.38141374370577202368 0.46169096731494047026 0.5864181455897666817 0.85405025533628786683 0.52337411401673228362 -0.4360600454731266562 0.16202776555534983971 -0.39375082906050140608];

% Layer 4
b4 = [-0.80421913632270958239;0.054886824820337715147;-0.35863486713211439882;-0.23131679839022259437;-0.070100655496742658723;-0.28455232957638620928;-0.70175043982068607828;0.051521161881968896568];
LW4_3 = [1.7514125579658188503 -1.5041838260604130095 0.61395188401002387391 0.71243739946507478322 8.1054850547166363839 0.6450224018640933199 1.339646524281369544 -0.4663634894375710549;1.4290276753972197543 -0.93892801315063878498 0.47802124611925905784 0.1944816759868698286 1.385494450596751026 2.5435987047152690543 -2.4701059909731490905 0.0017819301062136181247;0.39773992507986521971 1.9478135621368677377 -1.2551294373083057287 -0.6378713293160992448 -2.6405198240316898328 -2.307742294850243514 0.44913982290538895237 -0.33071393977479396353;-1.9310255693514231101 1.4956296438193339426 -0.95828632175731609522 -0.22547351364132930951 0.39830886317169189592 -1.0577178109701663722 1.6170048551982645346 0.28995174569866655201;1.4660064812315516392 -6.5023273376179675509 1.098887392282075659 0.34598006183402207903 3.1021001709656479406 0.75648057846764404921 -5.0551212502717746133 -0.18960651850277904229;-0.53197047268339747728 -0.53606474537527382118 1.2078200696821468352 -0.23936004587541734323 1.3746871270136642451 0.25735834143372604554 -1.8275716505602150885 1.1174179174964007366;2.3559851816908916611 1.1945824253311785323 0.59407651095820990239 -0.70134207283925376064 0.6283388080368502715 -0.20795098705626088864 2.0738289508432345976 0.66669792029483476714;-1.0729136199948807739 0.092313665335229472264 -0.49286891360834095277 -0.41303769236727888581 0.19961653096715226141 -1.4369926669974326661 1.5128887703432580825 1.2755046007253096896];

% Layer 5
b5 = [-0.27417375546223005101;0.71496857443568140322;-0.21722754771120941775;-1.4966224360474496002;-0.48024733868027363881;-0.035142939171297883638;-0.45733144649664747572;-0.12124487713668870292];
LW5_4 = [2.3911123906291935626 1.1347197871741314668 -0.93793539035648654245 -1.0956754102795076555 2.7874611236698401129 1.2708392345450143512 -0.31214861689272049849 -0.65624042034591478778;-4.3018694166423703251 0.16290246294235929958 1.5848180720655988818 -1.3000075459141453571 1.2446952367792603056 -0.67715682130395027372 -1.3929156269201543594 -0.41225263175866799781;0.69751490147019956645 0.094413954434877336852 -0.45424121214551177461 0.22262790109464936084 0.99363774639033308755 0.99807715970878818634 -0.12168837489430865684 0.58205429298716349074;5.8539364666049582553 0.92267838263843693358 -2.4064883625077655438 0.6145190269765467006 5.6893603478677077234 2.6154119180829322744 1.2948977874122800102 0.78956250936860927769;0.77764323357615428023 0.038664811491708757363 -0.95288933620687055193 -0.50506649546769943893 -0.11855875164992607518 -0.69808779266674070296 -0.12591915439363149387 -0.76025362795166906427;0.25097511474969225187 -1.1687499290008289687 -0.58002346942231330917 1.0250320270126000999 2.0425454919563548195 1.0270388436002797494 -1.2878031168409580509 1.1649699649676701352;0.13800454209367582492 -4.7729291574647030316 1.7602384376811188726 2.449376975578311022 -6.1565711723988032489 -0.90897355867608664592 2.1934039610195803505 2.6473384506230157598;1.4003971774493244595 0.23663238363078806237 -1.1053581441457118739 -0.67669435042277847892 1.5707586959701582696 1.2680759583203815577 -0.032834012070129203753 0.0060762459655095231101];

% Layer 6
b6 = [-0.079638008738142626597;0.41374604085904653772;0.17395773436015540825;-0.1734853590039364124;-0.039077783728360529492;-0.013056782922391353685;0.38263710368746822743;2.0381401279206055044];
LW6_5 = [0.27052625979735966943 -0.19077313267911111261 0.066588095479422307332 -0.041871326737748952584 0.18658437819507839306 -0.09316597051101165039 0.29314275582273630061 -0.0603751938943840466;-0.49295013865196052327 -0.5634631733555499622 -0.4129842739037858923 -0.15315014433155449414 -0.16387367403895189422 -0.43954019312656417151 0.75827702439684563362 -0.69788810262989087185;1.937901978813770798 -0.70332815635668399779 0.14360416224619587666 1.9754718724401729713 0.44838432283792678534 -0.13631768256945722695 -0.4904172262810894134 1.093698356932640614;0.7202529194064278828 0.29812505920539106308 -1.0541000420491921652 -0.11213869914811491757 1.2033480223831576339 -0.48992560098261339618 -1.3545445924008190364 0.46225848609495717723;-0.23050550979095787985 -0.80334279472564473767 0.81684235396689708342 1.0440973534466861938 0.12473872902112344285 -1.0185714414206326062 -0.19712376742595189016 0.65230986341779872983;3.8789716794060291605 -3.3311988839052326661 1.1288925010543748861 8.4346729391432635481 0.93456237038782496995 -0.27696931883814418507 -4.9901977292809345244 2.4469004072426883134;-0.52458911638797434129 -0.49380300114304692682 0.051569042652467249332 -1.2715014034228770967 0.52395538172485534023 0.58200404896395374621 0.49487541675190183099 -0.69832936824424218791;-0.65553014373000584314 2.4503525951891518275 -1.2147277489240730919 -2.0664001070534596671 2.5869170095983879953 -1.5241235977250078282 -6.0160896380442450138 -1.0536316504284402029];

% Layer 7
b7 = [1.7104308563272205834;-0.0070929096568286987418];
LW7_6 = [-0.15791026161495916313 1.4883783771047254252 1.8579851083822742641 -0.17636720865972146943 1.3447903475640807791 7.265803602907543457 0.27800539538435586895 -5.9081254890426153636;-0.46100643410150438095 0.0027894507231177641943 0.27923711973670389819 2.0602977230963315236 0.052225387354131888595 0.11558706366084836592 1.3646273836842404137 -0.18514119340295626115];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
