function [Y,Xf,Af] = op_13(X,~,~)
%OP_13 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Apr-2019 11:06:16.
% 
% [Y] = op_13(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;5.1291e-15;-0.00087186];
x1_step1.gain = [2.18660485863677;3.51660717739528;5.574728595732];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.67545535262391254161;0.73449991422648897021;1.5415663951843399104;0.7405162862939085322;-0.47569054866435145357;-1.2727332577817027648;8.5773829386891904392;-1.5259872535219882739];
IW1_1 = [-1.0143529252686620534 -1.2501247153485119945 1.0649798050461944943;0.20064961766776268082 0.16677280379946907152 0.62184363686471533228;-1.1600120256134696106 0.71864360119893799794 2.8261596612365726955;-4.222815421777657896 2.122715029179420565 2.6324176047422001012;-2.3271705128140243168 -0.18350320877075537718 1.9273010926895131067;0.56119865793884893268 -0.27028918220179076748 -0.28402312688961556253;3.375826764785128109 4.0116899720056329315 1.0534569815628331835;0.39160163019898280856 0.017832588162765273393 0.83475228088618258493];

% Layer 2
b2 = [-0.024643158069998259002;-0.81751673590759099675;0.36489422232382512368;1.4629923434963045814;0.057088014917006525695;-1.4876968034663964335;1.9801875389876171241;0.8209103201743591649];
LW2_1 = [0.25699392622356015403 -2.1736414220812765308 -2.1234734190017543476 -3.1277485031176386343 -1.3194420753039712846 0.4537422889584417085 -7.6703106528709099621 -0.046081030925402957643;0.30322078657376100308 -0.65351348779617557394 -0.31576800326591719648 -1.4761273878953251604 1.5702029988574004449 0.47119097359462203123 -1.2579713308435682695 -0.78781441179628919347;-0.12737173312511895773 0.57905702081788534841 0.84142926359997227692 -0.96646508612666492954 -1.2417629026442444928 -0.27883675996950957332 1.1956603695172456359 0.11667639179981698083;-1.893696864768910082 1.8237318566166753619 1.5937939525407798236 -5.5587722004402442266 -1.8176491284508398127 -0.76185491074447664328 2.6760444970357326611 -1.6028397804966036944;0.01279411028225644828 1.2334658893337528962 -0.049850244736004543922 -0.013983415962566522056 -0.20936549075710791934 -0.38530880225547092799 0.48130632676221329902 1.3826906439040842489;-0.48164605147782479921 0.58586420173630826547 -0.19123904547642700535 -1.1118717541250000558 0.78576088089365769829 1.2147166953756109997 -0.49544659550151104455 0.47107474643082153376;0.045288294876673178269 0.054696734763484883279 -0.3648514546734981101 1.6249730952547918328 0.033904019179159666786 -1.0805626204562712722 2.3018264354986093245 0.23047551380932779219;0.33289684998233209923 0.76334161010764844946 0.052234772661146254558 0.043544326271818263596 0.31705070723564648949 -0.50884013063901312179 -0.19277299026667116255 0.83888232953810959458];

% Layer 3
b3 = [-0.81123586739640274335;0.19803615753461495386;0.51704099702053274434;-0.7419492860895694486;0.77186622830789508587;0.088971567368371015649;-0.49400502228302917151;-0.16866853278780732928];
LW3_2 = [4.0729667908367339635 1.8153302820343115709 -0.70854371035990093564 -3.3406205397050370287 -1.4057324576969183472 -0.27479127743270176376 0.66921713151721073931 0.47795146417516687354;5.3261338493585084208 2.2197022094693137362 0.90818032716578045438 4.5231193400976721364 0.62393660377768522807 -0.73532345067785853665 0.71736667533683662334 -0.7233642412665350907;2.2618896754207127309 0.095249159020894189065 0.88406548107960092331 -1.0314393285560194968 -2.4098776283503307027 0.90549534539987885928 -0.31390457977220648234 -0.76614772014333687444;0.86487180044360600917 0.28695729618698023744 -0.01179249057054554059 -0.3610198272512612494 1.1412663291624658424 0.63555091919626460761 -0.66161287510048838456 0.51519745589226706439;-0.39279455645993455182 -0.7409779301966612497 -1.2776553434755626437 -2.9398786718469311907 0.59283112289410666573 0.021067531120906812792 -0.87098403778213351334 1.5431140136233487681;2.0047921597802376148 0.032794095477345221179 -0.96608244487488403873 1.5565209475553780649 -1.0103817264057943781 0.54416949361035105159 -0.60574751497757550744 0.12607852350815212938;0.43901788169849004229 0.71786498592584069289 1.1158856352100225973 -0.43496143496219430435 0.20008036168563159141 -0.27144440227297428336 -2.2707816082297465066 0.074877357944952205315;0.27204696270522615853 0.18121859695232331311 -0.21633618453344577448 1.2610723051178460707 -0.18105940607743306603 0.29792019360652521875 0.25863968229698297563 -0.15135035175448710576];

% Layer 4
b4 = [0.19335320734759145478;0.30354973565180953798;0.71900084285530196926;0.050584889671637649211;0.31727878079286792046;0.3708995303298810442;0.25228875999369670957;0.11500331548563418049];
LW4_3 = [-5.2695340742374217058 -3.2392524636335937593 -4.951528666882313523 -0.012698785440313534525 -0.51015216253172979144 -1.6609223622708155776 -0.26664143421051783589 -0.44308045591018407894;-0.14032988568230186921 -2.0527863758192270716 0.9897339614965219301 -0.42336458937590831786 2.1482854894686429503 -0.14896381879969486373 0.85503295396038614395 -0.76106364290798089733;-0.17218515446165841287 0.036903590225753069021 0.036604060783105886456 -1.4100941555021966334 -0.80547326065170965492 -0.63462554991054087594 -0.96794065136735496502 0.49340722653470964199;0.37137712341090922674 0.11251549869826041328 2.1937982390757038154 0.20098336381366510572 -1.0214259581610196648 0.081383189385968654483 -0.8619702870677515838 0.6445106323453406727;-2.3634563192691788736 5.4499711539912931713 -2.4702379039992816701 0.070780893258726190753 -1.7846632334760546001 1.0960779493848062938 0.16151555126640665394 0.57327801450257453997;0.099432763283063579918 -0.14675174114154604377 -0.65398780737588380063 -0.45211236191523618277 0.12561597542325650401 -0.56622805482391613818 -0.72746861084321412516 0.22918255275678553473;-1.9382273409784980256 -2.9875181109824695547 -2.1143469286805425256 0.042002327782545055557 0.24833228058043166353 -0.28492270656535861884 0.19219375391172835443 -0.39557019424771361349;0.002869157150045572105 0.58909980711353593374 -0.56966208839391119234 0.029344113080358696921 -0.048694828850298584044 -0.78691485772932956433 0.38321333595478795919 0.17665403968310372518];

% Layer 5
b5 = [0.93278612468105637223;0.35249134767507339649;0.21822039466614981396;0.010559834848645786171;0.29704641226019867783;-0.66156630391616377818;-0.12730387582848440298;-0.12454628983668750153];
LW5_4 = [-2.5130075996238891989 -0.91937809298836215 0.21656187310452440498 0.17775625950570256295 2.5268651997336508686 -0.3769035412170276822 -1.0656389803579555675 1.6344452879137780776;-0.10833030562367282346 -1.8089065153677230668 0.16922408994162538298 -0.18180720636114600097 4.8803067483196933551 0.22387003452189183084 -1.3524410331609753033 0.69586561825991444241;0.6386905626335954711 0.82598579615589007297 0.58895094725320218387 -1.7886848607750156503 -2.5066432891446259745 -0.27852198652725168593 1.4903907680964991744 -0.57400516398708667509;6.7831682107368838075 -0.9073030590095740866 -0.32011526180043686773 -0.20809405957477150606 -0.25002152380546249777 0.32178346410973718283 3.4940986707091159502 0.33158117482273830046;-2.6029111384790581951 0.68691540451521260202 0.17553054618247104779 0.043893692979662717046 -0.59817623937972308479 -0.33486749258341619306 -0.92986740305209980573 -0.1939380856151639021;-0.65258382104659884426 -2.4173680737479550373 -0.66391775983963030594 1.220786311068672525 4.3711931675409152476 1.058957420679057515 -2.03444769885027954 -0.12707632307625557622;-1.3998723729693607343 -0.99818788983679418436 0.35247083578701682294 0.53845446328316337592 0.56467189450896837499 -0.79945707709495628102 -1.1416444749249103907 -0.2937154724574377318;-0.5787945441906475752 0.68569662182852775256 -0.46106241425169747217 -2.0913518563862307786 0.69500800652841232541 -0.21964829962174883815 -0.57474162207248502554 1.3213409344350153241];

% Layer 6
b6 = [0.12075578153571285556;0.1272507089806526881;-0.60818544533533169805;-0.16787681599093548512;0.24729834162628480665;-0.19371818918182881486;-0.62200962047341112893;-0.58216143918667295765];
LW6_5 = [0.59581918303914072066 0.12650556509025798202 0.43690011987317300957 -0.67713897170227166367 -0.48538838360072206202 0.17755052028317080959 -0.41155337063464947356 0.68374075374842946395;-0.63225126551506249939 0.20699428212538256711 0.33132412504304853407 0.91549880672845396212 0.23339180445105117689 0.57515373718227180699 -0.10301655429500902739 -0.95369166647056835551;-0.46456063701429239909 -0.19869930821206632787 -0.13494202724551343509 0.71217614503730441999 0.19059034832984733665 1.6105654604413188746 -0.07714672042595599466 -0.58298591409253364137;-0.5165691806407929354 -0.093962819731879060337 -1.1294183986233563566 0.48723153271685937238 -0.25362637018569172964 1.8256365137371963758 0.21817830005513824676 -2.3964907909060308988;0.097807234882511071006 0.78197318244284486077 0.041276832845288387308 0.91327256198913331353 -0.97801253497289108996 -0.30942841278112981351 -0.53645969730314213564 -0.12447065910259121069;-1.2398029353368000827 1.4726782615466742499 -0.3389862945690722551 5.1978827232356090704 -1.9707775095389821196 1.3867818190234708631 -1.5703633206891514096 0.061978219494555453206;-3.9431689233976321418 -4.5298976684480454225 3.3375522326542794715 3.809439968975777191 -0.50203414661050849155 -4.748709066096381548 -0.7988410620893369174 -0.028637470647326114526;-0.56287579577814017551 -1.5599228967887448505 0.80901147041318033359 1.8998069282717848782 -1.3664728054271844115 -1.4711670692233096425 -0.86846735199636959646 -0.35701762025098354725];

% Layer 7
b7 = [0.042202324792833548206;0.30035752541232357826];
LW7_6 = [-1.1015138231791730128 1.2221128850064348903 0.42721451130002074947 0.88531759962229328309 1.0094523874423244614 5.3031921038326448326 7.4019588064677250827 2.8281554791628096268;0.045896606218138943922 0.62996059997145137377 -0.28133998064707987918 -1.8699793428732964795 0.26509792268856874342 -0.017352398423348996265 -0.030881409746387533666 0.026362071328327570802];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
