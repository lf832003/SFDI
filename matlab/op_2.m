function [Y,Xf,Af] = op_2(X,~,~)
%OP_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Apr-2019 12:52:07.
% 
% [Y] = op_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 2xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14];
x1_step1.gain = [2.18660485863677;2.70888921997539];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.41642605055802600633;1.9110299521536369127;0.99749951369227818354;-0.66964113953422410574;-1.412471629117460159;13.995733567856335711;-8.1238296442114208418;-7.933758843330381616];
IW1_1 = [0.70507126669238295857 1.2720976447181047142;0.071072686149705716074 1.3982242661219734803;0.43677062432624219612 -0.98784898481104577161;2.1618531871857489257 -1.7716744136491868744;-3.9359009384590923908 2.9499316012602432302;-5.0895455067501824686 7.0597108880518515406;2.5550628432057753692 2.0426589477876864187;-3.4576146713689261958 -4.110319457379740804];

% Layer 2
b2 = [-0.6839060578914492039;0.54748629777922330764;0.73843985619738772286;0.039025814458598706569;-0.16971749671081781674;1.3290451580195010717;0.82473794273514100528;1.5320313416878457158];
LW2_1 = [0.0058148176190970200794 -0.16477042803045277575 -0.3969632761933677978 0.06463872171901509367 -0.60134316717994440449 0.74113689221574974297 0.12112914436916208394 0.29712122434116799985;-2.1479814161757220248 -2.2331572390014153839 0.33871458063748782763 0.69555896504649228351 -0.44960086342135530124 -0.47765160092263719838 -0.31187394417078762032 6.2104633619203299943;-0.79295260169709225195 -1.9355130505431612509 1.8791248623330047973 -0.72371862444354140287 -0.11028772117235118022 0.62214464443792216741 -1.8255880747102053441 0.50238770778719465948;-0.095970201075604680274 -0.06069537397570608922 0.38944375176302520325 2.0865345015822041042 -4.3985106627504357846 -0.43504880261421363663 -0.24704046916046937254 -0.51645419995149088876;0.22471720294018718289 0.061800611393529228388 -2.2580973857943855698 -1.3418105563928663937 -0.75667888187602350136 4.1424928455311285092 -6.6388082267251862234 -0.79528617304319570991;-0.74173253288988427734 0.13951040389524194119 0.028511073118094986539 -0.52849325878268893497 1.3477969105639511227 4.0201668674495589784 -1.8187048171100175242 -1.1273590967946989227;-0.022666498489976743408 -0.56747449784478176671 1.0954191298919695452 0.025715749996803580202 -0.42521781540942699129 -1.0555862895302190463 0.71856504157263512145 0.30287103007654864184;-0.34609874193094231076 0.37160557823532530675 -0.14730091673143985709 -2.3303963333964210491 2.2419179234248272081 5.5987791064160976617 -3.0920434852321201369 -0.75427669813272935073];

% Layer 3
b3 = [1.7471508594956783877;0.91008839400381469353;0.69400953806076015606;0.97646477812675325225;-1.0565792331464372023;-0.8971913902718047229;-1.9901747621229675111;-0.51082005291664833724];
LW3_2 = [-1.1542142446225052144 -0.96090150582837441373 -0.13449745111167282774 0.29885062566742309764 0.70676853791479343769 0.95299791573869263583 -0.54440967055832389931 0.62239876792079140699;-0.99496945449975893183 -1.0310577910555596137 0.19448916414205549841 -0.38874351126171496906 0.076778478610556921691 -0.46376650159855864475 -0.38099771018807859768 -0.27940824734349589686;-0.48974133590621876655 -0.20240622846185676864 0.47308329479285510244 0.85351733628613457583 -2.237748831595094412 -2.5039402942334754165 -0.67518577728230178003 -0.0093767013747291672737;-0.99695419427558418235 -1.8701005732894702138 1.1751492690376017514 -0.30398982220602077664 1.9250995196177793645 -0.048064460383285941003 0.2068037871349569512 0.50949047564213456596;1.7784359328245569198 -3.6507528634828325664 -1.4078292447787252861 -0.42278848103594773855 -1.059477495480248832 -0.043314042153491612297 -3.121858006781375483 1.4777633564480385786;1.3241802163440457019 2.1912297075402524804 1.2336828275029114721 4.5631259894172471192 -1.628073710052352796 0.5670913374046269162 2.4471637264498502518 0.72301514455517679192;1.0336414471639774337 1.9746303206642124017 -0.83204260602912782918 1.1676366108191931215 -2.3377478531684983132 0.94484133630599409504 2.9002064285203257299 -0.090779964519808811763;-0.53721883956839089347 -0.46452868951033693401 -0.50690476286267127648 0.58299619560137283525 0.59313534335838158373 1.1813403384151874853 0.32035850366083956642 0.99712639902722544072];

% Layer 4
b4 = [0.073498486068265186932;-0.67692625823687968545;-0.43243170715741330312;-0.30976563777995846927;-0.3782277988493266685;0.52288726867870249926;-0.94208489790535343555;-0.84537707816112783732];
LW4_3 = [-1.0312355447449028656 -0.65462819702300900637 -0.12411702691494398698 1.9073439350283527549 1.8872153572515297792 6.3160126456523526528 1.2537167590824140895 0.4207692257176561812;0.2168055285904636198 -0.57226947749815615385 -0.4299766765225800369 -0.52465738498708258675 1.8433922860712264047 -0.65119277065551972594 0.30323387258050599202 -0.05168518926942913122;0.28355297542180557535 0.3112998382951041032 -0.26739050404196090804 1.200197920985579092 -1.9876286164483030205 -0.95688891929688435489 0.089443336131136766398 0.41873597065184725574;0.017907909316667205979 -0.61705872201584877068 -0.6282810116402220979 -0.99985354752361588204 -2.7932522320748609523 3.2889581405178236473 0.29125630689815928953 0.31441006211083732946;-0.091725750174315057173 -0.13100040293223694232 -0.46169987726734612599 -1.3313530725375000152 -8.4414747013130249087 2.4357804017369133476 0.65799604850724557892 0.229554146232728018;0.99493368205362020529 1.092017025529510077 1.5550382752856191093 -0.073575313215368629005 -3.5530039848852470463 0.14389192993160121459 -1.197037525812037817 0.23616709919000666851;-0.0782505577178262135 -0.057864707645625186594 1.2399454741077442499 -0.12857663852976550234 3.1209814916014591013 -0.99340402775890912501 0.14848258480468362608 -1.3691165017375426238;-0.26030862392047432463 -0.5708481110146095272 -0.20288629169310992695 0.0029436301288553396241 0.90243864549770602679 0.6872033806200223971 -0.29470019775261468986 0.4627420062447088478];

% Layer 5
b5 = [0.14561555239373061288;0.48312105242615777101;-0.50931086715768025819;-0.51498002321561076045;1.1890038420338608915;-0.5212061336162865377;-0.40588050012214327289;-0.12572837855159213483];
LW5_4 = [0.0015618434492268781777 -1.6443951285944533591 1.2935526734011395522 0.11720243760785703513 1.5485433589677182198 -1.0076423080490912731 -0.84352479134157942742 0.29863194159431299957;1.0832592300871053403 0.74094294819206885094 -0.95007999605277604349 -3.3988604462008598084 -7.1732998809805215146 0.077746304731989943071 -0.29639492248636645222 0.38270135631054436054;2.4039274167377229219 0.15360846371576411529 0.18477100372764224123 0.75923410373099631254 0.21061165624617173009 -1.7718884101011400656 -2.843886114719855307 0.26738881569927375192;-0.33213287391172646723 0.39691715587954368161 0.55526298173215493659 -1.2182844131295964551 -2.3695322000124661166 -0.24392205017607121453 -0.064679397105994948514 -0.79616488502080728917;0.69487145740005529237 -1.338905357336558577 1.1006721992624539652 -1.0600101418043974544 -0.40533775224086948663 2.7895782971253613169 -0.34743440404168901559 -1.3595191837412869962;0.43789413403619387166 -1.0630598231666530396 1.8079196245568296408 -0.96145997114555559193 0.1864784314523415254 1.5955723226396116843 -2.3030440253702137987 -0.28114268005050607746;-6.7887611282115569722 -0.42912980155657087789 1.02768765029193343 -2.413067649361964051 0.79981118167032794197 -0.38441949588629131807 1.5334440171162126987 -0.39519500962135323263;2.053219894017988878 -0.26583745387028895335 -0.62208587764750544746 1.4469064051010247507 1.2136721624025124111 0.082745576870010703607 -0.85635557296056841192 0.86953028794760889308];

% Layer 6
b6 = [-1.2854160886682197695;0.11358553538034590891;0.9235212564419673642;-0.10390976044621794139;-0.37469587295880069089;-0.58460206061301178693;-0.78786242178273035996;1.3054497776451392532];
LW6_5 = [-0.23564189109804381528 -1.7927802924606546231 0.38826959674384181609 -0.26190019819754678521 -0.69911463965285980393 0.076625073037049989955 -0.4889340886035599687 0.25957807675638766565;-1.2644051739193711281 6.7959475829820457093 -0.65112863647674612544 -0.31817169911292914053 0.56502151154110169529 -0.93407218011573667216 -0.57748961757803318751 -3.3219011968201597185;0.88738098878472926323 0.33081330567749694938 0.38544437602248537988 1.1154408579249273092 -0.68826258356485703338 -0.83070824367331463911 -0.95742152647374911822 -0.45823863877168669045;-2.0209994749427915295 0.5938753405021287568 -2.7805937316301871931 0.22717652517860564831 1.1308336456379408652 -1.6826912601327885799 -0.40750189171916806341 -0.010543351853392354464;0.63233537784943694149 1.0570991247702554716 -0.77841434605492276777 0.52196213333794205802 -0.11908802854541376826 0.18444138488031611156 -0.92357975852946749828 0.053145939583906731674;-0.50253638563289593222 -1.2189716224523543531 -0.41173784093353793523 -0.66143349101486381691 0.28702442832279384533 0.14906796271187949809 0.27913126488934975056 -0.52290311472282668959;-1.5160650365303325326 1.629020874444955691 -1.9318359537990199559 1.8760501349370579671 -0.11441619718568515895 0.68618612007357293603 6.3800292216155565228 -3.2201678761128667006;0.48935300200793196979 -1.5332576642139190692 0.71641912211121050458 -1.0568883093652106098 0.61119407029443773016 -1.8655320063747800052 -1.6316269074706986064 0.50606970198479828138];

% Layer 7
b7 = [-0.64546769936124059885;0.72976887514830979242];
LW7_6 = [0.1691165702486336353 5.828588455402520907 -0.76871757937332618749 -1.5671239728760240073 0.33101009353136878754 -1.1528717466986955209 6.3692613967440072642 -2.5663504433214736622;-0.54574365811614133914 0.040434811339585652323 1.3576644586295856243 3.7065795818306637166 -1.0706308789979646079 -1.1857588476955973622 0.07528701941733678682 -0.043895461414170604264];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;0.668896321070234];
y1_step1.xoffset = [0.001;0.01];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
