function [Y,Xf,Af] = op_5_rescale(X,~,~)
%OP_5 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Apr-2019 10:50:15.
% 
% [Y] = op_5(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;5.1291e-15;-0.00087186;-0.0028194];
x1_step1.gain = [2.18660485863677;2.70888921997539;3.51660717739528;5.574728595732;11.361093028038];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.7599745614661417292;0.35647603344090805777;-1.7878686438845361462;0.43722710510672291306;-0.59639250824579059795;8.0870500548560801946;-2.0938100327247686216;3.175877313550587111];
IW1_1 = [-5.8659035599114508486 -0.33577270102151157705 0.44702687839201066256 -0.2258049024144563599 1.2637813111671709621;-0.26304088552737742157 0.036152011120456059579 -0.22979036034333841232 -0.0014048342444007903915 -0.36921892130265349108;2.8419313607041885028 -1.3968583073054909871 -1.3663252963799115136 -1.6552989337600001463 -0.13986052785863686831;2.4471455319800963224 -1.688334724270215137 -0.080788878955945858662 -0.45712153042490932808 0.083047474272121807326;0.034302914029491850256 -0.84243312666497038865 -0.72132223847622323198 0.12974958455143059677 0.037834590064463859138;-0.024946193491282474958 4.2004210378991979624 0.90876575059948649926 3.0217369004790390896 -0.042344485573578706517;-2.8618763178368311628 -0.46878868718244137703 0.5190627293280810628 0.45179517198222168828 0.37743916444537162214;2.8019969006780565124 0.01176011626772311032 -0.34174285969005563368 1.0657675657474299236 -0.36862799438965399013];

% Layer 2
b2 = [0.25312667487544165956;-0.14790467984723146277;0.25068384604567423013;-0.37571090482420610446;-0.7559518793871534692;-1.505355370475593757;0.14947761625579494837;-0.99633852456108018547];
LW2_1 = [-0.62059250296484835818 -0.25147745841819008072 0.054520205020274818686 0.24699191453623631221 0.44359821548627687005 -0.19247682638890195594 -1.1108749578209824449 -1.1431586896177183821;0.99846388413132691753 0.16246235137565639972 -0.60304078988150600082 -1.4055836671592221165 0.46420703019327580474 1.6092324028279187953 0.48637254366116333681 -0.39993680038390799769;-0.22392353853471483327 0.24238371692159102477 -0.16014010221612223761 0.084332393589106047216 1.2206049792507451812 -0.69639081014443116047 -0.41125838065294212376 -0.64574872021814577749;-0.068222692588379055256 -0.14710897510847145697 0.028416267500433495252 0.3939495683988107344 0.34803456900171647614 -0.15237273120555380745 -0.063881042548416810956 -0.45162891298969742859;-5.1409143082695543114 -0.75492545681073530695 3.7026239743501143664 2.5624343880508999582 1.7993651633902840725 -2.2801907803725640633 -2.5509644728346745346 2.6878148186223662641;-0.4129557373130502973 0.73534348633223356462 -0.057612169603565625831 -0.27957982696532879263 1.0470066608858070722 2.3166469692664466429 -0.84939249270911809653 0.04849984182325582649;-0.68088812220912209305 -0.14811625913611811689 0.095812455256255688041 0.25222345615622770998 -0.93206803313745856254 0.63807086602936513575 0.35924311474295317348 0.19538201758239512329;-4.4976762434505106469 -0.24446436241729993522 -1.6814936308858667857 -1.3926587098704568124 1.2619851727771274064 8.4272949860249717347 -1.7150438042294338103 3.3163588083985326982];

% Layer 3
b3 = [-0.17234395033436611389;-0.11174312636308003643;-0.94150787626257192997;0.099316210529073814528;-0.32783645869965433173;-0.14835228433701336259;-1.468350561716392777;-0.017377306521137544926];
LW3_2 = [-2.1465196070103669257 -0.36344103370492120142 -0.063922346999239626486 -0.13428360379871864816 -0.13738315401941761373 -0.76308743084810770618 -0.88500663817069491479 1.0345537654886765022;-1.3533794132415344347 1.253801570297701673 -0.4443499763116033896 -0.059317945204596926601 -0.81421983961235511185 -0.94372220150319396925 -1.3632167613968868558 2.327363528400140158;2.1000159957281177014 -0.41379511294013593403 0.47216950551167707895 0.28772214904106058198 3.9628013932724281965 -1.1955581706122091479 -0.047874946168781441769 -5.5998407171291528783;-0.26587714931608652513 -0.075013145910400189087 -0.19812332876076307886 2.0780564200755433646 1.6359793222213288022 0.66433869503558584668 -0.73852373299191553802 0.89944478734943034137;0.20954713620760140325 2.3050324011255298728 0.094643628169847518472 0.64772351556631369007 -8.2204062194620544091 0.45806607085049599881 -0.13717930240732970071 -2.9206628447863329789;-0.16775096849013906852 0.25474041160098476189 0.19957430004007242763 -0.56092736106822427278 -0.61560686789521767981 0.11368497393439491727 -0.32082940465241666095 0.22307024796035282432;-2.1492373222886764772 -0.10129813767836572114 -0.20719437092905571007 0.4861058535362523525 1.3332742613342176696 -1.3912435474475064456 -0.16062319650037573671 1.1304575766673290449;-0.33706374720410331447 2.0097606821988986958 -0.43781548737787201464 -0.48781396326025805443 0.054446634820778133657 3.2073689628379127292 0.071997798088979589326 7.1397820888669123462];

% Layer 4
b4 = [0.19099625239368722696;-0.60819623760798213752;0.35118580013672590079;-0.32356239257867119852;0.074797432387382414842;1.6632010636747833754;0.18707521465398591065;-0.31144771668704845924];
LW4_3 = [0.11326533347976223964 -0.097965003502747921571 0.062462011871021932974 0.56046580209525043159 -0.64542344562311271261 -1.6171609609768626825 1.5519547952031256255 -1.6085697634116360444;-0.75318931689806334351 0.089671326551949398498 -2.2466954866039583472 -1.4213782667088143974 -0.65153780583834186579 0.25060679360602156063 0.66042464722155902468 -1.1211375120464210919;-0.039751330696253112107 -0.93906714751727315971 2.4179087750854550976 1.6780275543091418555 -5.4252365926156640441 -2.4520551983675398233 -0.47823625106718709032 -1.860347535317906642;0.72285992682023114675 0.66547544028059102406 -1.3821954781479321994 0.23505771600815963951 -0.36970824552290743048 0.53015629771335637255 -0.57933312041674467352 0.83246077640308735468;-0.58584083199448777624 1.0350995343146414118 -2.5905418498694539053 -0.31193651106096720316 5.6940298242182016963 1.1891867725575515635 0.49532552897992843111 1.1268149567893510632;-0.31525104759633082452 -0.12762353531958406383 -0.45773764745045009139 0.10721527518497954434 0.99408448840627394727 1.0418970647219347736 -0.16440906498212132236 1.8207896278482853525;-1.2332434833454473111 -2.0213951928085309717 6.8918735033503049081 0.26945906503339939198 3.998766615802828106 0.67589231915708103404 0.27881449235264138542 -6.9104123724998167688;0.53458329463784093338 -0.13498343745396340632 0.10126030449631524821 0.25178005746628734363 -0.8416985333844109185 -0.51955758217655223508 -0.23122277573048757859 -0.38989230757030496344];

% Layer 5
b5 = [-0.53311238022806506365;0.40876225275289224115;0.24283758753328907321;0.45135610914748192091;-0.19656487979502976216;0.29705120656358885434;0.097101944501060077908;0.58570735699896070425];
LW5_4 = [0.70220086851633645164 1.6297230441408550039 -0.37157050807775299228 0.90088715050163770126 -0.068753025172632140083 0.38788342598363623193 -0.5100337945942990947 0.49172365598084244454;-0.38000392990675851967 -0.11399811242118045029 1.6977104533013160914 -0.33626356608969404371 -1.4537288464107707142 -0.72479309949494863385 0.66151003446168632482 -0.10121049911865850901;-0.61776233952020631612 -0.24076433109035025315 3.6240517417860842464 -0.092809931522360389344 -3.0018592425733068296 0.36313740699834334835 9.5429939243467689636 1.0870983417549908712;-0.21855386850422978129 -0.15580398844875537057 2.7933537515563635623 -0.39215293791925204259 -2.8769648451909386466 -0.54653818731588110769 -0.66623226788807909937 0.1615537037135511278;0.34713221174063529917 -0.32967444335053353033 -5.9617204874881437604 0.42646612009892315154 5.6551398987782528494 0.047827338290947860044 2.0904858700728934373 0.029448920211000366443;-0.84257499768309263022 -1.2744125630572307184 -0.19669596258107174824 0.21422700674051692316 0.44866225930882291939 -0.056001234759080600889 0.93963987035076046439 -0.051863765092894434372;-1.0156385677492107966 2.4745734053461676538 -0.62234588799478474108 2.346262877317899509 0.88214810197355053578 -0.89791271192018573544 -2.2927270616520565305 -0.25757613052039618484;-0.079248281599216999216 -0.36344791115673702464 0.28820928966036757357 -0.28352728147455175112 0.39468804227549875163 0.34599496075425550945 -1.3169489455157947777 -0.49001558322948840507];

% Layer 6
b6 = [-0.67080723440850287265;-0.18881788593643139551;-0.15763131321629941795;-0.48405897768708811002;-0.99711268570741795614;-0.26683526827225539924;0.6946236975616958409;-0.58598797503316102375];
LW6_5 = [-0.16149697177837138429 -1.1396682683529750779 -1.2062602527734878066 -1.316136999931470708 0.056548757772618786499 1.013951081973989865 1.6194904965442979972 -0.52930897341844684867;1.4026937232624083762 -0.25447618995024212651 -0.14426845111974320734 0.37456520208437871222 0.96294437235978447287 -1.0975194059036879057 0.1790937268783035774 -0.80587140089400577381;-0.068602064985306535072 1.3647903191440577952 6.5440146200368802809 2.6842542329694012437 -6.4978403955930694735 0.82051660616033583739 -2.8582928498593496158 -0.80107484031002607061;-0.19940301519845257672 -1.6613502227838721215 -3.6078225018686236325 -1.9260934357556083185 2.0088046271396740039 -0.14183104646979591279 0.98836121367185669762 -0.16290826894217730336;-1.0520066899191904408 -0.70783489773808960788 -2.5256746620315579932 0.62639955379896705701 -1.8076708260551757057 1.1123878349685676348 -0.12105806974829373679 -0.71892911916419932616;1.1616401628089765286 -0.65420455873018856785 -0.64361166800888947037 0.099010491301567235545 0.14777077421276318958 -1.464118984102210641 -0.37634973537108518116 -0.94220687211576303888;0.77035379988423613451 0.58555595419352735043 1.1893561171513311603 -0.28943984453389365319 0.59112447976279702822 -0.50453717316717594521 0.26481291132698586699 0.48403275900380948737;-0.097527797137050495357 -0.56209878246812594593 5.8720214584082892628 -1.6441208200503523162 3.2105039104829655727 0.47907341892289118102 -1.8411256444361003837 -0.64594140138232036819];

% Layer 7
b7 = [-0.56988111247538930648;0.75959118544838744036];
LW7_6 = [2.3366604343024510726 -1.4849524325831082727 -7.0457410025907050155 4.0609919944791990076 3.1492261559188792219 -1.2305732074874315973 -1.9430602721697529667 -5.685627578600092491;0.089290200103153583022 1.1286414325070854847 -0.081105550303770798659 -0.2975047367684082178 -0.083447051920102807698 0.70591364054343797019 0.019854768269212712956 -0.034135018508589375086];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
Y(2, :) = Y(2, :) * 10.0;
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
