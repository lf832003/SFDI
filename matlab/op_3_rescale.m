function [Y,Xf,Af] = op_3_rescale(X,~,~)
%OP_3_RESCALE neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Apr-2019 11:50:23.
% 
% [Y] = op_3_rescale(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.2387e-13;1.156e-14;5.1291e-15];
x1_step1.gain = [2.18660485863677;2.70888921997539;3.51660717739528];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.1165740555285692537;-0.099761145346890359176;0.15507557237595753774;2.4488157928208154068;3.621310686957456948;1.1862806811649326821;-7.9111309848330240158;-3.646892531517133218];
IW1_1 = [-1.7851079440709298751 -1.0406530205313679893 1.3911695257289966587;1.8361315101527808658 -1.5479687108768480641 -0.10063624133177445641;-1.0546687375849790325 0.93311505468407374142 -0.25025467656010458306;1.1132942182939735698 -0.17804972632744697769 1.4271084273932628239;9.2068250676629865836 -1.2139822209440191969 -4.6782991933732613887;5.2085626716148478721 -2.8737700131616628063 -1.1924221949842048751;-2.229504101701790475 -3.4980521115378411245 -2.1973444980021015205;-0.24650671305312299442 2.3823410117526528929 0.066458502001153982319];

% Layer 2
b2 = [2.1728255325184555602;0.77864322709075883822;-0.34472449698618545799;-0.093339777107624491426;-0.06710885722653059382;0.17142058255890726959;1.1035033698968099714;-1.3910742840786038954];
LW2_1 = [-0.49991789575880274388 -1.2382389373794959742 0.069659284141842525706 -0.68688224988358659306 0.12060974604646891584 0.64202516925468655629 -0.43935697832538783691 -0.5899858800601780473;-0.56774727907635447188 -0.61966358696065593215 -1.1746893267919100712 0.30596841317672857086 -0.23155226626483410568 -0.068069437132530788426 -0.13425173446501600938 0.43378168063415573075;1.1494498701069242319 -1.2544812599923707008 0.85128669936512080252 -0.75094230795542527002 -6.0995461857616115608 -4.8990467363967020731 -0.76110149732186094251 -0.5316297059720693774;-0.84063914332572176047 1.5343468057619393807 -1.208819888358654504 1.7873525887876844376 5.3792394754880747954 2.5253272533351003304 -6.2759828074065300285 -0.18705847554540119826;-0.52793307406581146957 -0.11172555353113397536 -0.32262276693394820182 1.3228609683562595478 -1.1415828868904474014 -0.28597262629711622806 0.99228611744917349924 -0.43858799466767306452;0.029615312879373561356 -1.1078354290807685967 0.85943698355700270941 0.5207661127516378663 -1.1835933390806507859 -0.50591615214236773657 -0.080899782193333519276 0.97784416468019741409;-0.17453669475837779723 -0.4053048959202963375 -0.48872979542366046246 0.42815294389109764817 0.95292363013914083147 -2.7588950820877173875 -7.2138195633387880434 0.88978720414119649718;0.021891845399631636865 1.2850956083685178832 -0.5876737140098545753 -1.2176306240604388709 0.36071801984192336521 -0.53034272114422664757 0.54316289194101996518 -1.1211167073852774667];

% Layer 3
b3 = [1.0703356900492655424;-1.210601500491306215;-0.71443351412003686107;-0.5476563623217476362;0.2412728166740111535;-0.36773562826411598792;1.3244302012010724656;-1.2989539049789802228];
LW3_2 = [-1.3724898478837714855 -1.3415662514431816454 -3.2680178219731970124 2.8426972421641982791 1.4593131068856237675 -1.6204351113390049743 -4.3210465338135142233 0.51981892902087312169;0.62327748307735486577 0.28968262637030961493 -7.0767543953129052881 6.186848764789888655 -0.55735360832691016597 -0.89774763387516010038 -0.68017692076869962214 -0.093474746219285503868;0.7704481804565594949 0.83411604044887888154 -1.4292933424266489606 7.9309952810967869752 0.28439012280419939671 0.62867904734875001971 7.5638271196444257782 -0.77117126278468350886;0.73456479229807758458 1.1157787685046043347 -2.6135632991033497241 -2.5052278357679242937 0.34259105109036747105 -1.1036510952882860881 0.31863851357235489781 -0.23116183057480371721;-0.02531217302943254005 -0.27202930228335570062 -1.4186930830549300264 1.6623492720914665455 1.1833386304381077192 1.5312808819520988823 -0.2320460326010381491 -1.3202710738954905878;0.20098398425407615342 -1.1887637269552253638 -1.2732866353507135138 -1.1103602962812422206 -0.088456296181366633746 0.27832192604539141012 -0.3494287166081744278 0.68447418672256865602;0.98558578197968238488 0.41114945347978165691 0.24040359807465097597 0.38154508273817244746 -0.86177000663885561238 -0.6917102169479060203 0.068455203182138602003 -0.89840518203299768452;-0.090821110745028230116 -1.4850979381537356971 2.4462660072880044737 -0.73431396179894725673 -1.145437566661938078 0.25559973501783084249 -0.38105948913166515224 -0.39689913910006080489];

% Layer 4
b4 = [-1.8179264310357043932;0.58380388523615123209;0.35199026038952185846;-0.44310427857927103812;0.11657880548044073643;0.807075198611326039;0.79338311466626576518;1.0589184176456829523];
LW4_3 = [0.32652241118474029102 -0.11283831397672379471 0.87866649092199500259 -0.30581282979893692486 0.79211495408831555931 0.76062728564648174334 -0.88638428222764287234 -0.40905859557107238089;-6.149096818745064752 -7.9105649253045706715 -0.47450547400954290467 -1.8200708313243194603 -2.074396700004284444 -0.81556596431402061942 -0.12498712699768785295 2.443934822631041115;0.40288428126959513476 -1.6790308963211866278 2.7404007006310946437 -1.5850063799673006493 0.71244988629892924692 -0.56654168372750812743 -0.7090040702754734081 -0.56686962556144881997;1.5805555270445066363 0.093560572850570219994 0.80570011912253536313 0.56649904352088154003 -0.34676631253320733261 -0.11581435935470570098 -0.10383542002960270689 -0.88083145579870869568;-0.55356671652517219773 -1.7322850217578265042 -0.40970871977736428304 1.7443238563698517662 -1.1460235294669662842 0.63420202533826985913 0.77326180155800627869 -1.2959929148095388207;0.44197105718709395195 0.99022547450028797211 0.56235456467635758226 0.34387539789073096053 0.11992236313623054478 0.45740756073571303686 1.0663590912638403196 0.0078659455659484695672;1.3973463400418244529 -3.946702398099478426 -9.5324135719440281633 0.96297774088430643236 -1.1989520583982868907 1.8639989143404072092 -0.010154254681654496448 0.80472335242042558612;1.0978498136961718501 -0.43625291234589141931 1.557589258249349573 -1.1772108760545334505 -1.2201651907284203347 0.4821830577410995966 -0.77086116640025970081 -0.35971380076020104122];

% Layer 5
b5 = [-1.7562801114698298743;1.3325205383377731749;0.0025970964784653616415;0.28679841488509988379;-0.12479497308852892379;1.1809746283975439685;1.3146799468867760297;2.3379401946258173695];
LW5_4 = [0.70964172282787452151 -0.70707972347791037127 0.19231821435672982745 -0.50425582755681663816 0.78059571236468450195 -0.74546384885616101545 0.69758571162521532116 -0.56460240657080706939;-0.85393400500992278079 -0.97066797716902863957 0.027249114964168812125 0.17360523577154426955 0.63572375609275189046 -0.57422872349783626866 -0.27104097765831447475 -0.7265268232239681101;-0.46894451138656439992 3.382350565911036 1.7788245880052906411 -1.1483620101167109073 -0.86049111370960351675 -1.1987364941126710249 -4.312602808357122619 -1.1050365610790868764;-0.64055053822895335891 -1.0102438845125141231 0.79786418225970257012 0.39236702167051512591 0.77628040807422638014 0.0047042639944723267306 0.0027300232473128683598 0.82155825410450011859;-0.87324472203681691163 0.74928600270003875572 0.19712595663159293569 1.3664631597057703694 0.5926146462831195505 0.56379219285563020314 -0.06596336145061330869 0.97597884678618951337;-0.22113437026906068716 -5.2972425392574002956 -2.7528597955402762665 1.352858386866254925 -1.6290628991251252522 -0.26482067167057243839 5.0780055194757247605 -0.99128983453455044028;0.46079281727264537194 -0.46956316562052058394 0.56799615858269680846 1.3860308975273174514 -0.7355826212560595545 0.6859578728675304049 0.98944674986507052949 1.1789881801958854712;0.71945567465417814557 2.1064588324040434131 1.739806389607632342 1.7973297125837333077 1.0492100090538105661 -0.17295214985813783803 2.1937691700542161222 -0.3090432554426473799];

% Layer 6
b6 = [1.8132758947021110352;-1.4746474542769709704;-0.91017070120160525892;-0.71428638436492997155;-0.0036919823960965040231;-0.93701351870671212296;-0.87059080122792686929;-1.7390620596838028966];
LW6_5 = [-0.85862728303483659698 0.71201876562089605471 -0.631350694837553017 0.049828938340912960758 0.60463994835565959551 0.83049196096067634532 0.39775239971177867027 0.65041869040209621122;0.90790648755782488166 -0.51750245840967568078 0.39601513465848398043 -0.45343548186699300651 0.75250598859827932952 0.37633891189978530001 -0.74069743400777310338 0.73392017013991639462;0.2902259988485610398 0.76800074880320290394 -0.68218396415207349648 -0.76547710023275505886 -1.0201963964682796426 -0.60865615759529223538 -0.56018846044616676938 -0.37007830401867464198;0.57761954153556771541 -0.42512191741154597979 2.4365424204476098247 -0.30015464340606429205 0.49944780218669088123 1.1095133284268001717 -1.6366279647318699997 1.6952933282468063414;1.6860402258149376209 -0.81748926857265902246 0.16847974704772075705 -0.21929057267454529767 0.33980771704299306268 0.14019942468956889114 -0.014035739472422934307 -0.445250855180043148;-0.6286590364630413319 0.087072922178536030224 -4.3845596137365312472 0.0093492794130934468722 -1.4242332326536908393 5.3358929176692582175 0.87623310681092259067 2.0303221215041657999;-0.85009884355480846985 -0.1019729517063565627 4.2262797772675737562 -0.34098463092258174401 -0.014035041393666673748 -5.6061824180047743482 1.574953168283344862 2.1400440129866344918;-0.11125866818979143757 -0.43423614874937643826 -0.43143459586743204692 -0.17590561466959347969 0.90940543822242259075 -0.26087580418765798917 -1.3111629084844316218 0.51285801931212871008];

% Layer 7
b7 = [0.90495721711030885359;-0.36863853312666527984];
LW7_6 = [-0.49489252649777448756 -0.22279254536120443597 0.57534901528807247395 -0.067731128502795140411 -0.25330617775298291949 -6.6928620161730947302 7.1042745183487356897 -0.25484197102239997124;0.27689460364897089395 -1.0606603778602641253 0.31874007102231094457 3.09743966815789884 -0.37108161430878883191 -0.11428931246629843443 0.10679049591602110536 -1.0576744587957422894];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [8.03212851405623;6.68896321070234];
y1_step1.xoffset = [0.001;0.001];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = tansig_apply(repmat(b4,1,Q) + LW4_3*a3);
    
    % Layer 5
    a5 = tansig_apply(repmat(b5,1,Q) + LW5_4*a4);
    
    % Layer 6
    a6 = tansig_apply(repmat(b6,1,Q) + LW6_5*a5);
    
    % Layer 7
    a7 = repmat(b7,1,Q) + LW7_6*a6;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a7,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(7,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
Y(2, :) = Y(2, :) * 10.0;
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
